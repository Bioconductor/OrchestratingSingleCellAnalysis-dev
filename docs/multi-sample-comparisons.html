<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 14 Multi-sample comparisons | Orchestrating Single-Cell Analysis with Bioconductor</title>
  <meta name="description" content="Or: how I learned to stop worrying and love the t-SNEs." />
  <meta name="generator" content="bookdown 0.20 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 14 Multi-sample comparisons | Orchestrating Single-Cell Analysis with Bioconductor" />
  <meta property="og:type" content="book" />
  
  <meta property="og:image" content="https://www.bioconductor.org/images/logo_bioconductor.gif" />
  <meta property="og:description" content="Or: how I learned to stop worrying and love the t-SNEs." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 14 Multi-sample comparisons | Orchestrating Single-Cell Analysis with Bioconductor" />
  
  <meta name="twitter:description" content="Or: how I learned to stop worrying and love the t-SNEs." />
  <meta name="twitter:image" content="https://www.bioconductor.org/images/logo_bioconductor.gif" />



<meta name="date" content="2020-08-18" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  <link rel="shortcut icon" href="favicon.ico" type="image/x-icon" />
<link rel="prev" href="integrating-datasets.html"/>
<link rel="next" href="droplet-processing.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; position: absolute; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; }
pre.numberSource a.sourceLine:empty
  { position: absolute; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: absolute; left: -5em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Orchestrating Single-Cell Analysis</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome</a></li>
<li class="part"><span><b>I Preamble</b></span></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="introduction.html"><a href="introduction.html#what-you-will-learn"><i class="fa fa-check"></i><b>1.1</b> What you will learn</a><ul>
<li class="chapter" data-level="1.1.1" data-path="introduction.html"><a href="introduction.html#preliminaries"><i class="fa fa-check"></i><b>1.1.1</b> Preliminaries</a></li>
<li class="chapter" data-level="1.1.2" data-path="introduction.html"><a href="introduction.html#workflows"><i class="fa fa-check"></i><b>1.1.2</b> Workflows</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="introduction.html"><a href="introduction.html#what-you-wont-learn"><i class="fa fa-check"></i><b>1.2</b> What you won’t learn</a></li>
<li class="chapter" data-level="1.3" data-path="introduction.html"><a href="introduction.html#who-we-wrote-this-for"><i class="fa fa-check"></i><b>1.3</b> Who we wrote this for</a></li>
<li class="chapter" data-level="1.4" data-path="introduction.html"><a href="introduction.html#why-we-wrote-this"><i class="fa fa-check"></i><b>1.4</b> Why we wrote this</a></li>
<li class="chapter" data-level="1.5" data-path="introduction.html"><a href="introduction.html#acknowledgements"><i class="fa fa-check"></i><b>1.5</b> Acknowledgements</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="learning-r-and-more.html"><a href="learning-r-and-more.html"><i class="fa fa-check"></i><b>2</b> Learning R and Bioconductor</a><ul>
<li class="chapter" data-level="2.1" data-path="learning-r-and-more.html"><a href="learning-r-and-more.html#the-benefits-of-r-and-bioconductor"><i class="fa fa-check"></i><b>2.1</b> The Benefits of R and Bioconductor</a></li>
<li class="chapter" data-level="2.2" data-path="learning-r-and-more.html"><a href="learning-r-and-more.html#getting-started-with-r"><i class="fa fa-check"></i><b>2.2</b> Learning R Online</a></li>
<li class="chapter" data-level="2.3" data-path="learning-r-and-more.html"><a href="learning-r-and-more.html#running-r-locally"><i class="fa fa-check"></i><b>2.3</b> Running R Locally</a><ul>
<li class="chapter" data-level="2.3.1" data-path="learning-r-and-more.html"><a href="learning-r-and-more.html#installing-r"><i class="fa fa-check"></i><b>2.3.1</b> Installing R</a></li>
<li class="chapter" data-level="2.3.2" data-path="learning-r-and-more.html"><a href="learning-r-and-more.html#installing-r-bioconductor-packages"><i class="fa fa-check"></i><b>2.3.2</b> Installing R &amp; Bioconductor Packages</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="learning-r-and-more.html"><a href="learning-r-and-more.html#getting-help-in-and-out-of-r"><i class="fa fa-check"></i><b>2.4</b> Getting Help In (and Out) of R</a></li>
<li class="chapter" data-level="2.5" data-path="learning-r-and-more.html"><a href="learning-r-and-more.html#bioconductor-documentation"><i class="fa fa-check"></i><b>2.5</b> Bioconductor Help</a><ul>
<li class="chapter" data-level="2.5.1" data-path="learning-r-and-more.html"><a href="learning-r-and-more.html#bioconductor-packages"><i class="fa fa-check"></i><b>2.5.1</b> Bioconductor Packages</a></li>
<li class="chapter" data-level="2.5.2" data-path="learning-r-and-more.html"><a href="learning-r-and-more.html#biocviews"><i class="fa fa-check"></i><b>2.5.2</b> biocViews</a></li>
<li class="chapter" data-level="2.5.3" data-path="learning-r-and-more.html"><a href="learning-r-and-more.html#bioconductor-forums"><i class="fa fa-check"></i><b>2.5.3</b> Bioconductor Forums</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="beyond-r-basics.html"><a href="beyond-r-basics.html"><i class="fa fa-check"></i><b>3</b> Beyond R Basics</a><ul>
<li class="chapter" data-level="3.1" data-path="beyond-r-basics.html"><a href="beyond-r-basics.html#becoming-an-r-expert"><i class="fa fa-check"></i><b>3.1</b> Becoming an R Expert</a></li>
<li class="chapter" data-level="3.2" data-path="beyond-r-basics.html"><a href="beyond-r-basics.html#becoming-a-bioconductor-developer"><i class="fa fa-check"></i><b>3.2</b> Becoming an R/Bioconductor Developer</a></li>
<li class="chapter" data-level="3.3" data-path="beyond-r-basics.html"><a href="beyond-r-basics.html#nice-companions-for-r"><i class="fa fa-check"></i><b>3.3</b> Nice Companions for R</a><ul>
<li class="chapter" data-level="3.3.1" data-path="beyond-r-basics.html"><a href="beyond-r-basics.html#shellbash"><i class="fa fa-check"></i><b>3.3.1</b> Shell/Bash</a></li>
<li class="chapter" data-level="3.3.2" data-path="beyond-r-basics.html"><a href="beyond-r-basics.html#git"><i class="fa fa-check"></i><b>3.3.2</b> Git</a></li>
<li class="chapter" data-level="3.3.3" data-path="beyond-r-basics.html"><a href="beyond-r-basics.html#other-languages"><i class="fa fa-check"></i><b>3.3.3</b> Other Languages</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="data-infrastructure.html"><a href="data-infrastructure.html"><i class="fa fa-check"></i><b>4</b> Data Infrastructure</a><ul>
<li class="chapter" data-level="4.1" data-path="data-infrastructure.html"><a href="data-infrastructure.html#background"><i class="fa fa-check"></i><b>4.1</b> Background</a></li>
<li class="chapter" data-level="4.2" data-path="data-infrastructure.html"><a href="data-infrastructure.html#storing-primary-experimental-data"><i class="fa fa-check"></i><b>4.2</b> Storing primary experimental data</a><ul>
<li class="chapter" data-level="4.2.1" data-path="data-infrastructure.html"><a href="data-infrastructure.html#filling-the-assays-slot"><i class="fa fa-check"></i><b>4.2.1</b> Filling the <code>assays</code> slot</a></li>
<li class="chapter" data-level="4.2.2" data-path="data-infrastructure.html"><a href="data-infrastructure.html#adding-more-assays"><i class="fa fa-check"></i><b>4.2.2</b> Adding more <code>assays</code></a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="data-infrastructure.html"><a href="data-infrastructure.html#handling-metadata"><i class="fa fa-check"></i><b>4.3</b> Handling metadata</a><ul>
<li class="chapter" data-level="4.3.1" data-path="data-infrastructure.html"><a href="data-infrastructure.html#on-the-columns"><i class="fa fa-check"></i><b>4.3.1</b> On the columns</a></li>
<li class="chapter" data-level="4.3.2" data-path="data-infrastructure.html"><a href="data-infrastructure.html#on-the-rows"><i class="fa fa-check"></i><b>4.3.2</b> On the rows</a></li>
<li class="chapter" data-level="4.3.3" data-path="data-infrastructure.html"><a href="data-infrastructure.html#other-metadata"><i class="fa fa-check"></i><b>4.3.3</b> Other metadata</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="data-infrastructure.html"><a href="data-infrastructure.html#single-cell-specific-fields"><i class="fa fa-check"></i><b>4.4</b> Single-cell-specific fields</a><ul>
<li class="chapter" data-level="4.4.1" data-path="data-infrastructure.html"><a href="data-infrastructure.html#background-1"><i class="fa fa-check"></i><b>4.4.1</b> Background</a></li>
<li class="chapter" data-level="4.4.2" data-path="data-infrastructure.html"><a href="data-infrastructure.html#dimensionality-reduction-results"><i class="fa fa-check"></i><b>4.4.2</b> Dimensionality reduction results</a></li>
<li class="chapter" data-level="4.4.3" data-path="data-infrastructure.html"><a href="data-infrastructure.html#alternative-experiments"><i class="fa fa-check"></i><b>4.4.3</b> Alternative Experiments</a></li>
<li class="chapter" data-level="4.4.4" data-path="data-infrastructure.html"><a href="data-infrastructure.html#size-factors"><i class="fa fa-check"></i><b>4.4.4</b> Size factors</a></li>
<li class="chapter" data-level="4.4.5" data-path="data-infrastructure.html"><a href="data-infrastructure.html#column-labels"><i class="fa fa-check"></i><b>4.4.5</b> Column labels</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="data-infrastructure.html"><a href="data-infrastructure.html#conclusion"><i class="fa fa-check"></i><b>4.5</b> Conclusion</a></li>
</ul></li>
<li class="part"><span><b>II Focus Topics</b></span></li>
<li class="chapter" data-level="5" data-path="overview.html"><a href="overview.html"><i class="fa fa-check"></i><b>5</b> Overview</a><ul>
<li class="chapter" data-level="5.1" data-path="introduction.html"><a href="introduction.html#introduction"><i class="fa fa-check"></i><b>5.1</b> Introduction</a></li>
<li class="chapter" data-level="5.2" data-path="overview.html"><a href="overview.html#experimental-design"><i class="fa fa-check"></i><b>5.2</b> Experimental Design</a></li>
<li class="chapter" data-level="5.3" data-path="overview.html"><a href="overview.html#obtaining-a-count-matrix"><i class="fa fa-check"></i><b>5.3</b> Obtaining a count matrix</a></li>
<li class="chapter" data-level="5.4" data-path="overview.html"><a href="overview.html#data-processing-and-downstream-analysis"><i class="fa fa-check"></i><b>5.4</b> Data processing and downstream analysis</a></li>
<li class="chapter" data-level="5.5" data-path="overview.html"><a href="overview.html#quick-start"><i class="fa fa-check"></i><b>5.5</b> Quick start</a></li>
<li class="chapter" data-level="" data-path="overview.html"><a href="overview.html#session-info"><i class="fa fa-check"></i>Session Info</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="quality-control.html"><a href="quality-control.html"><i class="fa fa-check"></i><b>6</b> Quality Control</a><ul>
<li class="chapter" data-level="6.1" data-path="quality-control.html"><a href="quality-control.html#quality-control-motivation"><i class="fa fa-check"></i><b>6.1</b> Motivation</a></li>
<li class="chapter" data-level="6.2" data-path="quality-control.html"><a href="quality-control.html#choice-of-qc-metrics"><i class="fa fa-check"></i><b>6.2</b> Choice of QC metrics</a></li>
<li class="chapter" data-level="6.3" data-path="quality-control.html"><a href="quality-control.html#identifying-low-quality-cells"><i class="fa fa-check"></i><b>6.3</b> Identifying low-quality cells</a><ul>
<li class="chapter" data-level="6.3.1" data-path="quality-control.html"><a href="quality-control.html#fixed-qc"><i class="fa fa-check"></i><b>6.3.1</b> With fixed thresholds</a></li>
<li class="chapter" data-level="6.3.2" data-path="quality-control.html"><a href="quality-control.html#quality-control-outlier"><i class="fa fa-check"></i><b>6.3.2</b> With adaptive thresholds</a></li>
<li class="chapter" data-level="6.3.3" data-path="quality-control.html"><a href="quality-control.html#other-approaches"><i class="fa fa-check"></i><b>6.3.3</b> Other approaches</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="quality-control.html"><a href="quality-control.html#quality-control-plots"><i class="fa fa-check"></i><b>6.4</b> Checking diagnostic plots</a></li>
<li class="chapter" data-level="6.5" data-path="quality-control.html"><a href="quality-control.html#quality-control-discarded"><i class="fa fa-check"></i><b>6.5</b> Removing low-quality cells</a></li>
<li class="chapter" data-level="6.6" data-path="quality-control.html"><a href="quality-control.html#marking-qc"><i class="fa fa-check"></i><b>6.6</b> Marking low-quality cells</a></li>
<li class="chapter" data-level="" data-path="overview.html"><a href="overview.html#session-info"><i class="fa fa-check"></i>Session Info</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="normalization.html"><a href="normalization.html"><i class="fa fa-check"></i><b>7</b> Normalization</a><ul>
<li class="chapter" data-level="7.1" data-path="normalization.html"><a href="normalization.html#motivation"><i class="fa fa-check"></i><b>7.1</b> Motivation</a></li>
<li class="chapter" data-level="7.2" data-path="normalization.html"><a href="normalization.html#library-size-normalization"><i class="fa fa-check"></i><b>7.2</b> Library size normalization</a></li>
<li class="chapter" data-level="7.3" data-path="normalization.html"><a href="normalization.html#normalization-by-deconvolution"><i class="fa fa-check"></i><b>7.3</b> Normalization by deconvolution</a></li>
<li class="chapter" data-level="7.4" data-path="normalization.html"><a href="normalization.html#spike-norm"><i class="fa fa-check"></i><b>7.4</b> Normalization by spike-ins</a></li>
<li class="chapter" data-level="7.5" data-path="normalization.html"><a href="normalization.html#applying-the-size-factors"><i class="fa fa-check"></i><b>7.5</b> Applying the size factors</a><ul>
<li class="chapter" data-level="7.5.1" data-path="normalization.html"><a href="normalization.html#normalization-transformation"><i class="fa fa-check"></i><b>7.5.1</b> Scaling and log-transforming</a></li>
<li class="chapter" data-level="7.5.2" data-path="normalization.html"><a href="normalization.html#downsampling-and-log-transforming"><i class="fa fa-check"></i><b>7.5.2</b> Downsampling and log-transforming</a></li>
<li class="chapter" data-level="7.5.3" data-path="normalization.html"><a href="normalization.html#other-options"><i class="fa fa-check"></i><b>7.5.3</b> Other options</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="overview.html"><a href="overview.html#session-info"><i class="fa fa-check"></i>Session Info</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="feature-selection.html"><a href="feature-selection.html"><i class="fa fa-check"></i><b>8</b> Feature selection</a><ul>
<li class="chapter" data-level="8.1" data-path="normalization.html"><a href="normalization.html#motivation"><i class="fa fa-check"></i><b>8.1</b> Motivation</a></li>
<li class="chapter" data-level="8.2" data-path="feature-selection.html"><a href="feature-selection.html#quantifying-per-gene-variation"><i class="fa fa-check"></i><b>8.2</b> Quantifying per-gene variation</a><ul>
<li class="chapter" data-level="8.2.1" data-path="feature-selection.html"><a href="feature-selection.html#variance-of-the-log-counts"><i class="fa fa-check"></i><b>8.2.1</b> Variance of the log-counts</a></li>
<li class="chapter" data-level="8.2.2" data-path="feature-selection.html"><a href="feature-selection.html#coefficient-of-variation"><i class="fa fa-check"></i><b>8.2.2</b> Coefficient of variation</a></li>
<li class="chapter" data-level="8.2.3" data-path="feature-selection.html"><a href="feature-selection.html#sec:spikeins"><i class="fa fa-check"></i><b>8.2.3</b> Quantifying technical noise</a></li>
<li class="chapter" data-level="8.2.4" data-path="feature-selection.html"><a href="feature-selection.html#accounting-for-blocking-factors"><i class="fa fa-check"></i><b>8.2.4</b> Accounting for blocking factors</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="feature-selection.html"><a href="feature-selection.html#hvg-selection"><i class="fa fa-check"></i><b>8.3</b> Selecting highly variable genes</a><ul>
<li class="chapter" data-level="8.3.1" data-path="overview.html"><a href="overview.html#overview"><i class="fa fa-check"></i><b>8.3.1</b> Overview</a></li>
<li class="chapter" data-level="8.3.2" data-path="feature-selection.html"><a href="feature-selection.html#based-on-the-largest-metrics"><i class="fa fa-check"></i><b>8.3.2</b> Based on the largest metrics</a></li>
<li class="chapter" data-level="8.3.3" data-path="feature-selection.html"><a href="feature-selection.html#based-on-significance"><i class="fa fa-check"></i><b>8.3.3</b> Based on significance</a></li>
<li class="chapter" data-level="8.3.4" data-path="feature-selection.html"><a href="feature-selection.html#feature-selection-positive"><i class="fa fa-check"></i><b>8.3.4</b> Keeping all genes above the trend</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="feature-selection.html"><a href="feature-selection.html#apriori-hvgs"><i class="fa fa-check"></i><b>8.4</b> Selecting <em>a priori</em> genes of interest</a></li>
<li class="chapter" data-level="8.5" data-path="feature-selection.html"><a href="feature-selection.html#feature-selection-subsetting"><i class="fa fa-check"></i><b>8.5</b> Putting it all together</a></li>
<li class="chapter" data-level="" data-path="overview.html"><a href="overview.html#session-info"><i class="fa fa-check"></i>Session Info</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="dimensionality-reduction.html"><a href="dimensionality-reduction.html"><i class="fa fa-check"></i><b>9</b> Dimensionality reduction</a><ul>
<li class="chapter" data-level="9.1" data-path="overview.html"><a href="overview.html#overview"><i class="fa fa-check"></i><b>9.1</b> Overview</a></li>
<li class="chapter" data-level="9.2" data-path="dimensionality-reduction.html"><a href="dimensionality-reduction.html#principal-components-analysis"><i class="fa fa-check"></i><b>9.2</b> Principal components analysis</a></li>
<li class="chapter" data-level="9.3" data-path="dimensionality-reduction.html"><a href="dimensionality-reduction.html#choosing-the-number-of-pcs"><i class="fa fa-check"></i><b>9.3</b> Choosing the number of PCs</a><ul>
<li class="chapter" data-level="9.3.1" data-path="normalization.html"><a href="normalization.html#motivation"><i class="fa fa-check"></i><b>9.3.1</b> Motivation</a></li>
<li class="chapter" data-level="9.3.2" data-path="dimensionality-reduction.html"><a href="dimensionality-reduction.html#using-the-elbow-point"><i class="fa fa-check"></i><b>9.3.2</b> Using the elbow point</a></li>
<li class="chapter" data-level="9.3.3" data-path="dimensionality-reduction.html"><a href="dimensionality-reduction.html#using-the-technical-noise"><i class="fa fa-check"></i><b>9.3.3</b> Using the technical noise</a></li>
<li class="chapter" data-level="9.3.4" data-path="dimensionality-reduction.html"><a href="dimensionality-reduction.html#based-on-population-structure"><i class="fa fa-check"></i><b>9.3.4</b> Based on population structure</a></li>
<li class="chapter" data-level="9.3.5" data-path="dimensionality-reduction.html"><a href="dimensionality-reduction.html#using-random-matrix-theory"><i class="fa fa-check"></i><b>9.3.5</b> Using random matrix theory</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="dimensionality-reduction.html"><a href="dimensionality-reduction.html#dimensionality-reduction-for-visualization"><i class="fa fa-check"></i><b>9.4</b> Dimensionality reduction for visualization</a><ul>
<li class="chapter" data-level="9.4.1" data-path="dimensionality-reduction.html"><a href="dimensionality-reduction.html#motivation-1"><i class="fa fa-check"></i><b>9.4.1</b> Motivation</a></li>
<li class="chapter" data-level="9.4.2" data-path="dimensionality-reduction.html"><a href="dimensionality-reduction.html#visualizing-with-pca"><i class="fa fa-check"></i><b>9.4.2</b> Visualizing with PCA</a></li>
<li class="chapter" data-level="9.4.3" data-path="dimensionality-reduction.html"><a href="dimensionality-reduction.html#t-stochastic-neighbor-embedding"><i class="fa fa-check"></i><b>9.4.3</b> <span class="math inline">\(t\)</span>-stochastic neighbor embedding</a></li>
<li class="chapter" data-level="9.4.4" data-path="dimensionality-reduction.html"><a href="dimensionality-reduction.html#uniform-manifold-approximation-and-projection"><i class="fa fa-check"></i><b>9.4.4</b> Uniform manifold approximation and projection</a></li>
<li class="chapter" data-level="9.4.5" data-path="dimensionality-reduction.html"><a href="dimensionality-reduction.html#visualization-interpretation"><i class="fa fa-check"></i><b>9.4.5</b> Interpreting the plots</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="overview.html"><a href="overview.html#session-info"><i class="fa fa-check"></i>Session Info</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="clustering.html"><a href="clustering.html"><i class="fa fa-check"></i><b>10</b> Clustering</a><ul>
<li class="chapter" data-level="10.1" data-path="normalization.html"><a href="normalization.html#motivation"><i class="fa fa-check"></i><b>10.1</b> Motivation</a></li>
<li class="chapter" data-level="10.2" data-path="clustering.html"><a href="clustering.html#what-is-the-true-clustering"><i class="fa fa-check"></i><b>10.2</b> What is the “true clustering”?</a></li>
<li class="chapter" data-level="10.3" data-path="clustering.html"><a href="clustering.html#clustering-graph"><i class="fa fa-check"></i><b>10.3</b> Graph-based clustering</a><ul>
<li class="chapter" data-level="10.3.1" data-path="data-infrastructure.html"><a href="data-infrastructure.html#background"><i class="fa fa-check"></i><b>10.3.1</b> Background</a></li>
<li class="chapter" data-level="10.3.2" data-path="clustering.html"><a href="clustering.html#implementation"><i class="fa fa-check"></i><b>10.3.2</b> Implementation</a></li>
<li class="chapter" data-level="10.3.3" data-path="clustering.html"><a href="clustering.html#other-parameters"><i class="fa fa-check"></i><b>10.3.3</b> Other parameters</a></li>
<li class="chapter" data-level="10.3.4" data-path="clustering.html"><a href="clustering.html#assessing-cluster-separation"><i class="fa fa-check"></i><b>10.3.4</b> Assessing cluster separation</a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="clustering.html"><a href="clustering.html#k-means-clustering"><i class="fa fa-check"></i><b>10.4</b> <span class="math inline">\(k\)</span>-means clustering</a><ul>
<li class="chapter" data-level="10.4.1" data-path="data-infrastructure.html"><a href="data-infrastructure.html#background-1"><i class="fa fa-check"></i><b>10.4.1</b> Background</a></li>
<li class="chapter" data-level="10.4.2" data-path="clustering.html"><a href="clustering.html#base-implementation"><i class="fa fa-check"></i><b>10.4.2</b> Base implementation</a></li>
<li class="chapter" data-level="10.4.3" data-path="clustering.html"><a href="clustering.html#assessing-cluster-separation-1"><i class="fa fa-check"></i><b>10.4.3</b> Assessing cluster separation</a></li>
<li class="chapter" data-level="10.4.4" data-path="clustering.html"><a href="clustering.html#in-two-step-procedures"><i class="fa fa-check"></i><b>10.4.4</b> In two-step procedures</a></li>
</ul></li>
<li class="chapter" data-level="10.5" data-path="clustering.html"><a href="clustering.html#hierarchical-clustering"><i class="fa fa-check"></i><b>10.5</b> Hierarchical clustering</a><ul>
<li class="chapter" data-level="10.5.1" data-path="clustering.html"><a href="clustering.html#background-2"><i class="fa fa-check"></i><b>10.5.1</b> Background</a></li>
<li class="chapter" data-level="10.5.2" data-path="clustering.html"><a href="clustering.html#implementation-1"><i class="fa fa-check"></i><b>10.5.2</b> Implementation</a></li>
<li class="chapter" data-level="10.5.3" data-path="clustering.html"><a href="clustering.html#silhouette-width"><i class="fa fa-check"></i><b>10.5.3</b> Assessing cluster separation</a></li>
</ul></li>
<li class="chapter" data-level="10.6" data-path="clustering.html"><a href="clustering.html#general-purpose-cluster-diagnostics"><i class="fa fa-check"></i><b>10.6</b> General-purpose cluster diagnostics</a><ul>
<li class="chapter" data-level="10.6.1" data-path="clustering.html"><a href="clustering.html#cluster-separation-redux"><i class="fa fa-check"></i><b>10.6.1</b> Cluster separation, redux</a></li>
<li class="chapter" data-level="10.6.2" data-path="clustering.html"><a href="clustering.html#comparing-different-clusterings"><i class="fa fa-check"></i><b>10.6.2</b> Comparing different clusterings</a></li>
<li class="chapter" data-level="10.6.3" data-path="clustering.html"><a href="clustering.html#cluster-bootstrapping"><i class="fa fa-check"></i><b>10.6.3</b> Evaluating cluster stability</a></li>
</ul></li>
<li class="chapter" data-level="10.7" data-path="clustering.html"><a href="clustering.html#subclustering"><i class="fa fa-check"></i><b>10.7</b> Subclustering</a></li>
<li class="chapter" data-level="" data-path="overview.html"><a href="overview.html#session-info"><i class="fa fa-check"></i>Session Info</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="marker-detection.html"><a href="marker-detection.html"><i class="fa fa-check"></i><b>11</b> Marker gene detection</a><ul>
<li class="chapter" data-level="11.1" data-path="normalization.html"><a href="normalization.html#motivation"><i class="fa fa-check"></i><b>11.1</b> Motivation</a></li>
<li class="chapter" data-level="11.2" data-path="marker-detection.html"><a href="marker-detection.html#pairwise-tests-between-clusters"><i class="fa fa-check"></i><b>11.2</b> Pairwise tests between clusters</a><ul>
<li class="chapter" data-level="11.2.1" data-path="dimensionality-reduction.html"><a href="dimensionality-reduction.html#motivation-1"><i class="fa fa-check"></i><b>11.2.1</b> Motivation</a></li>
<li class="chapter" data-level="11.2.2" data-path="marker-detection.html"><a href="marker-detection.html#combining-pairwise-statistics-per-cluster"><i class="fa fa-check"></i><b>11.2.2</b> Combining pairwise statistics per cluster</a></li>
<li class="chapter" data-level="11.2.3" data-path="marker-detection.html"><a href="marker-detection.html#using-the-log-fold-change"><i class="fa fa-check"></i><b>11.2.3</b> Using the log-fold change</a></li>
</ul></li>
<li class="chapter" data-level="11.3" data-path="marker-detection.html"><a href="marker-detection.html#marker-tests"><i class="fa fa-check"></i><b>11.3</b> Alternative testing regimes</a><ul>
<li class="chapter" data-level="11.3.1" data-path="marker-detection.html"><a href="marker-detection.html#using-the-wilcoxon-rank-sum-test"><i class="fa fa-check"></i><b>11.3.1</b> Using the Wilcoxon rank sum test</a></li>
<li class="chapter" data-level="11.3.2" data-path="marker-detection.html"><a href="marker-detection.html#using-a-binomial-test"><i class="fa fa-check"></i><b>11.3.2</b> Using a binomial test</a></li>
<li class="chapter" data-level="11.3.3" data-path="marker-detection.html"><a href="marker-detection.html#using-custom-de-methods"><i class="fa fa-check"></i><b>11.3.3</b> Using custom DE methods</a></li>
<li class="chapter" data-level="11.3.4" data-path="marker-detection.html"><a href="marker-detection.html#combining-multiple-marker-statistics"><i class="fa fa-check"></i><b>11.3.4</b> Combining multiple marker statistics</a></li>
</ul></li>
<li class="chapter" data-level="11.4" data-path="marker-detection.html"><a href="marker-detection.html#marker-batch"><i class="fa fa-check"></i><b>11.4</b> Handling blocking factors</a><ul>
<li class="chapter" data-level="11.4.1" data-path="marker-detection.html"><a href="marker-detection.html#using-the-block-argument"><i class="fa fa-check"></i><b>11.4.1</b> Using the <code>block=</code> argument</a></li>
<li class="chapter" data-level="11.4.2" data-path="marker-detection.html"><a href="marker-detection.html#using-the-design-argument"><i class="fa fa-check"></i><b>11.4.2</b> Using the <code>design=</code> argument</a></li>
</ul></li>
<li class="chapter" data-level="11.5" data-path="marker-detection.html"><a href="marker-detection.html#p-value-invalidity"><i class="fa fa-check"></i><b>11.5</b> Invalidity of <span class="math inline">\(p\)</span>-values</a><ul>
<li class="chapter" data-level="11.5.1" data-path="marker-detection.html"><a href="marker-detection.html#from-data-snooping"><i class="fa fa-check"></i><b>11.5.1</b> From data snooping</a></li>
<li class="chapter" data-level="11.5.2" data-path="marker-detection.html"><a href="marker-detection.html#false-replicates"><i class="fa fa-check"></i><b>11.5.2</b> Nature of replication</a></li>
</ul></li>
<li class="chapter" data-level="11.6" data-path="marker-detection.html"><a href="marker-detection.html#further-comments"><i class="fa fa-check"></i><b>11.6</b> Further comments</a></li>
<li class="chapter" data-level="" data-path="overview.html"><a href="overview.html#session-info"><i class="fa fa-check"></i>Session Info</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="cell-type-annotation.html"><a href="cell-type-annotation.html"><i class="fa fa-check"></i><b>12</b> Cell type annotation</a><ul>
<li class="chapter" data-level="12.1" data-path="normalization.html"><a href="normalization.html#motivation"><i class="fa fa-check"></i><b>12.1</b> Motivation</a></li>
<li class="chapter" data-level="12.2" data-path="cell-type-annotation.html"><a href="cell-type-annotation.html#assigning-cell-labels-from-reference-data"><i class="fa fa-check"></i><b>12.2</b> Assigning cell labels from reference data</a><ul>
<li class="chapter" data-level="12.2.1" data-path="overview.html"><a href="overview.html#overview"><i class="fa fa-check"></i><b>12.2.1</b> Overview</a></li>
<li class="chapter" data-level="12.2.2" data-path="cell-type-annotation.html"><a href="cell-type-annotation.html#using-existing-references"><i class="fa fa-check"></i><b>12.2.2</b> Using existing references</a></li>
<li class="chapter" data-level="12.2.3" data-path="cell-type-annotation.html"><a href="cell-type-annotation.html#using-custom-references"><i class="fa fa-check"></i><b>12.2.3</b> Using custom references</a></li>
</ul></li>
<li class="chapter" data-level="12.3" data-path="cell-type-annotation.html"><a href="cell-type-annotation.html#assigning-cell-labels-from-gene-sets"><i class="fa fa-check"></i><b>12.3</b> Assigning cell labels from gene sets</a></li>
<li class="chapter" data-level="12.4" data-path="cell-type-annotation.html"><a href="cell-type-annotation.html#assigning-cluster-labels-from-markers"><i class="fa fa-check"></i><b>12.4</b> Assigning cluster labels from markers</a></li>
<li class="chapter" data-level="12.5" data-path="cell-type-annotation.html"><a href="cell-type-annotation.html#computing-gene-set-activities"><i class="fa fa-check"></i><b>12.5</b> Computing gene set activities</a></li>
<li class="chapter" data-level="" data-path="overview.html"><a href="overview.html#session-info"><i class="fa fa-check"></i>Session Info</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="integrating-datasets.html"><a href="integrating-datasets.html"><i class="fa fa-check"></i><b>13</b> Integrating Datasets</a><ul>
<li class="chapter" data-level="13.1" data-path="normalization.html"><a href="normalization.html#motivation"><i class="fa fa-check"></i><b>13.1</b> Motivation</a></li>
<li class="chapter" data-level="13.2" data-path="integrating-datasets.html"><a href="integrating-datasets.html#setting-up-the-data"><i class="fa fa-check"></i><b>13.2</b> Setting up the data</a></li>
<li class="chapter" data-level="13.3" data-path="integrating-datasets.html"><a href="integrating-datasets.html#batch-diagnosis"><i class="fa fa-check"></i><b>13.3</b> Diagnosing batch effects</a></li>
<li class="chapter" data-level="13.4" data-path="integrating-datasets.html"><a href="integrating-datasets.html#linear-regression"><i class="fa fa-check"></i><b>13.4</b> Linear regression</a></li>
<li class="chapter" data-level="13.5" data-path="integrating-datasets.html"><a href="integrating-datasets.html#performing-mnn-correction"><i class="fa fa-check"></i><b>13.5</b> Performing MNN correction</a><ul>
<li class="chapter" data-level="13.5.1" data-path="integrating-datasets.html"><a href="integrating-datasets.html#algorithm-overview"><i class="fa fa-check"></i><b>13.5.1</b> Algorithm overview</a></li>
<li class="chapter" data-level="13.5.2" data-path="integrating-datasets.html"><a href="integrating-datasets.html#application-to-the-pbmc-data"><i class="fa fa-check"></i><b>13.5.2</b> Application to the PBMC data</a></li>
<li class="chapter" data-level="13.5.3" data-path="integrating-datasets.html"><a href="integrating-datasets.html#correction-diagnostics"><i class="fa fa-check"></i><b>13.5.3</b> Correction diagnostics</a></li>
</ul></li>
<li class="chapter" data-level="13.6" data-path="integrating-datasets.html"><a href="integrating-datasets.html#preserving-biological-heterogeneity"><i class="fa fa-check"></i><b>13.6</b> Preserving biological heterogeneity</a><ul>
<li class="chapter" data-level="13.6.1" data-path="integrating-datasets.html"><a href="integrating-datasets.html#comparison-to-within-batch-clusters"><i class="fa fa-check"></i><b>13.6.1</b> Comparison to within-batch clusters</a></li>
<li class="chapter" data-level="13.6.2" data-path="integrating-datasets.html"><a href="integrating-datasets.html#integration-with-markers"><i class="fa fa-check"></i><b>13.6.2</b> Encouraging consistency with marker genes</a></li>
</ul></li>
<li class="chapter" data-level="13.7" data-path="integrating-datasets.html"><a href="integrating-datasets.html#using-corrected-values"><i class="fa fa-check"></i><b>13.7</b> Using the corrected values</a></li>
<li class="chapter" data-level="" data-path="overview.html"><a href="overview.html#session-info"><i class="fa fa-check"></i>Session Info</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="multi-sample-comparisons.html"><a href="multi-sample-comparisons.html"><i class="fa fa-check"></i><b>14</b> Multi-sample comparisons</a><ul>
<li class="chapter" data-level="14.1" data-path="normalization.html"><a href="normalization.html#motivation"><i class="fa fa-check"></i><b>14.1</b> Motivation</a></li>
<li class="chapter" data-level="14.2" data-path="integrating-datasets.html"><a href="integrating-datasets.html#setting-up-the-data"><i class="fa fa-check"></i><b>14.2</b> Setting up the data</a></li>
<li class="chapter" data-level="14.3" data-path="multi-sample-comparisons.html"><a href="multi-sample-comparisons.html#differential-expression-between-conditions"><i class="fa fa-check"></i><b>14.3</b> Differential expression between conditions</a><ul>
<li class="chapter" data-level="14.3.1" data-path="multi-sample-comparisons.html"><a href="multi-sample-comparisons.html#creating-pseudo-bulk-samples"><i class="fa fa-check"></i><b>14.3.1</b> Creating pseudo-bulk samples</a></li>
<li class="chapter" data-level="14.3.2" data-path="multi-sample-comparisons.html"><a href="multi-sample-comparisons.html#performing-the-de-analysis"><i class="fa fa-check"></i><b>14.3.2</b> Performing the DE analysis</a></li>
<li class="chapter" data-level="14.3.3" data-path="multi-sample-comparisons.html"><a href="multi-sample-comparisons.html#putting-it-all-together"><i class="fa fa-check"></i><b>14.3.3</b> Putting it all together</a></li>
</ul></li>
<li class="chapter" data-level="14.4" data-path="multi-sample-comparisons.html"><a href="multi-sample-comparisons.html#ambient-problems"><i class="fa fa-check"></i><b>14.4</b> Avoiding problems with ambient RNA</a><ul>
<li class="chapter" data-level="14.4.1" data-path="dimensionality-reduction.html"><a href="dimensionality-reduction.html#motivation-1"><i class="fa fa-check"></i><b>14.4.1</b> Motivation</a></li>
<li class="chapter" data-level="14.4.2" data-path="multi-sample-comparisons.html"><a href="multi-sample-comparisons.html#finding-affected-degs"><i class="fa fa-check"></i><b>14.4.2</b> Finding affected DEGs</a></li>
<li class="chapter" data-level="14.4.3" data-path="multi-sample-comparisons.html"><a href="multi-sample-comparisons.html#subtracting-ambient-counts"><i class="fa fa-check"></i><b>14.4.3</b> Subtracting ambient counts</a></li>
</ul></li>
<li class="chapter" data-level="14.5" data-path="multi-sample-comparisons.html"><a href="multi-sample-comparisons.html#differential-abundance"><i class="fa fa-check"></i><b>14.5</b> Differential abundance between conditions</a><ul>
<li class="chapter" data-level="14.5.1" data-path="overview.html"><a href="overview.html#overview"><i class="fa fa-check"></i><b>14.5.1</b> Overview</a></li>
<li class="chapter" data-level="14.5.2" data-path="multi-sample-comparisons.html"><a href="multi-sample-comparisons.html#performing-the-da-analysis"><i class="fa fa-check"></i><b>14.5.2</b> Performing the DA analysis</a></li>
<li class="chapter" data-level="14.5.3" data-path="multi-sample-comparisons.html"><a href="multi-sample-comparisons.html#composition-effects"><i class="fa fa-check"></i><b>14.5.3</b> Handling composition effects</a></li>
</ul></li>
<li class="chapter" data-level="14.6" data-path="multi-sample-comparisons.html"><a href="multi-sample-comparisons.html#comments-on-interpretation"><i class="fa fa-check"></i><b>14.6</b> Comments on interpretation</a><ul>
<li class="chapter" data-level="14.6.1" data-path="multi-sample-comparisons.html"><a href="multi-sample-comparisons.html#de-da-duality"><i class="fa fa-check"></i><b>14.6.1</b> DE or DA? Two sides of the same coin</a></li>
<li class="chapter" data-level="14.6.2" data-path="multi-sample-comparisons.html"><a href="multi-sample-comparisons.html#sacrificing-differences"><i class="fa fa-check"></i><b>14.6.2</b> Sacrificing biology by integration</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="overview.html"><a href="overview.html#session-info"><i class="fa fa-check"></i>Session Info</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="droplet-processing.html"><a href="droplet-processing.html"><i class="fa fa-check"></i><b>15</b> Droplet processing</a><ul>
<li class="chapter" data-level="15.1" data-path="normalization.html"><a href="normalization.html#motivation"><i class="fa fa-check"></i><b>15.1</b> Motivation</a></li>
<li class="chapter" data-level="15.2" data-path="droplet-processing.html"><a href="droplet-processing.html#qc-droplets"><i class="fa fa-check"></i><b>15.2</b> Calling cells from empty droplets</a><ul>
<li class="chapter" data-level="15.2.1" data-path="data-infrastructure.html"><a href="data-infrastructure.html#background"><i class="fa fa-check"></i><b>15.2.1</b> Background</a></li>
<li class="chapter" data-level="15.2.2" data-path="droplet-processing.html"><a href="droplet-processing.html#testing-for-empty-droplets"><i class="fa fa-check"></i><b>15.2.2</b> Testing for empty droplets</a></li>
<li class="chapter" data-level="15.2.3" data-path="droplet-processing.html"><a href="droplet-processing.html#relationship-with-other-qc-metrics"><i class="fa fa-check"></i><b>15.2.3</b> Relationship with other QC metrics</a></li>
</ul></li>
<li class="chapter" data-level="15.3" data-path="droplet-processing.html"><a href="droplet-processing.html#cell-hashing"><i class="fa fa-check"></i><b>15.3</b> Demultiplexing cell hashes</a><ul>
<li class="chapter" data-level="15.3.1" data-path="data-infrastructure.html"><a href="data-infrastructure.html#background-1"><i class="fa fa-check"></i><b>15.3.1</b> Background</a></li>
<li class="chapter" data-level="15.3.2" data-path="droplet-processing.html"><a href="droplet-processing.html#cell-calling-options"><i class="fa fa-check"></i><b>15.3.2</b> Cell calling options</a></li>
<li class="chapter" data-level="15.3.3" data-path="droplet-processing.html"><a href="droplet-processing.html#demultiplexing-on-hto-abundance"><i class="fa fa-check"></i><b>15.3.3</b> Demultiplexing on HTO abundance</a></li>
</ul></li>
<li class="chapter" data-level="15.4" data-path="marker-detection.html"><a href="marker-detection.html#further-comments"><i class="fa fa-check"></i><b>15.4</b> Further comments</a></li>
<li class="chapter" data-level="" data-path="overview.html"><a href="overview.html#session-info"><i class="fa fa-check"></i>Session Info</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="doublet-detection.html"><a href="doublet-detection.html"><i class="fa fa-check"></i><b>16</b> Doublet detection</a><ul>
<li class="chapter" data-level="16.1" data-path="overview.html"><a href="overview.html#overview"><i class="fa fa-check"></i><b>16.1</b> Overview</a></li>
<li class="chapter" data-level="16.2" data-path="doublet-detection.html"><a href="doublet-detection.html#doublet-detection-with-clusters"><i class="fa fa-check"></i><b>16.2</b> Doublet detection with clusters</a></li>
<li class="chapter" data-level="16.3" data-path="doublet-detection.html"><a href="doublet-detection.html#doublet-simulation"><i class="fa fa-check"></i><b>16.3</b> Doublet detection by simulation</a></li>
<li class="chapter" data-level="16.4" data-path="doublet-detection.html"><a href="doublet-detection.html#doublet-detection-in-multiplexed-experiments"><i class="fa fa-check"></i><b>16.4</b> Doublet detection in multiplexed experiments</a><ul>
<li class="chapter" data-level="16.4.1" data-path="data-infrastructure.html"><a href="data-infrastructure.html#background"><i class="fa fa-check"></i><b>16.4.1</b> Background</a></li>
<li class="chapter" data-level="16.4.2" data-path="doublet-detection.html"><a href="doublet-detection.html#identifying-inter-sample-doublets"><i class="fa fa-check"></i><b>16.4.2</b> Identifying inter-sample doublets</a></li>
<li class="chapter" data-level="16.4.3" data-path="doublet-detection.html"><a href="doublet-detection.html#guilt-by-association-for-unmarked-doublets"><i class="fa fa-check"></i><b>16.4.3</b> Guilt by association for unmarked doublets</a></li>
</ul></li>
<li class="chapter" data-level="16.5" data-path="marker-detection.html"><a href="marker-detection.html#further-comments"><i class="fa fa-check"></i><b>16.5</b> Further comments</a></li>
<li class="chapter" data-level="" data-path="overview.html"><a href="overview.html#session-info"><i class="fa fa-check"></i>Session Info</a></li>
</ul></li>
<li class="chapter" data-level="17" data-path="cell-cycle-assignment.html"><a href="cell-cycle-assignment.html"><i class="fa fa-check"></i><b>17</b> Cell cycle assignment</a><ul>
<li class="chapter" data-level="17.1" data-path="normalization.html"><a href="normalization.html#motivation"><i class="fa fa-check"></i><b>17.1</b> Motivation</a></li>
<li class="chapter" data-level="17.2" data-path="cell-cycle-assignment.html"><a href="cell-cycle-assignment.html#using-the-cyclins"><i class="fa fa-check"></i><b>17.2</b> Using the cyclins</a></li>
<li class="chapter" data-level="17.3" data-path="cell-cycle-assignment.html"><a href="cell-cycle-assignment.html#using-reference-profiles"><i class="fa fa-check"></i><b>17.3</b> Using reference profiles</a></li>
<li class="chapter" data-level="17.4" data-path="cell-cycle-assignment.html"><a href="cell-cycle-assignment.html#using-the-cyclone-classifier"><i class="fa fa-check"></i><b>17.4</b> Using the <code>cyclone()</code> classifier</a></li>
<li class="chapter" data-level="17.5" data-path="cell-cycle-assignment.html"><a href="cell-cycle-assignment.html#removing-cell-cycle-effects"><i class="fa fa-check"></i><b>17.5</b> Removing cell cycle effects</a><ul>
<li class="chapter" data-level="17.5.1" data-path="cell-cycle-assignment.html"><a href="cell-cycle-assignment.html#comments"><i class="fa fa-check"></i><b>17.5.1</b> Comments</a></li>
<li class="chapter" data-level="17.5.2" data-path="cell-cycle-assignment.html"><a href="cell-cycle-assignment.html#with-linear-regression-and-friends"><i class="fa fa-check"></i><b>17.5.2</b> With linear regression and friends</a></li>
<li class="chapter" data-level="17.5.3" data-path="cell-cycle-assignment.html"><a href="cell-cycle-assignment.html#removing-cell-cycle-related-genes"><i class="fa fa-check"></i><b>17.5.3</b> Removing cell cycle-related genes</a></li>
<li class="chapter" data-level="17.5.4" data-path="cell-cycle-assignment.html"><a href="cell-cycle-assignment.html#using-contrastive-pca"><i class="fa fa-check"></i><b>17.5.4</b> Using contrastive PCA</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="overview.html"><a href="overview.html#session-info"><i class="fa fa-check"></i>Session Info</a></li>
</ul></li>
<li class="chapter" data-level="18" data-path="trajectory-analysis.html"><a href="trajectory-analysis.html"><i class="fa fa-check"></i><b>18</b> Trajectory Analysis</a><ul>
<li class="chapter" data-level="18.1" data-path="overview.html"><a href="overview.html#overview"><i class="fa fa-check"></i><b>18.1</b> Overview</a></li>
<li class="chapter" data-level="18.2" data-path="trajectory-analysis.html"><a href="trajectory-analysis.html#obtaining-pseudotime-orderings"><i class="fa fa-check"></i><b>18.2</b> Obtaining pseudotime orderings</a><ul>
<li class="chapter" data-level="18.2.1" data-path="trajectory-analysis.html"><a href="trajectory-analysis.html#overview-1"><i class="fa fa-check"></i><b>18.2.1</b> Overview</a></li>
<li class="chapter" data-level="18.2.2" data-path="trajectory-analysis.html"><a href="trajectory-analysis.html#cluster-based-minimum-spanning-tree"><i class="fa fa-check"></i><b>18.2.2</b> Cluster-based minimum spanning tree</a></li>
<li class="chapter" data-level="18.2.3" data-path="trajectory-analysis.html"><a href="trajectory-analysis.html#principal-curves"><i class="fa fa-check"></i><b>18.2.3</b> Principal curves</a></li>
</ul></li>
<li class="chapter" data-level="18.3" data-path="trajectory-analysis.html"><a href="trajectory-analysis.html#characterizing-trajectories"><i class="fa fa-check"></i><b>18.3</b> Characterizing trajectories</a><ul>
<li class="chapter" data-level="18.3.1" data-path="trajectory-analysis.html"><a href="trajectory-analysis.html#overview-2"><i class="fa fa-check"></i><b>18.3.1</b> Overview</a></li>
<li class="chapter" data-level="18.3.2" data-path="trajectory-analysis.html"><a href="trajectory-analysis.html#changes-along-a-trajectory"><i class="fa fa-check"></i><b>18.3.2</b> Changes along a trajectory</a></li>
<li class="chapter" data-level="18.3.3" data-path="trajectory-analysis.html"><a href="trajectory-analysis.html#changes-between-paths"><i class="fa fa-check"></i><b>18.3.3</b> Changes between paths</a></li>
<li class="chapter" data-level="18.3.4" data-path="marker-detection.html"><a href="marker-detection.html#further-comments"><i class="fa fa-check"></i><b>18.3.4</b> Further comments</a></li>
</ul></li>
<li class="chapter" data-level="18.4" data-path="trajectory-analysis.html"><a href="trajectory-analysis.html#finding-the-root"><i class="fa fa-check"></i><b>18.4</b> Finding the root</a><ul>
<li class="chapter" data-level="18.4.1" data-path="trajectory-analysis.html"><a href="trajectory-analysis.html#overview-3"><i class="fa fa-check"></i><b>18.4.1</b> Overview</a></li>
<li class="chapter" data-level="18.4.2" data-path="trajectory-analysis.html"><a href="trajectory-analysis.html#entropy-based-methods"><i class="fa fa-check"></i><b>18.4.2</b> Entropy-based methods</a></li>
<li class="chapter" data-level="18.4.3" data-path="trajectory-analysis.html"><a href="trajectory-analysis.html#rna-velocity"><i class="fa fa-check"></i><b>18.4.3</b> RNA velocity</a></li>
<li class="chapter" data-level="18.4.4" data-path="trajectory-analysis.html"><a href="trajectory-analysis.html#real-timepoints"><i class="fa fa-check"></i><b>18.4.4</b> Real timepoints</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="trajectory-analysis.html"><a href="trajectory-analysis.html#session-information"><i class="fa fa-check"></i>Session information</a></li>
</ul></li>
<li class="chapter" data-level="19" data-path="single-nuclei-rna-seq-processing.html"><a href="single-nuclei-rna-seq-processing.html"><i class="fa fa-check"></i><b>19</b> Single-nuclei RNA-seq processing</a><ul>
<li class="chapter" data-level="19.1" data-path="introduction.html"><a href="introduction.html#introduction"><i class="fa fa-check"></i><b>19.1</b> Introduction</a></li>
<li class="chapter" data-level="19.2" data-path="single-nuclei-rna-seq-processing.html"><a href="single-nuclei-rna-seq-processing.html#quality-control-for-stripped-nuclei"><i class="fa fa-check"></i><b>19.2</b> Quality control for stripped nuclei</a></li>
<li class="chapter" data-level="19.3" data-path="single-nuclei-rna-seq-processing.html"><a href="single-nuclei-rna-seq-processing.html#comments-on-downstream-analyses"><i class="fa fa-check"></i><b>19.3</b> Comments on downstream analyses</a></li>
<li class="chapter" data-level="19.4" data-path="single-nuclei-rna-seq-processing.html"><a href="single-nuclei-rna-seq-processing.html#tricks-with-ambient-contamination"><i class="fa fa-check"></i><b>19.4</b> Tricks with ambient contamination</a></li>
<li class="chapter" data-level="" data-path="overview.html"><a href="overview.html#session-info"><i class="fa fa-check"></i>Session Info</a></li>
</ul></li>
<li class="chapter" data-level="20" data-path="integrating-with-protein-abundance.html"><a href="integrating-with-protein-abundance.html"><i class="fa fa-check"></i><b>20</b> Integrating with protein abundance</a><ul>
<li class="chapter" data-level="20.1" data-path="normalization.html"><a href="normalization.html#motivation"><i class="fa fa-check"></i><b>20.1</b> Motivation</a></li>
<li class="chapter" data-level="20.2" data-path="integrating-with-protein-abundance.html"><a href="integrating-with-protein-abundance.html#preprocessing"><i class="fa fa-check"></i><b>20.2</b> Preprocessing</a><ul>
<li class="chapter" data-level="20.2.1" data-path="integrating-datasets.html"><a href="integrating-datasets.html#setting-up-the-data"><i class="fa fa-check"></i><b>20.2.1</b> Setting up the data</a></li>
<li class="chapter" data-level="20.2.2" data-path="quality-control.html"><a href="quality-control.html#quality-control"><i class="fa fa-check"></i><b>20.2.2</b> Quality control</a></li>
<li class="chapter" data-level="20.2.3" data-path="normalization.html"><a href="normalization.html#normalization"><i class="fa fa-check"></i><b>20.2.3</b> Normalization</a></li>
</ul></li>
<li class="chapter" data-level="20.3" data-path="integrating-with-protein-abundance.html"><a href="integrating-with-protein-abundance.html#clustering-and-interpretation"><i class="fa fa-check"></i><b>20.3</b> Clustering and interpretation</a></li>
<li class="chapter" data-level="20.4" data-path="integrating-with-protein-abundance.html"><a href="integrating-with-protein-abundance.html#integration-with-gene-expression-data"><i class="fa fa-check"></i><b>20.4</b> Integration with gene expression data</a><ul>
<li class="chapter" data-level="20.4.1" data-path="integrating-with-protein-abundance.html"><a href="integrating-with-protein-abundance.html#by-subclustering"><i class="fa fa-check"></i><b>20.4.1</b> By subclustering</a></li>
<li class="chapter" data-level="20.4.2" data-path="integrating-with-protein-abundance.html"><a href="integrating-with-protein-abundance.html#by-combined-clustering"><i class="fa fa-check"></i><b>20.4.2</b> By combined clustering</a></li>
<li class="chapter" data-level="20.4.3" data-path="integrating-with-protein-abundance.html"><a href="integrating-with-protein-abundance.html#by-differential-testing"><i class="fa fa-check"></i><b>20.4.3</b> By differential testing</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="overview.html"><a href="overview.html#session-info"><i class="fa fa-check"></i>Session Info</a></li>
</ul></li>
<li class="chapter" data-level="21" data-path="repertoire-seq.html"><a href="repertoire-seq.html"><i class="fa fa-check"></i><b>21</b> Analyzing repertoire sequencing data</a><ul>
<li class="chapter" data-level="21.1" data-path="normalization.html"><a href="normalization.html#motivation"><i class="fa fa-check"></i><b>21.1</b> Motivation</a></li>
<li class="chapter" data-level="21.2" data-path="repertoire-seq.html"><a href="repertoire-seq.html#loading-the-tcr-repertoire"><i class="fa fa-check"></i><b>21.2</b> Loading the TCR repertoire</a></li>
<li class="chapter" data-level="21.3" data-path="repertoire-seq.html"><a href="repertoire-seq.html#leveraging-list-semantics"><i class="fa fa-check"></i><b>21.3</b> Leveraging <code>List</code> semantics</a></li>
<li class="chapter" data-level="21.4" data-path="repertoire-seq.html"><a href="repertoire-seq.html#converting-back-to-dataframes"><i class="fa fa-check"></i><b>21.4</b> Converting back to <code>DataFrame</code>s</a></li>
<li class="chapter" data-level="21.5" data-path="repertoire-seq.html"><a href="repertoire-seq.html#case-study-for-clonotype-analyses"><i class="fa fa-check"></i><b>21.5</b> Case study for clonotype analyses</a></li>
<li class="chapter" data-level="21.6" data-path="repertoire-seq.html"><a href="repertoire-seq.html#repeating-for-immunoglobulins"><i class="fa fa-check"></i><b>21.6</b> Repeating for immunoglobulins</a></li>
<li class="chapter" data-level="" data-path="overview.html"><a href="overview.html#session-info"><i class="fa fa-check"></i>Session Info</a></li>
</ul></li>
<li class="chapter" data-level="22" data-path="interactive-sharing.html"><a href="interactive-sharing.html"><i class="fa fa-check"></i><b>22</b> Interactive data exploration</a><ul>
<li class="chapter" data-level="22.1" data-path="normalization.html"><a href="normalization.html#motivation"><i class="fa fa-check"></i><b>22.1</b> Motivation</a></li>
<li class="chapter" data-level="22.2" data-path="interactive-sharing.html"><a href="interactive-sharing.html#interactive-quickstart"><i class="fa fa-check"></i><b>22.2</b> Quick start</a></li>
<li class="chapter" data-level="22.3" data-path="interactive-sharing.html"><a href="interactive-sharing.html#isee-examples"><i class="fa fa-check"></i><b>22.3</b> Usage examples</a><ul>
<li class="chapter" data-level="22.3.1" data-path="quality-control.html"><a href="quality-control.html#quality-control"><i class="fa fa-check"></i><b>22.3.1</b> Quality control</a></li>
<li class="chapter" data-level="22.3.2" data-path="interactive-sharing.html"><a href="interactive-sharing.html#annotation-of-cell-populations"><i class="fa fa-check"></i><b>22.3.2</b> Annotation of cell populations</a></li>
<li class="chapter" data-level="22.3.3" data-path="interactive-sharing.html"><a href="interactive-sharing.html#querying-features-of-interest"><i class="fa fa-check"></i><b>22.3.3</b> Querying features of interest</a></li>
</ul></li>
<li class="chapter" data-level="22.4" data-path="interactive-sharing.html"><a href="interactive-sharing.html#reproducible-visualizations"><i class="fa fa-check"></i><b>22.4</b> Reproducible visualizations</a></li>
<li class="chapter" data-level="22.5" data-path="interactive-sharing.html"><a href="interactive-sharing.html#dissemination"><i class="fa fa-check"></i><b>22.5</b> Dissemination of analysis results</a></li>
<li class="chapter" data-level="22.6" data-path="interactive-sharing.html"><a href="interactive-sharing.html#additional-resources"><i class="fa fa-check"></i><b>22.6</b> Additional resources</a></li>
<li class="chapter" data-level="" data-path="overview.html"><a href="overview.html#session-info"><i class="fa fa-check"></i>Session Info</a></li>
</ul></li>
<li class="chapter" data-level="23" data-path="dealing-with-big-data.html"><a href="dealing-with-big-data.html"><i class="fa fa-check"></i><b>23</b> Dealing with big data</a><ul>
<li class="chapter" data-level="23.1" data-path="normalization.html"><a href="normalization.html#motivation"><i class="fa fa-check"></i><b>23.1</b> Motivation</a></li>
<li class="chapter" data-level="23.2" data-path="dealing-with-big-data.html"><a href="dealing-with-big-data.html#fast-approximations"><i class="fa fa-check"></i><b>23.2</b> Fast approximations</a><ul>
<li class="chapter" data-level="23.2.1" data-path="dealing-with-big-data.html"><a href="dealing-with-big-data.html#nearest-neighbor-searching"><i class="fa fa-check"></i><b>23.2.1</b> Nearest neighbor searching</a></li>
<li class="chapter" data-level="23.2.2" data-path="dealing-with-big-data.html"><a href="dealing-with-big-data.html#big-data-svd"><i class="fa fa-check"></i><b>23.2.2</b> Singular value decomposition</a></li>
</ul></li>
<li class="chapter" data-level="23.3" data-path="dealing-with-big-data.html"><a href="dealing-with-big-data.html#parallelization"><i class="fa fa-check"></i><b>23.3</b> Parallelization</a></li>
<li class="chapter" data-level="23.4" data-path="dealing-with-big-data.html"><a href="dealing-with-big-data.html#out-of-memory-representations"><i class="fa fa-check"></i><b>23.4</b> Out of memory representations</a></li>
<li class="chapter" data-level="" data-path="overview.html"><a href="overview.html#session-info"><i class="fa fa-check"></i>Session Info</a></li>
</ul></li>
<li class="chapter" data-level="24" data-path="interoperability.html"><a href="interoperability.html"><i class="fa fa-check"></i><b>24</b> Interoperability</a><ul>
<li class="chapter" data-level="24.1" data-path="normalization.html"><a href="normalization.html#motivation"><i class="fa fa-check"></i><b>24.1</b> Motivation</a></li>
<li class="chapter" data-level="24.2" data-path="interoperability.html"><a href="interoperability.html#interchanging-with-seurat"><i class="fa fa-check"></i><b>24.2</b> Interchanging with <em>Seurat</em></a></li>
<li class="chapter" data-level="24.3" data-path="interoperability.html"><a href="interoperability.html#interchanging-with-scanpy"><i class="fa fa-check"></i><b>24.3</b> Interchanging with <em>scanpy</em></a></li>
<li class="chapter" data-level="" data-path="overview.html"><a href="overview.html#session-info"><i class="fa fa-check"></i>Session Info</a></li>
</ul></li>
<li class="part"><span><b>III Workflows</b></span></li>
<li class="chapter" data-level="25" data-path="lun-416b-cell-line-smart-seq2.html"><a href="lun-416b-cell-line-smart-seq2.html"><i class="fa fa-check"></i><b>25</b> Lun 416B cell line (Smart-seq2)</a><ul>
<li class="chapter" data-level="25.1" data-path="introduction.html"><a href="introduction.html#introduction"><i class="fa fa-check"></i><b>25.1</b> Introduction</a></li>
<li class="chapter" data-level="25.2" data-path="lun-416b-cell-line-smart-seq2.html"><a href="lun-416b-cell-line-smart-seq2.html#data-loading"><i class="fa fa-check"></i><b>25.2</b> Data loading</a></li>
<li class="chapter" data-level="25.3" data-path="quality-control.html"><a href="quality-control.html#quality-control"><i class="fa fa-check"></i><b>25.3</b> Quality control</a></li>
<li class="chapter" data-level="25.4" data-path="normalization.html"><a href="normalization.html#normalization"><i class="fa fa-check"></i><b>25.4</b> Normalization</a></li>
<li class="chapter" data-level="25.5" data-path="lun-416b-cell-line-smart-seq2.html"><a href="lun-416b-cell-line-smart-seq2.html#variance-modelling"><i class="fa fa-check"></i><b>25.5</b> Variance modelling</a></li>
<li class="chapter" data-level="25.6" data-path="lun-416b-cell-line-smart-seq2.html"><a href="lun-416b-cell-line-smart-seq2.html#batch-correction"><i class="fa fa-check"></i><b>25.6</b> Batch correction</a></li>
<li class="chapter" data-level="25.7" data-path="dimensionality-reduction.html"><a href="dimensionality-reduction.html#dimensionality-reduction"><i class="fa fa-check"></i><b>25.7</b> Dimensionality reduction</a></li>
<li class="chapter" data-level="25.8" data-path="clustering.html"><a href="clustering.html#clustering"><i class="fa fa-check"></i><b>25.8</b> Clustering</a></li>
<li class="chapter" data-level="25.9" data-path="lun-416b-cell-line-smart-seq2.html"><a href="lun-416b-cell-line-smart-seq2.html#interpretation"><i class="fa fa-check"></i><b>25.9</b> Interpretation</a></li>
<li class="chapter" data-level="" data-path="overview.html"><a href="overview.html#session-info"><i class="fa fa-check"></i>Session Info</a></li>
</ul></li>
<li class="chapter" data-level="26" data-path="zeisel-mouse-brain-strt-seq.html"><a href="zeisel-mouse-brain-strt-seq.html"><i class="fa fa-check"></i><b>26</b> Zeisel mouse brain (STRT-Seq)</a><ul>
<li class="chapter" data-level="26.1" data-path="introduction.html"><a href="introduction.html#introduction"><i class="fa fa-check"></i><b>26.1</b> Introduction</a></li>
<li class="chapter" data-level="26.2" data-path="lun-416b-cell-line-smart-seq2.html"><a href="lun-416b-cell-line-smart-seq2.html#data-loading"><i class="fa fa-check"></i><b>26.2</b> Data loading</a></li>
<li class="chapter" data-level="26.3" data-path="quality-control.html"><a href="quality-control.html#quality-control"><i class="fa fa-check"></i><b>26.3</b> Quality control</a></li>
<li class="chapter" data-level="26.4" data-path="normalization.html"><a href="normalization.html#normalization"><i class="fa fa-check"></i><b>26.4</b> Normalization</a></li>
<li class="chapter" data-level="26.5" data-path="lun-416b-cell-line-smart-seq2.html"><a href="lun-416b-cell-line-smart-seq2.html#variance-modelling"><i class="fa fa-check"></i><b>26.5</b> Variance modelling</a></li>
<li class="chapter" data-level="26.6" data-path="dimensionality-reduction.html"><a href="dimensionality-reduction.html#dimensionality-reduction"><i class="fa fa-check"></i><b>26.6</b> Dimensionality reduction</a></li>
<li class="chapter" data-level="26.7" data-path="clustering.html"><a href="clustering.html#clustering"><i class="fa fa-check"></i><b>26.7</b> Clustering</a></li>
<li class="chapter" data-level="26.8" data-path="lun-416b-cell-line-smart-seq2.html"><a href="lun-416b-cell-line-smart-seq2.html#interpretation"><i class="fa fa-check"></i><b>26.8</b> Interpretation</a></li>
<li class="chapter" data-level="" data-path="overview.html"><a href="overview.html#session-info"><i class="fa fa-check"></i>Session Info</a></li>
</ul></li>
<li class="chapter" data-level="27" data-path="unfiltered-human-pbmcs-10x-genomics.html"><a href="unfiltered-human-pbmcs-10x-genomics.html"><i class="fa fa-check"></i><b>27</b> Unfiltered human PBMCs (10X Genomics)</a><ul>
<li class="chapter" data-level="27.1" data-path="introduction.html"><a href="introduction.html#introduction"><i class="fa fa-check"></i><b>27.1</b> Introduction</a></li>
<li class="chapter" data-level="27.2" data-path="lun-416b-cell-line-smart-seq2.html"><a href="lun-416b-cell-line-smart-seq2.html#data-loading"><i class="fa fa-check"></i><b>27.2</b> Data loading</a></li>
<li class="chapter" data-level="27.3" data-path="quality-control.html"><a href="quality-control.html#quality-control"><i class="fa fa-check"></i><b>27.3</b> Quality control</a></li>
<li class="chapter" data-level="27.4" data-path="normalization.html"><a href="normalization.html#normalization"><i class="fa fa-check"></i><b>27.4</b> Normalization</a></li>
<li class="chapter" data-level="27.5" data-path="lun-416b-cell-line-smart-seq2.html"><a href="lun-416b-cell-line-smart-seq2.html#variance-modelling"><i class="fa fa-check"></i><b>27.5</b> Variance modelling</a></li>
<li class="chapter" data-level="27.6" data-path="dimensionality-reduction.html"><a href="dimensionality-reduction.html#dimensionality-reduction"><i class="fa fa-check"></i><b>27.6</b> Dimensionality reduction</a></li>
<li class="chapter" data-level="27.7" data-path="clustering.html"><a href="clustering.html#clustering"><i class="fa fa-check"></i><b>27.7</b> Clustering</a></li>
<li class="chapter" data-level="27.8" data-path="lun-416b-cell-line-smart-seq2.html"><a href="lun-416b-cell-line-smart-seq2.html#interpretation"><i class="fa fa-check"></i><b>27.8</b> Interpretation</a></li>
<li class="chapter" data-level="" data-path="overview.html"><a href="overview.html#session-info"><i class="fa fa-check"></i>Session Info</a></li>
</ul></li>
<li class="chapter" data-level="28" data-path="filtered-human-pbmcs-10x-genomics.html"><a href="filtered-human-pbmcs-10x-genomics.html"><i class="fa fa-check"></i><b>28</b> Filtered human PBMCs (10X Genomics)</a><ul>
<li class="chapter" data-level="28.1" data-path="introduction.html"><a href="introduction.html#introduction"><i class="fa fa-check"></i><b>28.1</b> Introduction</a></li>
<li class="chapter" data-level="28.2" data-path="lun-416b-cell-line-smart-seq2.html"><a href="lun-416b-cell-line-smart-seq2.html#data-loading"><i class="fa fa-check"></i><b>28.2</b> Data loading</a></li>
<li class="chapter" data-level="28.3" data-path="quality-control.html"><a href="quality-control.html#quality-control"><i class="fa fa-check"></i><b>28.3</b> Quality control</a></li>
<li class="chapter" data-level="28.4" data-path="normalization.html"><a href="normalization.html#normalization"><i class="fa fa-check"></i><b>28.4</b> Normalization</a></li>
<li class="chapter" data-level="28.5" data-path="lun-416b-cell-line-smart-seq2.html"><a href="lun-416b-cell-line-smart-seq2.html#variance-modelling"><i class="fa fa-check"></i><b>28.5</b> Variance modelling</a></li>
<li class="chapter" data-level="28.6" data-path="dimensionality-reduction.html"><a href="dimensionality-reduction.html#dimensionality-reduction"><i class="fa fa-check"></i><b>28.6</b> Dimensionality reduction</a></li>
<li class="chapter" data-level="28.7" data-path="clustering.html"><a href="clustering.html#clustering"><i class="fa fa-check"></i><b>28.7</b> Clustering</a></li>
<li class="chapter" data-level="28.8" data-path="filtered-human-pbmcs-10x-genomics.html"><a href="filtered-human-pbmcs-10x-genomics.html#data-integration"><i class="fa fa-check"></i><b>28.8</b> Data integration</a></li>
<li class="chapter" data-level="" data-path="overview.html"><a href="overview.html#session-info"><i class="fa fa-check"></i>Session Info</a></li>
</ul></li>
<li class="chapter" data-level="29" data-path="human-pbmc-with-surface-proteins-10x-genomics.html"><a href="human-pbmc-with-surface-proteins-10x-genomics.html"><i class="fa fa-check"></i><b>29</b> Human PBMC with surface proteins (10X Genomics)</a><ul>
<li class="chapter" data-level="29.1" data-path="introduction.html"><a href="introduction.html#introduction"><i class="fa fa-check"></i><b>29.1</b> Introduction</a></li>
<li class="chapter" data-level="29.2" data-path="lun-416b-cell-line-smart-seq2.html"><a href="lun-416b-cell-line-smart-seq2.html#data-loading"><i class="fa fa-check"></i><b>29.2</b> Data loading</a></li>
<li class="chapter" data-level="29.3" data-path="quality-control.html"><a href="quality-control.html#quality-control"><i class="fa fa-check"></i><b>29.3</b> Quality control</a></li>
<li class="chapter" data-level="29.4" data-path="normalization.html"><a href="normalization.html#normalization"><i class="fa fa-check"></i><b>29.4</b> Normalization</a></li>
<li class="chapter" data-level="29.5" data-path="dimensionality-reduction.html"><a href="dimensionality-reduction.html#dimensionality-reduction"><i class="fa fa-check"></i><b>29.5</b> Dimensionality reduction</a></li>
<li class="chapter" data-level="29.6" data-path="clustering.html"><a href="clustering.html#clustering"><i class="fa fa-check"></i><b>29.6</b> Clustering</a></li>
<li class="chapter" data-level="" data-path="overview.html"><a href="overview.html#session-info"><i class="fa fa-check"></i>Session Info</a></li>
</ul></li>
<li class="chapter" data-level="30" data-path="grun-human-pancreas-cel-seq2.html"><a href="grun-human-pancreas-cel-seq2.html"><i class="fa fa-check"></i><b>30</b> Grun human pancreas (CEL-seq2)</a><ul>
<li class="chapter" data-level="30.1" data-path="introduction.html"><a href="introduction.html#introduction"><i class="fa fa-check"></i><b>30.1</b> Introduction</a></li>
<li class="chapter" data-level="30.2" data-path="lun-416b-cell-line-smart-seq2.html"><a href="lun-416b-cell-line-smart-seq2.html#data-loading"><i class="fa fa-check"></i><b>30.2</b> Data loading</a></li>
<li class="chapter" data-level="30.3" data-path="quality-control.html"><a href="quality-control.html#quality-control"><i class="fa fa-check"></i><b>30.3</b> Quality control</a></li>
<li class="chapter" data-level="30.4" data-path="normalization.html"><a href="normalization.html#normalization"><i class="fa fa-check"></i><b>30.4</b> Normalization</a></li>
<li class="chapter" data-level="30.5" data-path="lun-416b-cell-line-smart-seq2.html"><a href="lun-416b-cell-line-smart-seq2.html#variance-modelling"><i class="fa fa-check"></i><b>30.5</b> Variance modelling</a></li>
<li class="chapter" data-level="30.6" data-path="filtered-human-pbmcs-10x-genomics.html"><a href="filtered-human-pbmcs-10x-genomics.html#data-integration"><i class="fa fa-check"></i><b>30.6</b> Data integration</a></li>
<li class="chapter" data-level="30.7" data-path="dimensionality-reduction.html"><a href="dimensionality-reduction.html#dimensionality-reduction"><i class="fa fa-check"></i><b>30.7</b> Dimensionality reduction</a></li>
<li class="chapter" data-level="30.8" data-path="clustering.html"><a href="clustering.html#clustering"><i class="fa fa-check"></i><b>30.8</b> Clustering</a></li>
<li class="chapter" data-level="" data-path="overview.html"><a href="overview.html#session-info"><i class="fa fa-check"></i>Session Info</a></li>
</ul></li>
<li class="chapter" data-level="31" data-path="muraro-human-pancreas-cel-seq.html"><a href="muraro-human-pancreas-cel-seq.html"><i class="fa fa-check"></i><b>31</b> Muraro human pancreas (CEL-seq)</a><ul>
<li class="chapter" data-level="31.1" data-path="introduction.html"><a href="introduction.html#introduction"><i class="fa fa-check"></i><b>31.1</b> Introduction</a></li>
<li class="chapter" data-level="31.2" data-path="lun-416b-cell-line-smart-seq2.html"><a href="lun-416b-cell-line-smart-seq2.html#data-loading"><i class="fa fa-check"></i><b>31.2</b> Data loading</a></li>
<li class="chapter" data-level="31.3" data-path="quality-control.html"><a href="quality-control.html#quality-control"><i class="fa fa-check"></i><b>31.3</b> Quality control</a></li>
<li class="chapter" data-level="31.4" data-path="normalization.html"><a href="normalization.html#normalization"><i class="fa fa-check"></i><b>31.4</b> Normalization</a></li>
<li class="chapter" data-level="31.5" data-path="lun-416b-cell-line-smart-seq2.html"><a href="lun-416b-cell-line-smart-seq2.html#variance-modelling"><i class="fa fa-check"></i><b>31.5</b> Variance modelling</a></li>
<li class="chapter" data-level="31.6" data-path="filtered-human-pbmcs-10x-genomics.html"><a href="filtered-human-pbmcs-10x-genomics.html#data-integration"><i class="fa fa-check"></i><b>31.6</b> Data integration</a></li>
<li class="chapter" data-level="31.7" data-path="dimensionality-reduction.html"><a href="dimensionality-reduction.html#dimensionality-reduction"><i class="fa fa-check"></i><b>31.7</b> Dimensionality reduction</a></li>
<li class="chapter" data-level="31.8" data-path="clustering.html"><a href="clustering.html#clustering"><i class="fa fa-check"></i><b>31.8</b> Clustering</a></li>
<li class="chapter" data-level="" data-path="overview.html"><a href="overview.html#session-info"><i class="fa fa-check"></i>Session Info</a></li>
</ul></li>
<li class="chapter" data-level="32" data-path="lawlor-human-pancreas-smarter.html"><a href="lawlor-human-pancreas-smarter.html"><i class="fa fa-check"></i><b>32</b> Lawlor human pancreas (SMARTer)</a><ul>
<li class="chapter" data-level="32.1" data-path="introduction.html"><a href="introduction.html#introduction"><i class="fa fa-check"></i><b>32.1</b> Introduction</a></li>
<li class="chapter" data-level="32.2" data-path="lun-416b-cell-line-smart-seq2.html"><a href="lun-416b-cell-line-smart-seq2.html#data-loading"><i class="fa fa-check"></i><b>32.2</b> Data loading</a></li>
<li class="chapter" data-level="32.3" data-path="quality-control.html"><a href="quality-control.html#quality-control"><i class="fa fa-check"></i><b>32.3</b> Quality control</a></li>
<li class="chapter" data-level="32.4" data-path="normalization.html"><a href="normalization.html#normalization"><i class="fa fa-check"></i><b>32.4</b> Normalization</a></li>
<li class="chapter" data-level="32.5" data-path="lun-416b-cell-line-smart-seq2.html"><a href="lun-416b-cell-line-smart-seq2.html#variance-modelling"><i class="fa fa-check"></i><b>32.5</b> Variance modelling</a></li>
<li class="chapter" data-level="32.6" data-path="dimensionality-reduction.html"><a href="dimensionality-reduction.html#dimensionality-reduction"><i class="fa fa-check"></i><b>32.6</b> Dimensionality reduction</a></li>
<li class="chapter" data-level="32.7" data-path="clustering.html"><a href="clustering.html#clustering"><i class="fa fa-check"></i><b>32.7</b> Clustering</a></li>
<li class="chapter" data-level="" data-path="overview.html"><a href="overview.html#session-info"><i class="fa fa-check"></i>Session Info</a></li>
</ul></li>
<li class="chapter" data-level="33" data-path="segerstolpe-human-pancreas-smart-seq2.html"><a href="segerstolpe-human-pancreas-smart-seq2.html"><i class="fa fa-check"></i><b>33</b> Segerstolpe human pancreas (Smart-seq2)</a><ul>
<li class="chapter" data-level="33.1" data-path="introduction.html"><a href="introduction.html#introduction"><i class="fa fa-check"></i><b>33.1</b> Introduction</a></li>
<li class="chapter" data-level="33.2" data-path="lun-416b-cell-line-smart-seq2.html"><a href="lun-416b-cell-line-smart-seq2.html#data-loading"><i class="fa fa-check"></i><b>33.2</b> Data loading</a></li>
<li class="chapter" data-level="33.3" data-path="quality-control.html"><a href="quality-control.html#quality-control"><i class="fa fa-check"></i><b>33.3</b> Quality control</a></li>
<li class="chapter" data-level="33.4" data-path="normalization.html"><a href="normalization.html#normalization"><i class="fa fa-check"></i><b>33.4</b> Normalization</a></li>
<li class="chapter" data-level="33.5" data-path="lun-416b-cell-line-smart-seq2.html"><a href="lun-416b-cell-line-smart-seq2.html#variance-modelling"><i class="fa fa-check"></i><b>33.5</b> Variance modelling</a></li>
<li class="chapter" data-level="33.6" data-path="dimensionality-reduction.html"><a href="dimensionality-reduction.html#dimensionality-reduction"><i class="fa fa-check"></i><b>33.6</b> Dimensionality reduction</a></li>
<li class="chapter" data-level="33.7" data-path="clustering.html"><a href="clustering.html#clustering"><i class="fa fa-check"></i><b>33.7</b> Clustering</a></li>
<li class="chapter" data-level="33.8" data-path="filtered-human-pbmcs-10x-genomics.html"><a href="filtered-human-pbmcs-10x-genomics.html#data-integration"><i class="fa fa-check"></i><b>33.8</b> Data integration</a></li>
<li class="chapter" data-level="33.9" data-path="segerstolpe-human-pancreas-smart-seq2.html"><a href="segerstolpe-human-pancreas-smart-seq2.html#segerstolpe-comparison"><i class="fa fa-check"></i><b>33.9</b> Multi-sample comparisons</a></li>
<li class="chapter" data-level="" data-path="overview.html"><a href="overview.html#session-info"><i class="fa fa-check"></i>Session Info</a></li>
</ul></li>
<li class="chapter" data-level="34" data-path="merged-pancreas.html"><a href="merged-pancreas.html"><i class="fa fa-check"></i><b>34</b> Merged human pancreas datasets</a><ul>
<li class="chapter" data-level="34.1" data-path="introduction.html"><a href="introduction.html#introduction"><i class="fa fa-check"></i><b>34.1</b> Introduction</a></li>
<li class="chapter" data-level="34.2" data-path="merged-pancreas.html"><a href="merged-pancreas.html#the-good"><i class="fa fa-check"></i><b>34.2</b> The good</a></li>
<li class="chapter" data-level="34.3" data-path="merged-pancreas.html"><a href="merged-pancreas.html#the-bad"><i class="fa fa-check"></i><b>34.3</b> The bad</a></li>
<li class="chapter" data-level="34.4" data-path="merged-pancreas.html"><a href="merged-pancreas.html#the-ugly"><i class="fa fa-check"></i><b>34.4</b> The ugly</a></li>
<li class="chapter" data-level="" data-path="overview.html"><a href="overview.html#session-info"><i class="fa fa-check"></i>Session Info</a></li>
</ul></li>
<li class="chapter" data-level="35" data-path="merged-hcsc.html"><a href="merged-hcsc.html"><i class="fa fa-check"></i><b>35</b> Grun mouse HSC (CEL-seq)</a><ul>
<li class="chapter" data-level="35.1" data-path="introduction.html"><a href="introduction.html#introduction"><i class="fa fa-check"></i><b>35.1</b> Introduction</a></li>
<li class="chapter" data-level="35.2" data-path="lun-416b-cell-line-smart-seq2.html"><a href="lun-416b-cell-line-smart-seq2.html#data-loading"><i class="fa fa-check"></i><b>35.2</b> Data loading</a></li>
<li class="chapter" data-level="35.3" data-path="quality-control.html"><a href="quality-control.html#quality-control"><i class="fa fa-check"></i><b>35.3</b> Quality control</a></li>
<li class="chapter" data-level="35.4" data-path="normalization.html"><a href="normalization.html#normalization"><i class="fa fa-check"></i><b>35.4</b> Normalization</a></li>
<li class="chapter" data-level="35.5" data-path="lun-416b-cell-line-smart-seq2.html"><a href="lun-416b-cell-line-smart-seq2.html#variance-modelling"><i class="fa fa-check"></i><b>35.5</b> Variance modelling</a></li>
<li class="chapter" data-level="35.6" data-path="dimensionality-reduction.html"><a href="dimensionality-reduction.html#dimensionality-reduction"><i class="fa fa-check"></i><b>35.6</b> Dimensionality reduction</a></li>
<li class="chapter" data-level="35.7" data-path="clustering.html"><a href="clustering.html#clustering"><i class="fa fa-check"></i><b>35.7</b> Clustering</a></li>
<li class="chapter" data-level="35.8" data-path="merged-hcsc.html"><a href="merged-hcsc.html#marker-gene-detection"><i class="fa fa-check"></i><b>35.8</b> Marker gene detection</a></li>
<li class="chapter" data-level="" data-path="overview.html"><a href="overview.html#session-info"><i class="fa fa-check"></i>Session Info</a></li>
</ul></li>
<li class="chapter" data-level="36" data-path="nestorowa-mouse-hsc-smart-seq2.html"><a href="nestorowa-mouse-hsc-smart-seq2.html"><i class="fa fa-check"></i><b>36</b> Nestorowa mouse HSC (Smart-seq2)</a><ul>
<li class="chapter" data-level="36.1" data-path="introduction.html"><a href="introduction.html#introduction"><i class="fa fa-check"></i><b>36.1</b> Introduction</a></li>
<li class="chapter" data-level="36.2" data-path="lun-416b-cell-line-smart-seq2.html"><a href="lun-416b-cell-line-smart-seq2.html#data-loading"><i class="fa fa-check"></i><b>36.2</b> Data loading</a></li>
<li class="chapter" data-level="36.3" data-path="quality-control.html"><a href="quality-control.html#quality-control"><i class="fa fa-check"></i><b>36.3</b> Quality control</a></li>
<li class="chapter" data-level="36.4" data-path="normalization.html"><a href="normalization.html#normalization"><i class="fa fa-check"></i><b>36.4</b> Normalization</a></li>
<li class="chapter" data-level="36.5" data-path="lun-416b-cell-line-smart-seq2.html"><a href="lun-416b-cell-line-smart-seq2.html#variance-modelling"><i class="fa fa-check"></i><b>36.5</b> Variance modelling</a></li>
<li class="chapter" data-level="36.6" data-path="dimensionality-reduction.html"><a href="dimensionality-reduction.html#dimensionality-reduction"><i class="fa fa-check"></i><b>36.6</b> Dimensionality reduction</a></li>
<li class="chapter" data-level="36.7" data-path="clustering.html"><a href="clustering.html#clustering"><i class="fa fa-check"></i><b>36.7</b> Clustering</a></li>
<li class="chapter" data-level="36.8" data-path="merged-hcsc.html"><a href="merged-hcsc.html#marker-gene-detection"><i class="fa fa-check"></i><b>36.8</b> Marker gene detection</a></li>
<li class="chapter" data-level="36.9" data-path="cell-type-annotation.html"><a href="cell-type-annotation.html#cell-type-annotation"><i class="fa fa-check"></i><b>36.9</b> Cell type annotation</a></li>
<li class="chapter" data-level="36.10" data-path="nestorowa-mouse-hsc-smart-seq2.html"><a href="nestorowa-mouse-hsc-smart-seq2.html#miscellaneous-analyses"><i class="fa fa-check"></i><b>36.10</b> Miscellaneous analyses</a></li>
<li class="chapter" data-level="" data-path="overview.html"><a href="overview.html#session-info"><i class="fa fa-check"></i>Session Info</a></li>
</ul></li>
<li class="chapter" data-level="37" data-path="pijuan-sala-chimeric-mouse-embryo-10x-genomics.html"><a href="pijuan-sala-chimeric-mouse-embryo-10x-genomics.html"><i class="fa fa-check"></i><b>37</b> Pijuan-Sala chimeric mouse embryo (10X Genomics)</a><ul>
<li class="chapter" data-level="37.1" data-path="introduction.html"><a href="introduction.html#introduction"><i class="fa fa-check"></i><b>37.1</b> Introduction</a></li>
<li class="chapter" data-level="37.2" data-path="lun-416b-cell-line-smart-seq2.html"><a href="lun-416b-cell-line-smart-seq2.html#data-loading"><i class="fa fa-check"></i><b>37.2</b> Data loading</a></li>
<li class="chapter" data-level="37.3" data-path="quality-control.html"><a href="quality-control.html#quality-control"><i class="fa fa-check"></i><b>37.3</b> Quality control</a></li>
<li class="chapter" data-level="37.4" data-path="normalization.html"><a href="normalization.html#normalization"><i class="fa fa-check"></i><b>37.4</b> Normalization</a></li>
<li class="chapter" data-level="37.5" data-path="lun-416b-cell-line-smart-seq2.html"><a href="lun-416b-cell-line-smart-seq2.html#variance-modelling"><i class="fa fa-check"></i><b>37.5</b> Variance modelling</a></li>
<li class="chapter" data-level="37.6" data-path="pijuan-sala-chimeric-mouse-embryo-10x-genomics.html"><a href="pijuan-sala-chimeric-mouse-embryo-10x-genomics.html#merging"><i class="fa fa-check"></i><b>37.6</b> Merging</a></li>
<li class="chapter" data-level="37.7" data-path="clustering.html"><a href="clustering.html#clustering"><i class="fa fa-check"></i><b>37.7</b> Clustering</a></li>
<li class="chapter" data-level="37.8" data-path="dimensionality-reduction.html"><a href="dimensionality-reduction.html#dimensionality-reduction"><i class="fa fa-check"></i><b>37.8</b> Dimensionality reduction</a></li>
<li class="chapter" data-level="" data-path="overview.html"><a href="overview.html#session-info"><i class="fa fa-check"></i>Session Info</a></li>
</ul></li>
<li class="chapter" data-level="38" data-path="bach-mouse-mammary-gland-10x-genomics.html"><a href="bach-mouse-mammary-gland-10x-genomics.html"><i class="fa fa-check"></i><b>38</b> Bach mouse mammary gland (10X Genomics)</a><ul>
<li class="chapter" data-level="38.1" data-path="introduction.html"><a href="introduction.html#introduction"><i class="fa fa-check"></i><b>38.1</b> Introduction</a></li>
<li class="chapter" data-level="38.2" data-path="lun-416b-cell-line-smart-seq2.html"><a href="lun-416b-cell-line-smart-seq2.html#data-loading"><i class="fa fa-check"></i><b>38.2</b> Data loading</a></li>
<li class="chapter" data-level="38.3" data-path="quality-control.html"><a href="quality-control.html#quality-control"><i class="fa fa-check"></i><b>38.3</b> Quality control</a></li>
<li class="chapter" data-level="38.4" data-path="normalization.html"><a href="normalization.html#normalization"><i class="fa fa-check"></i><b>38.4</b> Normalization</a></li>
<li class="chapter" data-level="38.5" data-path="lun-416b-cell-line-smart-seq2.html"><a href="lun-416b-cell-line-smart-seq2.html#variance-modelling"><i class="fa fa-check"></i><b>38.5</b> Variance modelling</a></li>
<li class="chapter" data-level="38.6" data-path="dimensionality-reduction.html"><a href="dimensionality-reduction.html#dimensionality-reduction"><i class="fa fa-check"></i><b>38.6</b> Dimensionality reduction</a></li>
<li class="chapter" data-level="38.7" data-path="clustering.html"><a href="clustering.html#clustering"><i class="fa fa-check"></i><b>38.7</b> Clustering</a></li>
<li class="chapter" data-level="" data-path="overview.html"><a href="overview.html#session-info"><i class="fa fa-check"></i>Session Info</a></li>
</ul></li>
<li class="chapter" data-level="39" data-path="hca-human-bone-marrow-10x-genomics.html"><a href="hca-human-bone-marrow-10x-genomics.html"><i class="fa fa-check"></i><b>39</b> HCA human bone marrow (10X Genomics)</a><ul>
<li class="chapter" data-level="39.1" data-path="introduction.html"><a href="introduction.html#introduction"><i class="fa fa-check"></i><b>39.1</b> Introduction</a></li>
<li class="chapter" data-level="39.2" data-path="lun-416b-cell-line-smart-seq2.html"><a href="lun-416b-cell-line-smart-seq2.html#data-loading"><i class="fa fa-check"></i><b>39.2</b> Data loading</a></li>
<li class="chapter" data-level="39.3" data-path="quality-control.html"><a href="quality-control.html#quality-control"><i class="fa fa-check"></i><b>39.3</b> Quality control</a></li>
<li class="chapter" data-level="39.4" data-path="normalization.html"><a href="normalization.html#normalization"><i class="fa fa-check"></i><b>39.4</b> Normalization</a></li>
<li class="chapter" data-level="39.5" data-path="hca-human-bone-marrow-10x-genomics.html"><a href="hca-human-bone-marrow-10x-genomics.html#variance-modeling"><i class="fa fa-check"></i><b>39.5</b> Variance modeling</a></li>
<li class="chapter" data-level="39.6" data-path="filtered-human-pbmcs-10x-genomics.html"><a href="filtered-human-pbmcs-10x-genomics.html#data-integration"><i class="fa fa-check"></i><b>39.6</b> Data integration</a></li>
<li class="chapter" data-level="39.7" data-path="dimensionality-reduction.html"><a href="dimensionality-reduction.html#dimensionality-reduction"><i class="fa fa-check"></i><b>39.7</b> Dimensionality reduction</a></li>
<li class="chapter" data-level="39.8" data-path="clustering.html"><a href="clustering.html#clustering"><i class="fa fa-check"></i><b>39.8</b> Clustering</a></li>
<li class="chapter" data-level="39.9" data-path="hca-human-bone-marrow-10x-genomics.html"><a href="hca-human-bone-marrow-10x-genomics.html#differential-expression"><i class="fa fa-check"></i><b>39.9</b> Differential expression</a></li>
<li class="chapter" data-level="39.10" data-path="hca-human-bone-marrow-10x-genomics.html"><a href="hca-human-bone-marrow-10x-genomics.html#cell-type-classification"><i class="fa fa-check"></i><b>39.10</b> Cell type classification</a></li>
<li class="chapter" data-level="" data-path="overview.html"><a href="overview.html#session-info"><i class="fa fa-check"></i>Session Info</a></li>
</ul></li>
<li class="part"><span><b>IV Appendix</b></span></li>
<li class="chapter" data-level="40" data-path="contributors.html"><a href="contributors.html"><i class="fa fa-check"></i><b>40</b> Contributors</a><ul>
<li><a href="contributors.html#aaron-lun-phd"><em>Aaron Lun, PhD</em></a></li>
<li><a href="contributors.html#robert-amezquita-phd"><em>Robert Amezquita, PhD</em></a></li>
<li><a href="contributors.html#stephanie-hicks-phd"><em>Stephanie Hicks, PhD</em></a></li>
<li><a href="contributors.html#raphael-gottardo-phd"><em>Raphael Gottardo, PhD</em></a></li>
<li class="chapter" data-level="" data-path="contributors.html"><a href="contributors.html#other-notable-entities"><i class="fa fa-check"></i>Other notable entities</a></li>
</ul></li>
<li class="chapter" data-level="41" data-path="bibliography.html"><a href="bibliography.html"><i class="fa fa-check"></i><b>41</b> Bibliography</a></li>
<li class="divider"></li>
<li><a href="https://bioconductor.org" target="blank">Published by Bioconductor</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Orchestrating Single-Cell Analysis with Bioconductor</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="multi-sample-comparisons" class="section level1">
<h1><span class="header-section-number">Chapter 14</span> Multi-sample comparisons</h1>
<script>
document.addEventListener("click", function (event) {
    if (event.target.classList.contains("aaron-collapse")) {
        event.target.classList.toggle("active");
        var content = event.target.nextElementSibling;
        if (content.style.display === "block") {
            content.style.display = "none";
        } else {
            content.style.display = "block";
        }
    }
})
</script>
<style>
.aaron-collapse {
  background-color: #eee;
  color: #444;
  cursor: pointer;
  padding: 18px;
  width: 100%;
  border: none;
  text-align: left;
  outline: none;
  font-size: 15px;
}

.aaron-content {
  padding: 0 18px;
  display: none;
  overflow: hidden;
  background-color: #f1f1f1;
}
</style>
<div id="motivation" class="section level2">
<h2><span class="header-section-number">14.1</span> Motivation</h2>
<p>A powerful use of scRNA-seq technology lies in the design of replicated multi-condition experiments to detect changes in composition or expression between conditions.
For example, a researcher could use this strategy to detect changes in cell type abundance after drug treatment <span class="citation">(Richard et al. <a href="#ref-richard2018tcell">2018</a>)</span> or genetic modifications <span class="citation">(Scialdone et al. <a href="#ref-scialdone2016resolving">2016</a>)</span>.
This provides more biological insight than conventional scRNA-seq experiments involving only one biological condition, especially if we can relate population changes to specific experimental perturbations.</p>
<p>Differential analyses of multi-condition scRNA-seq experiments can be broadly split into two categories - differential expression (DE) and differential abundance (DA) analyses.
The former tests for changes in expression between conditions for cells of the same type that are present in both conditions,
while the latter tests for changes in the composition of cell types (or states, etc.) between conditions.
In this chapter, we will demonstrate both analyses using data from a study of the early mouse embryo <span class="citation">(Pijuan-Sala et al. <a href="#ref-pijuansala2019single">2019</a>)</span>.</p>
</div>
<div id="setting-up-the-data" class="section level2">
<h2><span class="header-section-number">14.2</span> Setting up the data</h2>
<p>Our demonstration scRNA-seq dataset was generated from chimeric mouse embryos at the E8.5 developmental stage.
Each chimeric embryo was generated by injecting td-Tomato-positive embryonic stem cells (ESCs) into a wild-type (WT) blastocyst.
Unlike in previous experiments <span class="citation">(Scialdone et al. <a href="#ref-scialdone2016resolving">2016</a>)</span>, there is no genetic difference between the injected and background cells other than the expression of td-Tomato in the former.
Instead, the aim of this “wild-type chimera” study is to determine whether the injection procedure itself introduces differences in lineage commitment compared to the background cells.</p>
<p>The experiment used a paired design with three replicate batches of two samples each.
Specifically, each batch contains one sample consisting of td-Tomato positive cells and another consisting of negative cells,
obtained by fluorescence-activated cell sorting from a single pool of dissociated cells from 6-7 chimeric embryos.
For each sample, scRNA-seq data was generated using the 10X Genomics protocol <span class="citation">(Zheng et al. <a href="#ref-zheng2017massively">2017</a>)</span> to obtain 2000-7000 cells.</p>
<button class="aaron-collapse">
View history
</button>
<div class="aaron-content">
<div class="sourceCode" id="cb471"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb471-1" data-line-number="1"><span class="co">#--- loading ---#</span></a>
<a class="sourceLine" id="cb471-2" data-line-number="2"><span class="kw">library</span>(MouseGastrulationData)</a>
<a class="sourceLine" id="cb471-3" data-line-number="3">sce.chimera &lt;-<span class="st"> </span><span class="kw">WTChimeraData</span>(<span class="dt">samples=</span><span class="dv">5</span><span class="op">:</span><span class="dv">10</span>)</a>
<a class="sourceLine" id="cb471-4" data-line-number="4">sce.chimera</a>
<a class="sourceLine" id="cb471-5" data-line-number="5"></a>
<a class="sourceLine" id="cb471-6" data-line-number="6"><span class="co">#--- feature-annotation ---#</span></a>
<a class="sourceLine" id="cb471-7" data-line-number="7"><span class="kw">library</span>(scater)</a>
<a class="sourceLine" id="cb471-8" data-line-number="8"><span class="kw">rownames</span>(sce.chimera) &lt;-<span class="st"> </span><span class="kw">uniquifyFeatureNames</span>(</a>
<a class="sourceLine" id="cb471-9" data-line-number="9">    <span class="kw">rowData</span>(sce.chimera)<span class="op">$</span>ENSEMBL, <span class="kw">rowData</span>(sce.chimera)<span class="op">$</span>SYMBOL)</a>
<a class="sourceLine" id="cb471-10" data-line-number="10"></a>
<a class="sourceLine" id="cb471-11" data-line-number="11"><span class="co">#--- quality-control ---#</span></a>
<a class="sourceLine" id="cb471-12" data-line-number="12">drop &lt;-<span class="st"> </span>sce.chimera<span class="op">$</span>celltype.mapped <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;stripped&quot;</span>, <span class="st">&quot;Doublet&quot;</span>)</a>
<a class="sourceLine" id="cb471-13" data-line-number="13">sce.chimera &lt;-<span class="st"> </span>sce.chimera[,<span class="op">!</span>drop]</a>
<a class="sourceLine" id="cb471-14" data-line-number="14"></a>
<a class="sourceLine" id="cb471-15" data-line-number="15"><span class="co">#--- normalization ---#</span></a>
<a class="sourceLine" id="cb471-16" data-line-number="16">sce.chimera &lt;-<span class="st"> </span><span class="kw">logNormCounts</span>(sce.chimera)</a>
<a class="sourceLine" id="cb471-17" data-line-number="17"></a>
<a class="sourceLine" id="cb471-18" data-line-number="18"><span class="co">#--- variance-modelling ---#</span></a>
<a class="sourceLine" id="cb471-19" data-line-number="19"><span class="kw">library</span>(scran)</a>
<a class="sourceLine" id="cb471-20" data-line-number="20">dec.chimera &lt;-<span class="st"> </span><span class="kw">modelGeneVar</span>(sce.chimera, <span class="dt">block=</span>sce.chimera<span class="op">$</span>sample)</a>
<a class="sourceLine" id="cb471-21" data-line-number="21">chosen.hvgs &lt;-<span class="st"> </span>dec.chimera<span class="op">$</span>bio <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span></a>
<a class="sourceLine" id="cb471-22" data-line-number="22"></a>
<a class="sourceLine" id="cb471-23" data-line-number="23"><span class="co">#--- merging ---#</span></a>
<a class="sourceLine" id="cb471-24" data-line-number="24"><span class="kw">library</span>(batchelor)</a>
<a class="sourceLine" id="cb471-25" data-line-number="25"><span class="kw">set.seed</span>(<span class="dv">01001001</span>)</a>
<a class="sourceLine" id="cb471-26" data-line-number="26">merged &lt;-<span class="st"> </span><span class="kw">correctExperiments</span>(sce.chimera, </a>
<a class="sourceLine" id="cb471-27" data-line-number="27">    <span class="dt">batch=</span>sce.chimera<span class="op">$</span>sample, </a>
<a class="sourceLine" id="cb471-28" data-line-number="28">    <span class="dt">subset.row=</span>chosen.hvgs,</a>
<a class="sourceLine" id="cb471-29" data-line-number="29">    <span class="dt">PARAM=</span><span class="kw">FastMnnParam</span>(</a>
<a class="sourceLine" id="cb471-30" data-line-number="30">        <span class="dt">merge.order=</span><span class="kw">list</span>(</a>
<a class="sourceLine" id="cb471-31" data-line-number="31">            <span class="kw">list</span>(<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">5</span>), <span class="co"># WT (3 replicates)</span></a>
<a class="sourceLine" id="cb471-32" data-line-number="32">            <span class="kw">list</span>(<span class="dv">2</span>,<span class="dv">4</span>,<span class="dv">6</span>)  <span class="co"># td-Tomato (3 replicates)</span></a>
<a class="sourceLine" id="cb471-33" data-line-number="33">        )</a>
<a class="sourceLine" id="cb471-34" data-line-number="34">    )</a>
<a class="sourceLine" id="cb471-35" data-line-number="35">)</a>
<a class="sourceLine" id="cb471-36" data-line-number="36"></a>
<a class="sourceLine" id="cb471-37" data-line-number="37"><span class="co">#--- clustering ---#</span></a>
<a class="sourceLine" id="cb471-38" data-line-number="38">g &lt;-<span class="st"> </span><span class="kw">buildSNNGraph</span>(merged, <span class="dt">use.dimred=</span><span class="st">&quot;corrected&quot;</span>)</a>
<a class="sourceLine" id="cb471-39" data-line-number="39">clusters &lt;-<span class="st"> </span>igraph<span class="op">::</span><span class="kw">cluster_louvain</span>(g)</a>
<a class="sourceLine" id="cb471-40" data-line-number="40"><span class="kw">colLabels</span>(merged) &lt;-<span class="st"> </span><span class="kw">factor</span>(clusters<span class="op">$</span>membership)</a>
<a class="sourceLine" id="cb471-41" data-line-number="41"></a>
<a class="sourceLine" id="cb471-42" data-line-number="42"><span class="co">#--- dimensionality-reduction ---#</span></a>
<a class="sourceLine" id="cb471-43" data-line-number="43">merged &lt;-<span class="st"> </span><span class="kw">runTSNE</span>(merged, <span class="dt">dimred=</span><span class="st">&quot;corrected&quot;</span>, <span class="dt">external_neighbors=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb471-44" data-line-number="44">merged &lt;-<span class="st"> </span><span class="kw">runUMAP</span>(merged, <span class="dt">dimred=</span><span class="st">&quot;corrected&quot;</span>, <span class="dt">external_neighbors=</span><span class="ot">TRUE</span>)</a></code></pre></div>
</div>
<div class="sourceCode" id="cb472"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb472-1" data-line-number="1">merged</a></code></pre></div>
<pre><code>## class: SingleCellExperiment 
## dim: 14699 19426 
## metadata(2): merge.info pca.info
## assays(3): reconstructed counts logcounts
## rownames(14699): Xkr4 Rp1 ... Vmn2r122 CAAA01147332.1
## rowData names(3): rotation ENSEMBL SYMBOL
## colnames(19426): cell_9769 cell_9770 ... cell_30701 cell_30702
## colData names(13): batch cell ... sizeFactor label
## reducedDimNames(3): corrected TSNE UMAP
## altExpNames(0):</code></pre>
<p>The differential analyses in this chapter will be predicated on many of the pre-processing steps covered previously.
For brevity, we will not explicitly repeat them here,
only noting that we have already merged cells from all samples into the same coordinate system (Chapter <a href="filtered-human-pbmcs-10x-genomics.html#data-integration">28.8</a>)
and clustered the merged dataset to obtain a common partitioning across all samples (Chapter <a href="clustering.html#clustering">10</a>).
A brief inspection of the results indicates that clusters contain similar contributions from all batches with only modest differences associated with td-Tomato expression (Figure <a href="multi-sample-comparisons.html#fig:tsne-initial">14.1</a>).</p>
<div class="sourceCode" id="cb474"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb474-1" data-line-number="1"><span class="kw">library</span>(scater)</a>
<a class="sourceLine" id="cb474-2" data-line-number="2"><span class="kw">table</span>(<span class="kw">colLabels</span>(merged), merged<span class="op">$</span>tomato)</a></code></pre></div>
<pre><code>##     
##      FALSE TRUE
##   1    546  401
##   2     60   52
##   3    470  398
##   4    469  211
##   5    335  271
##   6    258  249
##   7   1241  967
##   8    203  221
##   9    630  629
##   10    71  181
##   11    47   57
##   12   417  310
##   13    58    0
##   14   209  214
##   15   414  630
##   16   363  509
##   17   234  198
##   18   657  607
##   19   151  303
##   20   579  443
##   21   137   74
##   22    82   78
##   23   155    1
##   24   762  878
##   25   363  497
##   26  1420  716</code></pre>
<div class="sourceCode" id="cb476"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb476-1" data-line-number="1"><span class="kw">table</span>(<span class="kw">colLabels</span>(merged), merged<span class="op">$</span>pool)</a></code></pre></div>
<pre><code>##     
##         3    4    5
##   1   224  173  550
##   2    26   30   56
##   3   226  172  470
##   4    78  162  440
##   5    99  227  280
##   6   187  116  204
##   7   300  909  999
##   8    69  134  221
##   9   229  423  607
##   10  114   54   84
##   11   16   31   57
##   12  179  169  379
##   13    2   51    5
##   14   77   97  249
##   15  114  289  641
##   16  183  242  447
##   17  157   81  194
##   18  123  308  833
##   19  106  118  230
##   20  236  238  548
##   21    3   10  198
##   22   27   29  104
##   23    6   84   66
##   24  217  455  968
##   25  132  172  556
##   26  194  870 1072</code></pre>
<div class="sourceCode" id="cb478"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb478-1" data-line-number="1">gridExtra<span class="op">::</span><span class="kw">grid.arrange</span>(</a>
<a class="sourceLine" id="cb478-2" data-line-number="2">    <span class="kw">plotTSNE</span>(merged, <span class="dt">colour_by=</span><span class="st">&quot;tomato&quot;</span>, <span class="dt">text_by=</span><span class="st">&quot;label&quot;</span>),</a>
<a class="sourceLine" id="cb478-3" data-line-number="3">    <span class="kw">plotTSNE</span>(merged, <span class="dt">colour_by=</span><span class="kw">data.frame</span>(<span class="dt">pool=</span><span class="kw">factor</span>(merged<span class="op">$</span>pool))),</a>
<a class="sourceLine" id="cb478-4" data-line-number="4">    <span class="dt">ncol=</span><span class="dv">2</span></a>
<a class="sourceLine" id="cb478-5" data-line-number="5">)</a></code></pre></div>
<div class="figure"><span id="fig:tsne-initial"></span>
<img src="sample-comparisons_files/figure-html/tsne-initial-1.png" alt="$t$-SNE plot of the WT chimeric dataset, where each point represents a cell and is colored according to td-Tomato expression (left) or batch of origin (right). Cluster numbers are superimposed based on the median coordinate of cells assigned to that cluster." width="672" />
<p class="caption">
Figure 14.1: <span class="math inline">\(t\)</span>-SNE plot of the WT chimeric dataset, where each point represents a cell and is colored according to td-Tomato expression (left) or batch of origin (right). Cluster numbers are superimposed based on the median coordinate of cells assigned to that cluster.
</p>
</div>
<p>Ordinarily, we would be obliged to perform marker detection to assign biological meaning to these clusters.
For simplicity, we will skip this step by directly using the cell type labels provided by <span class="citation">Pijuan-Sala et al. (<a href="#ref-pijuansala2019single">2019</a>)</span>.
These were obtained by mapping the cells in this dataset to a larger, pre-annotated “atlas” of mouse early embryonic development.
While broadly consistent, many of our clusters map to multiple labels (Figure @ref(fig:heat-cluster-label}), which reflects the difficulties in unambiguously resolving cell types undergoing differentiation.</p>
<div class="sourceCode" id="cb479"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb479-1" data-line-number="1">by.label &lt;-<span class="st"> </span><span class="kw">table</span>(<span class="kw">colLabels</span>(merged), merged<span class="op">$</span>celltype.mapped)</a>
<a class="sourceLine" id="cb479-2" data-line-number="2">pheatmap<span class="op">::</span><span class="kw">pheatmap</span>(<span class="kw">log2</span>(by.label<span class="op">+</span><span class="dv">1</span>), <span class="dt">cluster_cols=</span><span class="ot">FALSE</span>, <span class="dt">cluster_rows=</span><span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb479-3" data-line-number="3">    <span class="dt">color=</span>viridis<span class="op">::</span><span class="kw">viridis</span>(<span class="dv">101</span>))</a></code></pre></div>
<div class="figure"><span id="fig:heat-cluster-label"></span>
<img src="sample-comparisons_files/figure-html/heat-cluster-label-1.png" alt="Heatmap showing the abundance of cells with each combination of cluster (row) and cell type label (column). The color scale represents the log~2~-count for each combination." width="672" />
<p class="caption">
Figure 14.2: Heatmap showing the abundance of cells with each combination of cluster (row) and cell type label (column). The color scale represents the log<sub>2</sub>-count for each combination.
</p>
</div>
</div>
<div id="differential-expression-between-conditions" class="section level2">
<h2><span class="header-section-number">14.3</span> Differential expression between conditions</h2>
<div id="creating-pseudo-bulk-samples" class="section level3">
<h3><span class="header-section-number">14.3.1</span> Creating pseudo-bulk samples</h3>
<p>The most obvious differential analysis is to look for changes in expression between conditions.
We perform the DE analysis separately for each label to identify cell type-specific transcriptional effects of injection.
The actual DE testing is performed on “pseudo-bulk” expression profiles <span class="citation">(Tung et al. <a href="#ref-tung2017batch">2017</a>)</span>,
generated by summing counts together for all cells with the same combination of label and sample.
This leverages the resolution offered by single-cell technologies to define the labels,
and combines it with the statistical rigor of existing methods for DE analyses involving a small number of samples.</p>
<div class="sourceCode" id="cb480"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb480-1" data-line-number="1"><span class="co"># Using &#39;label&#39; and &#39;sample&#39; as our two factors; each column of the output</span></a>
<a class="sourceLine" id="cb480-2" data-line-number="2"><span class="co"># corresponds to one unique combination of these two factors.</span></a>
<a class="sourceLine" id="cb480-3" data-line-number="3">summed &lt;-<span class="st"> </span><span class="kw">aggregateAcrossCells</span>(merged, </a>
<a class="sourceLine" id="cb480-4" data-line-number="4">    <span class="dt">id=</span><span class="kw">colData</span>(merged)[,<span class="kw">c</span>(<span class="st">&quot;celltype.mapped&quot;</span>, <span class="st">&quot;sample&quot;</span>)])</a>
<a class="sourceLine" id="cb480-5" data-line-number="5">summed</a></code></pre></div>
<pre><code>## class: SingleCellExperiment 
## dim: 14699 186 
## metadata(2): merge.info pca.info
## assays(1): counts
## rownames(14699): Xkr4 Rp1 ... Vmn2r122 CAAA01147332.1
## rowData names(3): rotation ENSEMBL SYMBOL
## colnames: NULL
## colData names(16): batch cell ... sample ncells
## reducedDimNames(3): corrected TSNE UMAP
## altExpNames(0):</code></pre>
<p>At this point, it is worth reflecting on the motivations behind the use of pseudo-bulking:</p>
<ul>
<li>Larger counts are more amenable to standard DE analysis pipelines designed for bulk RNA-seq data.
Normalization is more straightforward and certain statistical approximations are more accurate
e.g., the saddlepoint approximation for quasi-likelihood methods or normality for linear models.</li>
<li>Collapsing cells into samples reflects the fact that our biological replication occurs at the sample level <span class="citation">(A. T. L. Lun and Marioni <a href="#ref-lun2017overcoming">2017</a>)</span>.
Each sample is represented no more than once for each condition, avoiding problems from unmodelled correlations between samples.
Supplying the per-cell counts directly to a DE analysis pipeline would imply that each cell is an independent biological replicate, which is not true from an experimental perspective.
(A mixed effects model can handle this variance structure but involves extra <a href="https://bbolker.github.io/mixedmodels-misc/glmmFAQ.html">statistical and computational complexity</a> for little benefit, see <span class="citation">Crowell et al. (<a href="#ref-crowell2019discovery">2019</a>)</span>.)</li>
<li>Variance between cells within each sample is masked, provided it does not affect variance across (replicate) samples.
This avoids penalizing DEGs that are not uniformly up- or down-regulated for all cells in all samples of one condition.
Masking is generally desirable as DEGs - unlike marker genes - do not need to have low within-sample variance to be interesting, e.g., if the treatment effect is consistent across replicate populations but heterogeneous on a per-cell basis.
(Of course, high per-cell variability will still result in weaker DE if it affects the variability across populations, while homogeneous per-cell responses will result in stronger DE due to a larger population-level log-fold change.
These effects are also largely desirable.)</li>
</ul>
</div>
<div id="performing-the-de-analysis" class="section level3">
<h3><span class="header-section-number">14.3.2</span> Performing the DE analysis</h3>
<div id="introduction" class="section level4">
<h4><span class="header-section-number">14.3.2.1</span> Introduction</h4>
<p>The DE analysis will be performed using quasi-likelihood (QL) methods from the <em><a href="https://bioconductor.org/packages/3.12/edgeR">edgeR</a></em> package <span class="citation">(Robinson, McCarthy, and Smyth <a href="#ref-robinson2010edgeR">2010</a>; Chen, Lun, and Smyth <a href="#ref-chen2016reads">2016</a>)</span>.
This uses a negative binomial generalized linear model (NB GLM) to handle overdispersed count data in experiments with limited replication.
In our case, we have biological variation with three paired replicates per condition, so <em><a href="https://bioconductor.org/packages/3.12/edgeR">edgeR</a></em> (or its contemporaries) is a natural choice for the analysis.</p>
<p>We do not use all labels for GLM fitting as the strong DE between labels makes it difficult to compute a sensible average abundance to model the mean-dispersion trend.
Moreover, label-specific batch effects would not be easily handled with a single additive term in the design matrix for the batch.
Instead, we arbitrarily pick one of the labels to use for this demonstration.</p>
<div class="sourceCode" id="cb482"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb482-1" data-line-number="1">label &lt;-<span class="st"> &quot;Mesenchyme&quot;</span></a>
<a class="sourceLine" id="cb482-2" data-line-number="2">current &lt;-<span class="st"> </span>summed[,label<span class="op">==</span>summed<span class="op">$</span>celltype.mapped]</a>
<a class="sourceLine" id="cb482-3" data-line-number="3"></a>
<a class="sourceLine" id="cb482-4" data-line-number="4"><span class="co"># Creating up a DGEList object for use in edgeR:</span></a>
<a class="sourceLine" id="cb482-5" data-line-number="5"><span class="kw">library</span>(edgeR)</a>
<a class="sourceLine" id="cb482-6" data-line-number="6">y &lt;-<span class="st"> </span><span class="kw">DGEList</span>(<span class="kw">counts</span>(current), <span class="dt">samples=</span><span class="kw">colData</span>(current))</a>
<a class="sourceLine" id="cb482-7" data-line-number="7">y</a></code></pre></div>
<pre><code>## An object of class &quot;DGEList&quot;
## $counts
##        Sample1 Sample2 Sample3 Sample4 Sample5 Sample6
## Xkr4         2       0       0       0       3       0
## Rp1          0       0       1       0       0       0
## Sox17        7       0       3       0      14       9
## Mrpl15    1420     271    1009     379    1578     749
## Rgs20        3       0       1       1       0       0
## 14694 more rows ...
## 
## $samples
##         group lib.size norm.factors batch cell barcode sample stage tomato pool
## Sample1     1  4607053            1     5 &lt;NA&gt;    &lt;NA&gt;      5  E8.5   TRUE    3
## Sample2     1  1064970            1     6 &lt;NA&gt;    &lt;NA&gt;      6  E8.5  FALSE    3
## Sample3     1  2494010            1     7 &lt;NA&gt;    &lt;NA&gt;      7  E8.5   TRUE    4
## Sample4     1  1028668            1     8 &lt;NA&gt;    &lt;NA&gt;      8  E8.5  FALSE    4
## Sample5     1  4290221            1     9 &lt;NA&gt;    &lt;NA&gt;      9  E8.5   TRUE    5
## Sample6     1  1950840            1    10 &lt;NA&gt;    &lt;NA&gt;     10  E8.5  FALSE    5
##         stage.mapped celltype.mapped closest.cell doub.density sizeFactor label
## Sample1         &lt;NA&gt;      Mesenchyme         &lt;NA&gt;           NA         NA    NA
## Sample2         &lt;NA&gt;      Mesenchyme         &lt;NA&gt;           NA         NA    NA
## Sample3         &lt;NA&gt;      Mesenchyme         &lt;NA&gt;           NA         NA    NA
## Sample4         &lt;NA&gt;      Mesenchyme         &lt;NA&gt;           NA         NA    NA
## Sample5         &lt;NA&gt;      Mesenchyme         &lt;NA&gt;           NA         NA    NA
## Sample6         &lt;NA&gt;      Mesenchyme         &lt;NA&gt;           NA         NA    NA
##         celltype.mapped.1 sample.1 ncells
## Sample1        Mesenchyme        5    286
## Sample2        Mesenchyme        6     55
## Sample3        Mesenchyme        7    243
## Sample4        Mesenchyme        8    134
## Sample5        Mesenchyme        9    478
## Sample6        Mesenchyme       10    299</code></pre>
</div>
<div id="pre-processing" class="section level4">
<h4><span class="header-section-number">14.3.2.2</span> Pre-processing</h4>
<p>A typical step in bulk RNA-seq data analyses is to remove samples with very low library sizes due to failed library preparation or sequencing.
The very low counts in these samples can be troublesome in downstream steps such as normalization (Chapter <a href="normalization.html#normalization">7</a>) or for some statistical approximations used in the DE analysis.
In our situation, this is equivalent to removing label-sample combinations that have very few or lowly-sequenced cells.
The exact definition of “very low” will vary, but in this case, we remove combinations containing fewer than 10 cells <span class="citation">(Crowell et al. <a href="#ref-crowell2019discovery">2019</a>)</span>.
Alternatively, we could apply the outlier-based strategy described in Chapter <a href="quality-control.html#quality-control">6</a>, but this makes the strong assumption that all label-sample combinations have similar numbers of cells that are sequenced to similar depth.
We defer to the usual diagnostics for bulk DE analyses to decide whether a particular pseudo-bulk profile should be removed.</p>
<div class="sourceCode" id="cb484"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb484-1" data-line-number="1">discarded &lt;-<span class="st"> </span>current<span class="op">$</span>ncells <span class="op">&lt;</span><span class="st"> </span><span class="dv">10</span></a>
<a class="sourceLine" id="cb484-2" data-line-number="2">y &lt;-<span class="st"> </span>y[,<span class="op">!</span>discarded]</a>
<a class="sourceLine" id="cb484-3" data-line-number="3"><span class="kw">summary</span>(discarded)</a></code></pre></div>
<pre><code>##    Mode   FALSE 
## logical       6</code></pre>
<p>Another typical step in bulk RNA-seq analyses is to remove genes that are lowly expressed.
This reduces computational work, improves the accuracy of mean-variance trend modelling and decreases the severity of the multiple testing correction.
Here, we use the <code>filterByExpr()</code> function from <em><a href="https://bioconductor.org/packages/3.12/edgeR">edgeR</a></em> to remove genes that are not expressed above a log-CPM threshold in a minimum number of samples (determined from the size of the smallest treatment group in the experimental design).</p>
<div class="sourceCode" id="cb486"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb486-1" data-line-number="1">keep &lt;-<span class="st"> </span><span class="kw">filterByExpr</span>(y, <span class="dt">group=</span>current<span class="op">$</span>tomato)</a>
<a class="sourceLine" id="cb486-2" data-line-number="2">y &lt;-<span class="st"> </span>y[keep,]</a>
<a class="sourceLine" id="cb486-3" data-line-number="3"><span class="kw">summary</span>(keep)</a></code></pre></div>
<pre><code>##    Mode   FALSE    TRUE 
## logical    9011    5688</code></pre>
<p>Finally, we correct for composition biases by computing normalization factors with the trimmed mean of M-values method <span class="citation">(Robinson and Oshlack <a href="#ref-robinson2010scaling">2010</a>)</span>.
We do not need the bespoke single-cell methods described in Chapter <a href="normalization.html#normalization">7</a>, as the counts for our pseudo-bulk samples are large enough to apply bulk normalization methods.
(Note that <em><a href="https://bioconductor.org/packages/3.12/edgeR">edgeR</a></em> normalization factors are closely related but <em>not the same</em> as the size factors described elsewhere in this book.
Size factors are proportional to the <em>product</em> of the normalization factors and the library sizes.)</p>
<div class="sourceCode" id="cb488"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb488-1" data-line-number="1">y &lt;-<span class="st"> </span><span class="kw">calcNormFactors</span>(y)</a>
<a class="sourceLine" id="cb488-2" data-line-number="2">y<span class="op">$</span>samples</a></code></pre></div>
<pre><code>##         group lib.size norm.factors batch cell barcode sample stage tomato pool
## Sample1     1  4607053       1.0683     5 &lt;NA&gt;    &lt;NA&gt;      5  E8.5   TRUE    3
## Sample2     1  1064970       1.0487     6 &lt;NA&gt;    &lt;NA&gt;      6  E8.5  FALSE    3
## Sample3     1  2494010       0.9582     7 &lt;NA&gt;    &lt;NA&gt;      7  E8.5   TRUE    4
## Sample4     1  1028668       0.9774     8 &lt;NA&gt;    &lt;NA&gt;      8  E8.5  FALSE    4
## Sample5     1  4290221       0.9707     9 &lt;NA&gt;    &lt;NA&gt;      9  E8.5   TRUE    5
## Sample6     1  1950840       0.9817    10 &lt;NA&gt;    &lt;NA&gt;     10  E8.5  FALSE    5
##         stage.mapped celltype.mapped closest.cell doub.density sizeFactor label
## Sample1         &lt;NA&gt;      Mesenchyme         &lt;NA&gt;           NA         NA    NA
## Sample2         &lt;NA&gt;      Mesenchyme         &lt;NA&gt;           NA         NA    NA
## Sample3         &lt;NA&gt;      Mesenchyme         &lt;NA&gt;           NA         NA    NA
## Sample4         &lt;NA&gt;      Mesenchyme         &lt;NA&gt;           NA         NA    NA
## Sample5         &lt;NA&gt;      Mesenchyme         &lt;NA&gt;           NA         NA    NA
## Sample6         &lt;NA&gt;      Mesenchyme         &lt;NA&gt;           NA         NA    NA
##         celltype.mapped.1 sample.1 ncells
## Sample1        Mesenchyme        5    286
## Sample2        Mesenchyme        6     55
## Sample3        Mesenchyme        7    243
## Sample4        Mesenchyme        8    134
## Sample5        Mesenchyme        9    478
## Sample6        Mesenchyme       10    299</code></pre>
<p>As part of the usual diagnostics for a bulk RNA-seq DE analysis, we generate a mean-difference (MD) plot for each normalized pseudo-bulk profile (Figure <a href="multi-sample-comparisons.html#fig:md-embryo">14.3</a>).
This should exhibit a trumpet shape centered at zero indicating that the normalization successfully removed systematic bias between profiles.
Lack of zero-centering or dominant discrete patterns at low abundances may be symptomatic of deeper problems with normalization, possibly due to insufficient cells/reads/UMIs composing a particular pseudo-bulk profile.</p>
<div class="sourceCode" id="cb490"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb490-1" data-line-number="1"><span class="kw">par</span>(<span class="dt">mfrow=</span><span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">3</span>))</a>
<a class="sourceLine" id="cb490-2" data-line-number="2"><span class="cf">for</span> (i <span class="cf">in</span> <span class="kw">seq_len</span>(<span class="kw">ncol</span>(y))) {</a>
<a class="sourceLine" id="cb490-3" data-line-number="3">    <span class="kw">plotMD</span>(y, <span class="dt">column=</span>i)</a>
<a class="sourceLine" id="cb490-4" data-line-number="4">}</a></code></pre></div>
<div class="figure"><span id="fig:md-embryo"></span>
<img src="sample-comparisons_files/figure-html/md-embryo-1.png" alt="Mean-difference plots of the normalized expression values for each pseudo-bulk sample against the average of all other samples." width="960" />
<p class="caption">
Figure 14.3: Mean-difference plots of the normalized expression values for each pseudo-bulk sample against the average of all other samples.
</p>
</div>
<p>We also generate a multi-dimensional scaling (MDS) plot for the pseudo-bulk profiles (Figure <a href="multi-sample-comparisons.html#fig:mds-embryo">14.4</a>).
This is closely related to PCA and allows us to visualize the structure of the data in a manner similar to that described in Chapter <a href="dimensionality-reduction.html#dimensionality-reduction">9</a> (though we rarely have enough pseudo-bulk profiles to make use of techniques like <span class="math inline">\(t\)</span>-SNE).
Here, the aim is to check whether samples separate by our known factors of interest - in this case, injection status.
Strong separation foreshadows a large number of DEGs in the subsequent analysis.</p>
<div class="sourceCode" id="cb491"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb491-1" data-line-number="1"><span class="kw">plotMDS</span>(<span class="kw">cpm</span>(y, <span class="dt">log=</span><span class="ot">TRUE</span>), </a>
<a class="sourceLine" id="cb491-2" data-line-number="2">    <span class="dt">col=</span><span class="kw">ifelse</span>(y<span class="op">$</span>samples<span class="op">$</span>tomato, <span class="st">&quot;red&quot;</span>, <span class="st">&quot;blue&quot;</span>))</a></code></pre></div>
<div class="figure"><span id="fig:mds-embryo"></span>
<img src="sample-comparisons_files/figure-html/mds-embryo-1.png" alt="MDS plot of the pseudo-bulk log-normalized CPMs, where each point represents a sample and is colored by the tomato status." width="672" />
<p class="caption">
Figure 14.4: MDS plot of the pseudo-bulk log-normalized CPMs, where each point represents a sample and is colored by the tomato status.
</p>
</div>
</div>
<div id="statistical-modelling" class="section level4">
<h4><span class="header-section-number">14.3.2.3</span> Statistical modelling</h4>
<p>We set up the design matrix to block on the batch-to-batch differences across different embryo pools,
while retaining an additive term that represents the effect of injection.
The latter is represented in our model as the log-fold change in gene expression in td-Tomato-positive cells over their negative counterparts within the same label.
Our aim is to test whether this log-fold change is significantly different from zero.</p>
<div class="sourceCode" id="cb492"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb492-1" data-line-number="1">design &lt;-<span class="st"> </span><span class="kw">model.matrix</span>(<span class="op">~</span><span class="kw">factor</span>(pool) <span class="op">+</span><span class="st"> </span><span class="kw">factor</span>(tomato), y<span class="op">$</span>samples)</a>
<a class="sourceLine" id="cb492-2" data-line-number="2">design</a></code></pre></div>
<pre><code>##         (Intercept) factor(pool)4 factor(pool)5 factor(tomato)TRUE
## Sample1           1             0             0                  1
## Sample2           1             0             0                  0
## Sample3           1             1             0                  1
## Sample4           1             1             0                  0
## Sample5           1             0             1                  1
## Sample6           1             0             1                  0
## attr(,&quot;assign&quot;)
## [1] 0 1 1 2
## attr(,&quot;contrasts&quot;)
## attr(,&quot;contrasts&quot;)$`factor(pool)`
## [1] &quot;contr.treatment&quot;
## 
## attr(,&quot;contrasts&quot;)$`factor(tomato)`
## [1] &quot;contr.treatment&quot;</code></pre>
<p>We estimate the negative binomial (NB) dispersions with <code>estimateDisp()</code>.
The role of the NB dispersion is to model the mean-variance trend (Figure <a href="multi-sample-comparisons.html#fig:bcvplot">14.5</a>),
which is not easily accommodated by QL dispersions alone due to the quadratic nature of the NB mean-variance trend.</p>
<div class="sourceCode" id="cb494"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb494-1" data-line-number="1">y &lt;-<span class="st"> </span><span class="kw">estimateDisp</span>(y, design)</a>
<a class="sourceLine" id="cb494-2" data-line-number="2"><span class="kw">summary</span>(y<span class="op">$</span>trended.dispersion)</a></code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##  0.0103  0.0167  0.0213  0.0202  0.0235  0.0266</code></pre>
<div class="sourceCode" id="cb496"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb496-1" data-line-number="1"><span class="kw">plotBCV</span>(y)</a></code></pre></div>
<div class="figure"><span id="fig:bcvplot"></span>
<img src="sample-comparisons_files/figure-html/bcvplot-1.png" alt="Biological coefficient of variation (BCV) for each gene as a function of the average abundance. The BCV is computed as the square root of the NB dispersion after empirical Bayes shrinkage towards the trend. Trended and common BCV estimates are shown in blue and red, respectively." width="672" />
<p class="caption">
Figure 14.5: Biological coefficient of variation (BCV) for each gene as a function of the average abundance. The BCV is computed as the square root of the NB dispersion after empirical Bayes shrinkage towards the trend. Trended and common BCV estimates are shown in blue and red, respectively.
</p>
</div>
<p>We also estimate the quasi-likelihood dispersions with <code>glmQLFit()</code> <span class="citation">(Chen, Lun, and Smyth <a href="#ref-chen2016reads">2016</a>)</span>.
This fits a GLM to the counts for each gene and estimates the QL dispersion from the GLM deviance.
We set <code>robust=TRUE</code> to avoid distortions from highly variable clusters <span class="citation">(Phipson et al. <a href="#ref-phipson2016robust">2016</a>)</span>.
The QL dispersion models the uncertainty and variability of the per-gene variance (Figure <a href="multi-sample-comparisons.html#fig:qlplot">14.6</a>) - which is not well handled by the NB dispersions, so the two dispersion types complement each other in the final analysis.</p>
<div class="sourceCode" id="cb497"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb497-1" data-line-number="1">fit &lt;-<span class="st"> </span><span class="kw">glmQLFit</span>(y, design, <span class="dt">robust=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb497-2" data-line-number="2"><span class="kw">summary</span>(fit<span class="op">$</span>var.prior)</a></code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##   0.318   0.714   0.854   0.804   0.913   1.067</code></pre>
<div class="sourceCode" id="cb499"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb499-1" data-line-number="1"><span class="kw">summary</span>(fit<span class="op">$</span>df.prior)</a></code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##   0.227  12.675  12.675  12.339  12.675  12.675</code></pre>
<div class="sourceCode" id="cb501"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb501-1" data-line-number="1"><span class="kw">plotQLDisp</span>(fit)</a></code></pre></div>
<div class="figure"><span id="fig:qlplot"></span>
<img src="sample-comparisons_files/figure-html/qlplot-1.png" alt="QL dispersion estimates for each gene as a function of abundance. Raw estimates (black) are shrunk towards the trend (blue) to yield squeezed estimates (red)." width="672" />
<p class="caption">
Figure 14.6: QL dispersion estimates for each gene as a function of abundance. Raw estimates (black) are shrunk towards the trend (blue) to yield squeezed estimates (red).
</p>
</div>
<p>We test for differences in expression due to injection using <code>glmQLFTest()</code>.
DEGs are defined as those with non-zero log-fold changes at a false discovery rate of 5%.
Very few genes are significantly DE, indicating that injection has little effect on the transcriptome of mesenchyme cells.
(Note that this logic is somewhat circular,
as a large transcriptional effect may have caused cells of this type to be re-assigned to a different label.
We discuss this in more detail in Section <a href="multi-sample-comparisons.html#de-da-duality">14.6.1</a> below.)</p>
<div class="sourceCode" id="cb502"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb502-1" data-line-number="1">res &lt;-<span class="st"> </span><span class="kw">glmQLFTest</span>(fit, <span class="dt">coef=</span><span class="kw">ncol</span>(design))</a>
<a class="sourceLine" id="cb502-2" data-line-number="2"><span class="kw">summary</span>(<span class="kw">decideTests</span>(res))</a></code></pre></div>
<pre><code>##        factor(tomato)TRUE
## Down                    8
## NotSig               5672
## Up                      8</code></pre>
<div class="sourceCode" id="cb504"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb504-1" data-line-number="1"><span class="kw">topTags</span>(res)</a></code></pre></div>
<pre><code>## Coefficient:  factor(tomato)TRUE 
##            logFC logCPM       F    PValue       FDR
## Phlda2   -4.3874  9.934 1638.59 1.812e-16 1.031e-12
## Erdr1     2.0691  8.833  356.37 1.061e-11 3.017e-08
## Mid1      1.5191  6.931  120.15 1.844e-08 3.497e-05
## H13      -1.0596  7.540   80.80 2.373e-07 2.527e-04
## Kcnq1ot1  1.3763  7.242   83.31 2.392e-07 2.527e-04
## Akr1e1   -1.7206  5.128   79.31 2.665e-07 2.527e-04
## Zdbf2     1.8008  6.797   83.66 6.809e-07 5.533e-04
## Asb4     -0.9235  7.341   53.45 2.918e-06 2.075e-03
## Impact    0.8516  7.353   50.31 4.145e-06 2.620e-03
## Lum      -0.6031  9.275   41.67 1.205e-05 6.851e-03</code></pre>
</div>
</div>
<div id="putting-it-all-together" class="section level3">
<h3><span class="header-section-number">14.3.3</span> Putting it all together</h3>
<div id="looping-across-labels" class="section level4">
<h4><span class="header-section-number">14.3.3.1</span> Looping across labels</h4>
<p>Now that we have laid out the theory underlying the DE analysis,
we repeat this process for each of the labels to identify injection-induced DE in each cell type.
This is conveniently done using the <code>pseudoBulkDGE()</code> function from <em><a href="https://bioconductor.org/packages/3.12/scran">scran</a></em>,
which will loop over all labels and apply the exact analysis described above to each label.
(Users can also set <code>method=&quot;voom&quot;</code> to perform an equivalent analysis using the <code>voom()</code> pipeline from <em><a href="https://bioconductor.org/packages/3.12/limma">limma</a></em> -
see Chapter <a href="segerstolpe-human-pancreas-smart-seq2.html#segerstolpe-comparison">33.9</a> for the full set of function calls.)</p>
<div class="sourceCode" id="cb506"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb506-1" data-line-number="1"><span class="co"># Removing all pseudo-bulk samples with &#39;insufficient&#39; cells.</span></a>
<a class="sourceLine" id="cb506-2" data-line-number="2">summed.filt &lt;-<span class="st"> </span>summed[,summed<span class="op">$</span>ncells <span class="op">&gt;=</span><span class="st"> </span><span class="dv">10</span>]</a>
<a class="sourceLine" id="cb506-3" data-line-number="3"></a>
<a class="sourceLine" id="cb506-4" data-line-number="4"><span class="kw">library</span>(scran)</a>
<a class="sourceLine" id="cb506-5" data-line-number="5">de.results &lt;-<span class="st"> </span><span class="kw">pseudoBulkDGE</span>(summed.filt, </a>
<a class="sourceLine" id="cb506-6" data-line-number="6">    <span class="dt">label=</span>summed.filt<span class="op">$</span>celltype.mapped,</a>
<a class="sourceLine" id="cb506-7" data-line-number="7">    <span class="dt">design=</span><span class="op">~</span><span class="kw">factor</span>(pool) <span class="op">+</span><span class="st"> </span>tomato,</a>
<a class="sourceLine" id="cb506-8" data-line-number="8">    <span class="dt">coef=</span><span class="st">&quot;tomatoTRUE&quot;</span>,</a>
<a class="sourceLine" id="cb506-9" data-line-number="9">    <span class="dt">condition=</span>summed.filt<span class="op">$</span>tomato </a>
<a class="sourceLine" id="cb506-10" data-line-number="10">)</a></code></pre></div>
<p>The function returns a list of <code>DataFrame</code>s containing the DE results for each label.
Each <code>DataFrame</code> also contains the intermediate <em><a href="https://bioconductor.org/packages/3.12/edgeR">edgeR</a></em> objects used in the DE analyses,
which can be used to generate any of previously described diagnostic plots (Figure <a href="multi-sample-comparisons.html#fig:allantois-dispersion">14.7</a>).
It is often wise to generate these plots to ensure that any interesting results are not compromised by technical issues.</p>
<div class="sourceCode" id="cb507"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb507-1" data-line-number="1">cur.results &lt;-<span class="st"> </span>de.results[[<span class="st">&quot;Allantois&quot;</span>]]</a>
<a class="sourceLine" id="cb507-2" data-line-number="2">cur.results[<span class="kw">order</span>(cur.results<span class="op">$</span>PValue),]</a></code></pre></div>
<pre><code>## DataFrame with 14699 rows and 5 columns
##                               logFC    logCPM         F      PValue         FDR
##                           &lt;numeric&gt; &lt;numeric&gt; &lt;numeric&gt;   &lt;numeric&gt;   &lt;numeric&gt;
## Phlda2                    -2.489508  12.58150  1207.016 3.33486e-21 1.60507e-17
## Xist                      -7.978532   8.00166  1092.831 1.27783e-17 3.07510e-14
## Erdr1                      1.947170   9.07321   296.937 1.58009e-14 2.53500e-11
## Slc22a18                  -4.347153   4.04380   117.389 1.92517e-10 2.31647e-07
## Slc38a4                    0.891849  10.24094   113.899 2.52208e-10 2.42776e-07
## ...                             ...       ...       ...         ...         ...
## Ccl27a_ENSMUSG00000095247        NA        NA        NA          NA          NA
## CR974586.5                       NA        NA        NA          NA          NA
## AC132444.6                       NA        NA        NA          NA          NA
## Vmn2r122                         NA        NA        NA          NA          NA
## CAAA01147332.1                   NA        NA        NA          NA          NA</code></pre>
<div class="sourceCode" id="cb509"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb509-1" data-line-number="1">y.allantois &lt;-<span class="st"> </span><span class="kw">metadata</span>(cur.results)<span class="op">$</span>y</a>
<a class="sourceLine" id="cb509-2" data-line-number="2"><span class="kw">plotBCV</span>(y.allantois)</a></code></pre></div>
<div class="figure"><span id="fig:allantois-dispersion"></span>
<img src="sample-comparisons_files/figure-html/allantois-dispersion-1.png" alt="Biological coefficient of variation (BCV) for each gene as a function of the average abundance for the allantois pseudo-bulk analysis. Trended and common BCV estimates are shown in blue and red, respectively." width="672" />
<p class="caption">
Figure 14.7: Biological coefficient of variation (BCV) for each gene as a function of the average abundance for the allantois pseudo-bulk analysis. Trended and common BCV estimates are shown in blue and red, respectively.
</p>
</div>
<p>We list the labels that were skipped due to the absence of replicates or contrasts.
If it is necessary to extract statistics in the absence of replicates, several strategies can be applied such as reducing the complexity of the model or using a predefined value for the NB dispersion.
We refer readers to the <em><a href="https://bioconductor.org/packages/3.12/edgeR">edgeR</a></em> user’s guide for more details.</p>
<div class="sourceCode" id="cb510"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb510-1" data-line-number="1"><span class="kw">metadata</span>(de.results)<span class="op">$</span>failed</a></code></pre></div>
<pre><code>## [1] &quot;Blood progenitors 1&quot; &quot;Caudal epiblast&quot;     &quot;Caudal neurectoderm&quot;
## [4] &quot;ExE ectoderm&quot;        &quot;Parietal endoderm&quot;   &quot;Stripped&quot;</code></pre>
</div>
<div id="cross-label-meta-analyses" class="section level4">
<h4><span class="header-section-number">14.3.3.2</span> Cross-label meta-analyses</h4>
<p>We examine the numbers of DEGs at a FDR of 5% for each label using the <code>decideTestsPerLabel()</code> function.
In general, there seems to be very little differential expression that is introduced by injection.
Note that genes listed as <code>NA</code> were either filtered out as low-abundance genes for a given label’s analysis,
or the comparison of interest was not possible for a particular label,
e.g., due to lack of residual degrees of freedom or an absence of samples from both conditions.</p>
<div class="sourceCode" id="cb512"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb512-1" data-line-number="1">is.de &lt;-<span class="st"> </span><span class="kw">decideTestsPerLabel</span>(de.results, <span class="dt">threshold=</span><span class="fl">0.05</span>)</a>
<a class="sourceLine" id="cb512-2" data-line-number="2"><span class="kw">summarizeTestsPerLabel</span>(is.de)</a></code></pre></div>
<pre><code>##                                -1    0  1    NA
## Allantois                      23 4766 24  9886
## Blood progenitors 2             1 2472  2 12224
## Cardiomyocytes                  6 4361  5 10327
## Caudal Mesoderm                 2 1742  0 12955
## Def. endoderm                   7 1392  2 13298
## Endothelium                     3 3222  6 11468
## Erythroid1                     12 2777 15 11895
## Erythroid2                      5 3389  8 11297
## Erythroid3                     13 5048 16  9622
## ExE mesoderm                    2 5097 10  9590
## Forebrain/Midbrain/Hindbrain    8 6226 11  8454
## Gut                             5 4482  6 10206
## Haematoendothelial progenitors  4 4103 10 10582
## Intermediate mesoderm           4 3072  4 11619
## Mesenchyme                      8 5672  8  9011
## NMP                             6 4107 10 10576
## Neural crest                    6 3311  8 11374
## Paraxial mesoderm               4 4756  5  9934
## Pharyngeal mesoderm             2 5082  9  9606
## Rostral neurectoderm            5 3334  4 11356
## Somitic mesoderm                7 2948 13 11731
## Spinal cord                     7 4591  7 10094
## Surface ectoderm                9 5556  8  9126</code></pre>
<p>For each gene, we compute the percentage of cell types in which that gene is upregulated or downregulated upon injection.
(Here, we consider a gene to be non-DE if it is not retained after filtering.)
We see that <em>Xist</em> is consistently downregulated in the injected cells;
this is consistent with the fact that the injected cells are male while the background cells are derived from pools of male and female embryos, due to experimental difficulties with resolving sex at this stage.
The consistent downregulation of <em>Phlda2</em> and <em>Cdkn1c</em> in the injected cells is also interesting given that both are imprinted genes.
However, some of these commonalities may be driven by shared contamination from ambient RNA - we discuss this further in Section <a href="multi-sample-comparisons.html#ambient-problems">14.4</a>.</p>
<div class="sourceCode" id="cb514"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb514-1" data-line-number="1"><span class="co"># Upregulated across most cell types.</span></a>
<a class="sourceLine" id="cb514-2" data-line-number="2">up.de &lt;-<span class="st"> </span>is.de <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span> <span class="op">&amp;</span><span class="st"> </span><span class="op">!</span><span class="kw">is.na</span>(is.de)</a>
<a class="sourceLine" id="cb514-3" data-line-number="3"><span class="kw">head</span>(<span class="kw">sort</span>(<span class="kw">rowMeans</span>(up.de), <span class="dt">decreasing=</span><span class="ot">TRUE</span>), <span class="dv">10</span>)</a></code></pre></div>
<pre><code>##     Mid1    Erdr1   Impact    Mcts2 Kcnq1ot1     Nnat  Slc38a4    Zdbf2 
##   0.9130   0.7391   0.6087   0.5652   0.5652   0.5217   0.4348   0.3913 
##     Hopx     Peg3 
##   0.3913   0.2609</code></pre>
<div class="sourceCode" id="cb516"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb516-1" data-line-number="1"><span class="co"># Downregulated across cell types.</span></a>
<a class="sourceLine" id="cb516-2" data-line-number="2">down.de &lt;-<span class="st"> </span>is.de <span class="op">&lt;</span><span class="st"> </span><span class="dv">0</span> <span class="op">&amp;</span><span class="st"> </span><span class="op">!</span><span class="kw">is.na</span>(is.de)</a>
<a class="sourceLine" id="cb516-3" data-line-number="3"><span class="kw">head</span>(<span class="kw">sort</span>(<span class="kw">rowMeans</span>(down.de), <span class="dt">decreasing=</span><span class="ot">TRUE</span>), <span class="dv">10</span>)</a></code></pre></div>
<pre><code>##          Xist        Phlda2        Akr1e1        Cdkn1c           H13 
##       0.73913       0.73913       0.73913       0.69565       0.52174 
##         Wfdc2 B930036N10Rik B230312C02Rik         Pink1         Mfap2 
##       0.21739       0.08696       0.08696       0.08696       0.08696</code></pre>
<!--
Here we have a look at the effects of contamination, for curiosity's sake.


-->
<p>To identify label-specific DE, we use the <code>pseudoBulkSpecific()</code> function to test for significant differences from the average log-fold change over all other labels.
More specifically, the null hypothesis for each label and gene is that the log-fold change lies between zero and the average log-fold change of the other labels.
If a gene rejects this null for our label of interest, we can conclude that it exhibits DE that is more extreme or of the opposite sign compared to that in the majority of other labels (Figure <a href="multi-sample-comparisons.html#fig:exprs-unique-de-allantois">14.8</a>).
This approach is effectively a poor man’s interaction model that sacrifices the uncertainty of the average for an easier compute.
We note that, while the difference from the average is a good heuristic, there is no guarantee that the top genes are truly label-specific; comparable DE in a subset of the other labels may be offset by weaker effects when computing the average.</p>
<div class="sourceCode" id="cb518"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb518-1" data-line-number="1">de.specific &lt;-<span class="st"> </span><span class="kw">pseudoBulkSpecific</span>(summed.filt,</a>
<a class="sourceLine" id="cb518-2" data-line-number="2">    <span class="dt">label=</span>summed.filt<span class="op">$</span>celltype.mapped,</a>
<a class="sourceLine" id="cb518-3" data-line-number="3">    <span class="dt">design=</span><span class="op">~</span><span class="kw">factor</span>(pool) <span class="op">+</span><span class="st"> </span>tomato,</a>
<a class="sourceLine" id="cb518-4" data-line-number="4">    <span class="dt">coef=</span><span class="st">&quot;tomatoTRUE&quot;</span>,</a>
<a class="sourceLine" id="cb518-5" data-line-number="5">    <span class="dt">condition=</span>summed.filt<span class="op">$</span>tomato</a>
<a class="sourceLine" id="cb518-6" data-line-number="6">)</a>
<a class="sourceLine" id="cb518-7" data-line-number="7"></a>
<a class="sourceLine" id="cb518-8" data-line-number="8">cur.specific &lt;-<span class="st"> </span>de.specific[[<span class="st">&quot;Allantois&quot;</span>]]</a>
<a class="sourceLine" id="cb518-9" data-line-number="9">cur.specific &lt;-<span class="st"> </span>cur.specific[<span class="kw">order</span>(cur.specific<span class="op">$</span>PValue),]</a>
<a class="sourceLine" id="cb518-10" data-line-number="10">cur.specific</a></code></pre></div>
<pre><code>## DataFrame with 14699 rows and 6 columns
##                               logFC    logCPM         F      PValue         FDR
##                           &lt;numeric&gt; &lt;numeric&gt; &lt;numeric&gt;   &lt;numeric&gt;   &lt;numeric&gt;
## Slc22a18                  -4.347153   4.04380  117.3889 1.92517e-10 9.26587e-07
## Acta2                     -0.829713   9.12472   55.6350 4.67332e-07 1.12463e-03
## Mxd4                      -1.421473   5.64606   50.2112 2.03567e-06 3.26589e-03
## Rbp4                       1.874290   4.35449   29.8731 1.53998e-05 1.85298e-02
## Myl9                      -0.985541   6.24833   30.6689 5.54072e-05 4.62274e-02
## ...                             ...       ...       ...         ...         ...
## Ccl27a_ENSMUSG00000095247        NA        NA        NA          NA          NA
## CR974586.5                       NA        NA        NA          NA          NA
## AC132444.6                       NA        NA        NA          NA          NA
## Vmn2r122                         NA        NA        NA          NA          NA
## CAAA01147332.1                   NA        NA        NA          NA          NA
##                           OtherAverage
##                              &lt;numeric&gt;
## Slc22a18                            NA
## Acta2                       -0.0267428
## Mxd4                        -0.1565876
## Rbp4                        -0.1052237
## Myl9                        -0.1068453
## ...                                ...
## Ccl27a_ENSMUSG00000095247           NA
## CR974586.5                          NA
## AC132444.6                          NA
## Vmn2r122                            NA
## CAAA01147332.1                      NA</code></pre>
<div class="sourceCode" id="cb520"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb520-1" data-line-number="1"><span class="kw">sizeFactors</span>(summed.filt) &lt;-<span class="st"> </span><span class="ot">NULL</span></a>
<a class="sourceLine" id="cb520-2" data-line-number="2"><span class="kw">plotExpression</span>(<span class="kw">logNormCounts</span>(summed.filt),</a>
<a class="sourceLine" id="cb520-3" data-line-number="3">    <span class="dt">features=</span><span class="st">&quot;Rbp4&quot;</span>,</a>
<a class="sourceLine" id="cb520-4" data-line-number="4">    <span class="dt">x=</span><span class="st">&quot;tomato&quot;</span>, <span class="dt">colour_by=</span><span class="st">&quot;tomato&quot;</span>,</a>
<a class="sourceLine" id="cb520-5" data-line-number="5">    <span class="dt">other_fields=</span><span class="st">&quot;celltype.mapped&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb520-6" data-line-number="6"><span class="st">    </span><span class="kw">facet_wrap</span>(<span class="op">~</span>celltype.mapped)</a></code></pre></div>
<div class="figure"><span id="fig:exprs-unique-de-allantois"></span>
<img src="sample-comparisons_files/figure-html/exprs-unique-de-allantois-1.png" alt="Distribution of summed log-expression values for _Rbp4_ in each label of the chimeric embryo dataset. Each facet represents a label with distributions stratified by injection status." width="960" />
<p class="caption">
Figure 14.8: Distribution of summed log-expression values for <em>Rbp4</em> in each label of the chimeric embryo dataset. Each facet represents a label with distributions stratified by injection status.
</p>
</div>
<p>For greater control over the identification of label-specific DE, we can use the output of <code>decideTestsPerLabel()</code> to identify genes that are significant in our label of interest yet not DE in any other label.
As hypothesis tests are not typically geared towards identifying genes that are not DE, we use an <em>ad hoc</em> approach where we consider a gene to be consistent with the null hypothesis for a label if it fails to be detected at a generous FDR threshold of 50%.
We demonstrate this approach below by identifying injection-induced DE genes that are unique to the allantois.
It is straightforward to tune the selection, e.g., to genes that are DE in no more than 90% of other labels by simply relaxing the threshold used to construct <code>not.de.other</code>, or to genes that are DE across multiple labels of interest but not in the rest, and so on.</p>
<div class="sourceCode" id="cb521"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb521-1" data-line-number="1"><span class="co"># Finding all genes that are not remotely DE in all other labels.</span></a>
<a class="sourceLine" id="cb521-2" data-line-number="2">remotely.de &lt;-<span class="st"> </span><span class="kw">decideTestsPerLabel</span>(de.results, <span class="dt">threshold=</span><span class="fl">0.5</span>)</a>
<a class="sourceLine" id="cb521-3" data-line-number="3">not.de &lt;-<span class="st"> </span>remotely.de<span class="op">==</span><span class="dv">0</span> <span class="op">|</span><span class="st"> </span><span class="kw">is.na</span>(remotely.de)</a>
<a class="sourceLine" id="cb521-4" data-line-number="4">not.de.other &lt;-<span class="st"> </span><span class="kw">rowMeans</span>(not.de[,<span class="kw">colnames</span>(not.de)<span class="op">!=</span><span class="st">&quot;Allantois&quot;</span>])<span class="op">==</span><span class="dv">1</span></a>
<a class="sourceLine" id="cb521-5" data-line-number="5"></a>
<a class="sourceLine" id="cb521-6" data-line-number="6"><span class="co"># Intersecting with genes that are DE inthe allantois.</span></a>
<a class="sourceLine" id="cb521-7" data-line-number="7">unique.degs &lt;-<span class="st"> </span>is.de[,<span class="st">&quot;Allantois&quot;</span>]<span class="op">!=</span><span class="dv">0</span> <span class="op">&amp;</span><span class="st"> </span>not.de.other</a>
<a class="sourceLine" id="cb521-8" data-line-number="8">unique.degs &lt;-<span class="st"> </span><span class="kw">names</span>(<span class="kw">which</span>(unique.degs))</a>
<a class="sourceLine" id="cb521-9" data-line-number="9"></a>
<a class="sourceLine" id="cb521-10" data-line-number="10"><span class="co"># Inspecting the results.</span></a>
<a class="sourceLine" id="cb521-11" data-line-number="11">de.allantois &lt;-<span class="st"> </span>de.results<span class="op">$</span>Allantois</a>
<a class="sourceLine" id="cb521-12" data-line-number="12">de.allantois &lt;-<span class="st"> </span>de.allantois[unique.degs,]</a>
<a class="sourceLine" id="cb521-13" data-line-number="13">de.allantois &lt;-<span class="st"> </span>de.allantois[<span class="kw">order</span>(de.allantois<span class="op">$</span>PValue),]</a>
<a class="sourceLine" id="cb521-14" data-line-number="14">de.allantois</a></code></pre></div>
<pre><code>## DataFrame with 5 rows and 5 columns
##              logFC    logCPM         F      PValue         FDR
##          &lt;numeric&gt; &lt;numeric&gt; &lt;numeric&gt;   &lt;numeric&gt;   &lt;numeric&gt;
## Slc22a18 -4.347153   4.04380  117.3889 1.92517e-10 2.31647e-07
## Rbp4      1.874290   4.35449   29.8731 1.53998e-05 3.36906e-03
## Cfc1     -0.950562   5.74762   23.1430 7.68376e-05 1.23215e-02
## H3f3b     0.321634  12.04012   21.2710 1.25666e-04 1.63468e-02
## Cryab    -0.995629   5.28422   19.5921 1.99204e-04 2.45838e-02</code></pre>
<p>The main caveat is that differences in power between labels require some caution when interpreting label specificity.
For example, Figure <a href="multi-sample-comparisons.html#fig:exprs-unique-de-allantois-more">14.9</a> shows that the top-ranked allantois-specific gene exhibits some evidence of DE in other labels but was not detected for various reasons like low abundance or insufficient replicates.
A more correct but complex approach would be to fit a interaction model to the pseudo-bulk profiles for each pair of labels, where the interaction is between the coefficient of interest and the label identity; this is left as an exercise for the reader.</p>
<div class="sourceCode" id="cb523"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb523-1" data-line-number="1"><span class="kw">plotExpression</span>(<span class="kw">logNormCounts</span>(summed.filt), </a>
<a class="sourceLine" id="cb523-2" data-line-number="2">    <span class="dt">features=</span><span class="st">&quot;Slc22a18&quot;</span>,</a>
<a class="sourceLine" id="cb523-3" data-line-number="3">    <span class="dt">x=</span><span class="st">&quot;tomato&quot;</span>, <span class="dt">colour_by=</span><span class="st">&quot;tomato&quot;</span>, </a>
<a class="sourceLine" id="cb523-4" data-line-number="4">    <span class="dt">other_fields=</span><span class="st">&quot;celltype.mapped&quot;</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb523-5" data-line-number="5"><span class="st">    </span><span class="kw">facet_wrap</span>(<span class="op">~</span>celltype.mapped)</a></code></pre></div>
<div class="figure"><span id="fig:exprs-unique-de-allantois-more"></span>
<img src="sample-comparisons_files/figure-html/exprs-unique-de-allantois-more-1.png" alt="Distribution of summed log-expression values for each label in the chimeric embryo dataset. Each facet represents a label with distributions stratified by injection status." width="960" />
<p class="caption">
Figure 14.9: Distribution of summed log-expression values for each label in the chimeric embryo dataset. Each facet represents a label with distributions stratified by injection status.
</p>
</div>
</div>
</div>
</div>
<div id="ambient-problems" class="section level2">
<h2><span class="header-section-number">14.4</span> Avoiding problems with ambient RNA</h2>
<div id="motivation-1" class="section level3">
<h3><span class="header-section-number">14.4.1</span> Motivation</h3>
<p>Ambient contamination is a phenomenon that is generally most pronounced in massively multiplexed scRNA-seq protocols.
Briefly, extracellular RNA (most commonly released upon cell lysis) is captured along with each cell in its reaction chamber, contributing counts to genes that are not otherwise expressed in that cell (see Section <a href="droplet-processing.html#qc-droplets">15.2</a>).
Differences in the ambient profile across samples are not uncommon when dealing with strong experimental perturbations where strong expression of a gene in a condition-specific cell type can “bleed over” into all other cell types in the same sample.
This is problematic for DE analyses between conditions, as DEGs detected for a particular cell type may be driven by differences in the ambient profiles rather than any intrinsic change in gene regulation.</p>
<p>To illustrate, we consider the <em>Tal1</em>-knockout (KO) chimera data from <span class="citation">Pijuan-Sala et al. (<a href="#ref-pijuansala2019single">2019</a>)</span>.
This is very similar to the WT chimera dataset we previously examined, only differing in that the <em>Tal1</em> gene was knocked out in the injected cells.
<em>Tal1</em> is a transcription factor that has known roles in erythroid differentiation; the aim of the experiment was to determine if blocking of the erythroid lineage diverted cells to other developmental fates.
(To cut a long story short: yes, it did.)</p>
<div class="sourceCode" id="cb524"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb524-1" data-line-number="1"><span class="kw">library</span>(MouseGastrulationData)</a>
<a class="sourceLine" id="cb524-2" data-line-number="2">sce.tal1 &lt;-<span class="st"> </span><span class="kw">Tal1ChimeraData</span>()</a>
<a class="sourceLine" id="cb524-3" data-line-number="3"></a>
<a class="sourceLine" id="cb524-4" data-line-number="4"><span class="kw">library</span>(scuttle)</a>
<a class="sourceLine" id="cb524-5" data-line-number="5"><span class="kw">rownames</span>(sce.tal1) &lt;-<span class="st"> </span><span class="kw">uniquifyFeatureNames</span>(</a>
<a class="sourceLine" id="cb524-6" data-line-number="6">    <span class="kw">rowData</span>(sce.tal1)<span class="op">$</span>ENSEMBL, </a>
<a class="sourceLine" id="cb524-7" data-line-number="7">    <span class="kw">rowData</span>(sce.tal1)<span class="op">$</span>SYMBOL</a>
<a class="sourceLine" id="cb524-8" data-line-number="8">)</a>
<a class="sourceLine" id="cb524-9" data-line-number="9">sce.tal1</a></code></pre></div>
<pre><code>## class: SingleCellExperiment 
## dim: 29453 56122 
## metadata(0):
## assays(1): counts
## rownames(29453): Xkr4 Gm1992 ... CAAA01147332.1 tomato-td
## rowData names(2): ENSEMBL SYMBOL
## colnames(56122): cell_1 cell_2 ... cell_56121 cell_56122
## colData names(9): cell barcode ... pool sizeFactor
## reducedDimNames(1): pca.corrected
## altExpNames(0):</code></pre>
<p>We will perform a DE analysis between WT and KO cells labelled as “neural crest”.
We observe that the strongest DEGs are the hemoglobins, which are downregulated in the injected cells.
This is rather surprising as these cells are distinct from the erythroid lineage and should not express hemoglobins at all.
The most sober explanation is that the background samples contain more hemoglobin transcripts in the ambient solution due to leakage from erythrocytes (or their precursors) during sorting and dissociation.</p>
<div class="sourceCode" id="cb526"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb526-1" data-line-number="1">summed.tal1 &lt;-<span class="st"> </span><span class="kw">aggregateAcrossCells</span>(sce.tal1, </a>
<a class="sourceLine" id="cb526-2" data-line-number="2">    <span class="dt">ids=</span><span class="kw">DataFrame</span>(<span class="dt">sample=</span>sce.tal1<span class="op">$</span>sample,</a>
<a class="sourceLine" id="cb526-3" data-line-number="3">        <span class="dt">label=</span>sce.tal1<span class="op">$</span>celltype.mapped)</a>
<a class="sourceLine" id="cb526-4" data-line-number="4">)</a>
<a class="sourceLine" id="cb526-5" data-line-number="5">summed.tal1<span class="op">$</span>block &lt;-<span class="st"> </span>summed.tal1<span class="op">$</span>sample <span class="op">%%</span><span class="st"> </span><span class="dv">2</span> <span class="op">==</span><span class="st"> </span><span class="dv">0</span> <span class="co"># Add blocking factor.</span></a>
<a class="sourceLine" id="cb526-6" data-line-number="6"></a>
<a class="sourceLine" id="cb526-7" data-line-number="7"><span class="co"># Subset to our neural crest cells.</span></a>
<a class="sourceLine" id="cb526-8" data-line-number="8">summed.neural &lt;-<span class="st"> </span>summed.tal1[,summed.tal1<span class="op">$</span>label<span class="op">==</span><span class="st">&quot;Neural crest&quot;</span>]</a>
<a class="sourceLine" id="cb526-9" data-line-number="9">summed.neural</a></code></pre></div>
<pre><code>## class: SingleCellExperiment 
## dim: 29453 4 
## metadata(0):
## assays(1): counts
## rownames(29453): Xkr4 Gm1992 ... CAAA01147332.1 tomato-td
## rowData names(2): ENSEMBL SYMBOL
## colnames: NULL
## colData names(13): cell barcode ... ncells block
## reducedDimNames(1): pca.corrected
## altExpNames(0):</code></pre>
<div class="sourceCode" id="cb528"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb528-1" data-line-number="1"><span class="co"># Standard edgeR analysis, as described above.</span></a>
<a class="sourceLine" id="cb528-2" data-line-number="2">res.neural &lt;-<span class="st"> </span><span class="kw">pseudoBulkDGE</span>(summed.neural, </a>
<a class="sourceLine" id="cb528-3" data-line-number="3">    <span class="dt">label=</span>summed.neural<span class="op">$</span>label,</a>
<a class="sourceLine" id="cb528-4" data-line-number="4">    <span class="dt">design=</span><span class="op">~</span><span class="kw">factor</span>(block) <span class="op">+</span><span class="st"> </span>tomato,</a>
<a class="sourceLine" id="cb528-5" data-line-number="5">    <span class="dt">coef=</span><span class="st">&quot;tomatoTRUE&quot;</span>,</a>
<a class="sourceLine" id="cb528-6" data-line-number="6">    <span class="dt">condition=</span>summed.neural<span class="op">$</span>tomato)</a>
<a class="sourceLine" id="cb528-7" data-line-number="7"><span class="kw">summarizeTestsPerLabel</span>(<span class="kw">decideTestsPerLabel</span>(res.neural))</a></code></pre></div>
<pre><code>##               -1    0   1    NA
## Neural crest 351 9818 481 18803</code></pre>
<div class="sourceCode" id="cb530"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb530-1" data-line-number="1"><span class="co"># Summary of the direction of log-fold changes.</span></a>
<a class="sourceLine" id="cb530-2" data-line-number="2">tab.neural &lt;-<span class="st"> </span>res.neural[[<span class="dv">1</span>]]</a>
<a class="sourceLine" id="cb530-3" data-line-number="3">tab.neural &lt;-<span class="st"> </span>tab.neural[<span class="kw">order</span>(tab.neural<span class="op">$</span>PValue),]</a>
<a class="sourceLine" id="cb530-4" data-line-number="4"><span class="kw">head</span>(tab.neural, <span class="dv">10</span>)</a></code></pre></div>
<pre><code>## DataFrame with 10 rows and 5 columns
##             logFC    logCPM         F       PValue          FDR
##         &lt;numeric&gt; &lt;numeric&gt; &lt;numeric&gt;    &lt;numeric&gt;    &lt;numeric&gt;
## Xist    -7.555686   8.21232  6657.298  0.00000e+00  0.00000e+00
## Hbb-bh1 -8.091042   9.15972 10758.256  0.00000e+00  0.00000e+00
## Hbb-y   -8.415622   8.35705  7364.290  0.00000e+00  0.00000e+00
## Hba-x   -7.724803   8.53284  7896.457  0.00000e+00  0.00000e+00
## Hba-a1  -8.596706   6.74429  2756.573  0.00000e+00  0.00000e+00
## Hba-a2  -8.866232   5.81300  1517.726 1.72378e-310 3.05972e-307
## Erdr1    1.889536   7.61593  1407.112 2.34678e-289 3.57046e-286
## Cdkn1c  -8.864528   4.96097   814.936 8.79980e-173 1.17147e-169
## Uba52   -0.879668   8.38618   424.191  1.86584e-92  2.20792e-89
## Grb10   -1.403427   6.58314   401.353  1.13898e-87  1.21302e-84</code></pre>
<p>As an aside, it is worth mentioning that the “replicates” in this study are more technical than biological,
so some exaggeration of the significance of the effects is to be expected.
Nonetheless, it is a useful dataset to demonstrate some strategies for mitigating issues caused by ambient contamination.</p>
</div>
<div id="finding-affected-degs" class="section level3">
<h3><span class="header-section-number">14.4.2</span> Finding affected DEGs</h3>
<div id="by-estimating-ambient-contamination" class="section level4">
<h4><span class="header-section-number">14.4.2.1</span> By estimating ambient contamination</h4>
<p>As shown above, the presence of ambient contamination makes it difficult to interpret multi-condition DE analyses.
To mitigate its effects, we need to obtain an estimate of the ambient “expression” profile from the raw count matrix for each sample.
We follow the approach used in <code>emptyDrops()</code> <span class="citation">(Lun et al. <a href="#ref-lun2018distinguishing">2019</a>)</span> and consider all barcodes with total counts below 100 to represent empty droplets.
We then sum the counts for each gene across these barcodes to obtain an expression vector representing the ambient profile for each sample.</p>
<div class="sourceCode" id="cb532"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb532-1" data-line-number="1"><span class="kw">library</span>(DropletUtils)</a>
<a class="sourceLine" id="cb532-2" data-line-number="2">ambient &lt;-<span class="st"> </span><span class="kw">vector</span>(<span class="st">&quot;list&quot;</span>, <span class="kw">ncol</span>(summed.neural))</a>
<a class="sourceLine" id="cb532-3" data-line-number="3"></a>
<a class="sourceLine" id="cb532-4" data-line-number="4"><span class="co"># Looping over all raw (unfiltered) count matrices and</span></a>
<a class="sourceLine" id="cb532-5" data-line-number="5"><span class="co"># computing the ambient profile based on its low-count barcodes.</span></a>
<a class="sourceLine" id="cb532-6" data-line-number="6"><span class="co"># Turning off rounding, as we know this is count data.</span></a>
<a class="sourceLine" id="cb532-7" data-line-number="7"><span class="cf">for</span> (s <span class="cf">in</span> <span class="kw">seq_along</span>(ambient)) {</a>
<a class="sourceLine" id="cb532-8" data-line-number="8">    raw.tal1 &lt;-<span class="st"> </span><span class="kw">Tal1ChimeraData</span>(<span class="dt">type=</span><span class="st">&quot;raw&quot;</span>, <span class="dt">samples=</span>s)[[<span class="dv">1</span>]]</a>
<a class="sourceLine" id="cb532-9" data-line-number="9">    ambient[[s]] &lt;-<span class="st"> </span><span class="kw">estimateAmbience</span>(<span class="kw">counts</span>(raw.tal1), </a>
<a class="sourceLine" id="cb532-10" data-line-number="10">        <span class="dt">good.turing=</span><span class="ot">FALSE</span>, <span class="dt">round=</span><span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb532-11" data-line-number="11">}</a>
<a class="sourceLine" id="cb532-12" data-line-number="12"></a>
<a class="sourceLine" id="cb532-13" data-line-number="13"><span class="co"># Cleaning up the output for pretty printing.</span></a>
<a class="sourceLine" id="cb532-14" data-line-number="14">ambient &lt;-<span class="st"> </span><span class="kw">do.call</span>(cbind, ambient)</a>
<a class="sourceLine" id="cb532-15" data-line-number="15"><span class="kw">colnames</span>(ambient) &lt;-<span class="st"> </span><span class="kw">seq_len</span>(<span class="kw">ncol</span>(ambient))</a>
<a class="sourceLine" id="cb532-16" data-line-number="16"><span class="kw">rownames</span>(ambient) &lt;-<span class="st"> </span><span class="kw">uniquifyFeatureNames</span>(</a>
<a class="sourceLine" id="cb532-17" data-line-number="17">    <span class="kw">rowData</span>(raw.tal1)<span class="op">$</span>ENSEMBL, </a>
<a class="sourceLine" id="cb532-18" data-line-number="18">    <span class="kw">rowData</span>(raw.tal1)<span class="op">$</span>SYMBOL</a>
<a class="sourceLine" id="cb532-19" data-line-number="19">)</a>
<a class="sourceLine" id="cb532-20" data-line-number="20"><span class="kw">head</span>(ambient)</a></code></pre></div>
<pre><code>##          1  2  3  4
## Xkr4     1  0  0  0
## Gm1992   0  0  0  0
## Gm37381  1  0  1  0
## Rp1      0  1  0  1
## Sox17   76 76 31 53
## Gm37323  0  0  0  0</code></pre>
<p>For each sample, we determine the maximum proportion of the count for each gene that could be attributed to ambient contamination.
This is done by scaling the ambient profile in <code>ambient</code> to obtain a per-gene expected count from ambient contamination, with which we compute the <span class="math inline">\(p\)</span>-value for observing a count equal to or lower than that in <code>summed.neural</code>.
We perform this for a range of scaling factors and identify the largest factor that yields a <span class="math inline">\(p\)</span>-value above a given threshold.
The scaled ambient profile represents the upper bound of the contribution to each sample from ambient contamination.
We deliberately use an upper bound so that our next step will aggressively remove any gene that is potentially problematic.</p>
<div class="sourceCode" id="cb534"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb534-1" data-line-number="1">max.ambient &lt;-<span class="st"> </span><span class="kw">maximumAmbience</span>(<span class="kw">counts</span>(summed.neural), </a>
<a class="sourceLine" id="cb534-2" data-line-number="2">    ambient, <span class="dt">mode=</span><span class="st">&quot;proportion&quot;</span>)</a>
<a class="sourceLine" id="cb534-3" data-line-number="3"><span class="kw">head</span>(max.ambient)</a></code></pre></div>
<pre><code>##           [,1]   [,2]  [,3] [,4]
## Xkr4       NaN    NaN   NaN  NaN
## Gm1992     NaN    NaN   NaN  NaN
## Gm37381    NaN    NaN   NaN  NaN
## Rp1        NaN    NaN   NaN  NaN
## Sox17   0.1775 0.1833 0.468    1
## Gm37323    NaN    NaN   NaN  NaN</code></pre>
<p>Genes in which over 10% of the counts are ambient-derived (averaged across samples) are subsequently discarded from our analysis.
For balanced designs, this threshold prevents ambient contribution from biasing the true fold-change by more than 10%, which is a tolerable margin of error for most applications.
(Unbalanced designs may warrant the use of a weighted average to account for sample size differences between groups.)
This approach yields a slightly smaller list of DEGs without the hemoglobins, which is encouraging as it suggests that any other (less obvious) effects of ambient contamination have also been removed.</p>
<div class="sourceCode" id="cb536"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb536-1" data-line-number="1">contamination &lt;-<span class="st"> </span><span class="kw">rowMeans</span>(max.ambient, <span class="dt">na.rm=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb536-2" data-line-number="2">non.ambient &lt;-<span class="st"> </span>contamination <span class="op">&lt;=</span><span class="st"> </span><span class="fl">0.1</span></a>
<a class="sourceLine" id="cb536-3" data-line-number="3"><span class="kw">summary</span>(non.ambient)</a></code></pre></div>
<pre><code>##    Mode   FALSE    TRUE    NA&#39;s 
## logical    1475   15306   12672</code></pre>
<div class="sourceCode" id="cb538"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb538-1" data-line-number="1">okay.genes &lt;-<span class="st"> </span><span class="kw">names</span>(non.ambient)[<span class="kw">which</span>(non.ambient)]</a>
<a class="sourceLine" id="cb538-2" data-line-number="2">tab.neural2 &lt;-<span class="st"> </span>tab.neural[<span class="kw">rownames</span>(tab.neural) <span class="op">%in%</span><span class="st"> </span>okay.genes,]</a>
<a class="sourceLine" id="cb538-3" data-line-number="3"></a>
<a class="sourceLine" id="cb538-4" data-line-number="4"><span class="kw">table</span>(<span class="dt">Direction=</span>tab.neural2<span class="op">$</span>logFC <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>, <span class="dt">Significant=</span>tab.neural2<span class="op">$</span>FDR <span class="op">&lt;=</span><span class="st"> </span><span class="fl">0.05</span>)</a></code></pre></div>
<pre><code>##          Significant
## Direction FALSE TRUE
##     FALSE  4820  317
##     TRUE   4781  452</code></pre>
<div class="sourceCode" id="cb540"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb540-1" data-line-number="1"><span class="kw">head</span>(tab.neural2, <span class="dv">10</span>)</a></code></pre></div>
<pre><code>## DataFrame with 10 rows and 5 columns
##                   logFC    logCPM         F       PValue          FDR
##               &lt;numeric&gt; &lt;numeric&gt; &lt;numeric&gt;    &lt;numeric&gt;    &lt;numeric&gt;
## Xist          -7.555686   8.21232  6657.298  0.00000e+00  0.00000e+00
## Erdr1          1.889536   7.61593  1407.112 2.34678e-289 3.57046e-286
## Uba52         -0.879668   8.38618   424.191  1.86584e-92  2.20792e-89
## Grb10         -1.403427   6.58314   401.353  1.13898e-87  1.21302e-84
## Gt(ROSA)26Sor  1.481294   5.71617   351.940  2.80072e-77  2.71161e-74
## Fdps           0.981388   7.21805   337.159  3.67655e-74  3.26294e-71
## Mest           0.549349  10.98269   319.697  1.79832e-70  1.47324e-67
## Impact         1.396666   5.71801   314.700  2.05057e-69  1.55990e-66
## H13           -1.481658   5.90902   301.675  1.17372e-66  8.33343e-64
## Msmo1          1.493771   5.43923   301.066  1.57983e-66  1.05158e-63</code></pre>
<p>A softer approach is to simply report the average contaminating percentage for each gene in the table of DE statistics.
This allows readers to make up their own minds as to whether a particular DEG’s effect is driven by ambient contamination, in much the same way as described for low-quality cells in Section <a href="quality-control.html#marking-qc">6.6</a>.
Indeed, it is worth remembering that <code>maximumAmbience()</code> will report the maximum possible contamination rather than attempting to estimate the actual level of contamination, and filtering on the former may be overly conservative.
This is especially true for cell populations that are contributing to the differences in the ambient pool; in the most extreme case, the reported maximum contamination would be 100% for cell types with an expression profile that is identical to the ambient pool.</p>
<div class="sourceCode" id="cb542"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb542-1" data-line-number="1">tab.neural3 &lt;-<span class="st"> </span>tab.neural</a>
<a class="sourceLine" id="cb542-2" data-line-number="2">tab.neural3<span class="op">$</span>contamination &lt;-<span class="st"> </span>contamination[<span class="kw">rownames</span>(tab.neural3)]</a>
<a class="sourceLine" id="cb542-3" data-line-number="3"><span class="kw">head</span>(tab.neural3)</a></code></pre></div>
<pre><code>## DataFrame with 6 rows and 6 columns
##             logFC    logCPM         F       PValue          FDR contamination
##         &lt;numeric&gt; &lt;numeric&gt; &lt;numeric&gt;    &lt;numeric&gt;    &lt;numeric&gt;     &lt;numeric&gt;
## Xist     -7.55569   8.21232   6657.30  0.00000e+00  0.00000e+00     0.0605735
## Hbb-bh1  -8.09104   9.15972  10758.26  0.00000e+00  0.00000e+00     0.9900717
## Hbb-y    -8.41562   8.35705   7364.29  0.00000e+00  0.00000e+00     0.9674483
## Hba-x    -7.72480   8.53284   7896.46  0.00000e+00  0.00000e+00     0.9945348
## Hba-a1   -8.59671   6.74429   2756.57  0.00000e+00  0.00000e+00     0.8626846
## Hba-a2   -8.86623   5.81300   1517.73 1.72378e-310 3.05972e-307     0.7351403</code></pre>
</div>
<div id="with-prior-knowledge" class="section level4">
<h4><span class="header-section-number">14.4.2.2</span> With prior knowledge</h4>
<p>Another strategy to estimating the ambient proportions involves the use of prior knowledge of mutually exclusive gene expression profiles <span class="citation">(Young and Behjati <a href="#ref-young2018soupx">2018</a>)</span>.
In this case, we assume (reasonably) that hemoglobins should not be expressed in neural crest cells and use this to estimate the contamination in each sample.
This is achieved with the <code>controlAmbience()</code> function, which scales the ambient profile so that the hemoglobin coverage is the same as the corresponding sample of <code>summed.neural</code>.
From these profiles, we compute proportions of ambient contamination that are used to mark or filter out affected genes in the same manner as described above.</p>
<div class="sourceCode" id="cb544"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb544-1" data-line-number="1">is.hbb &lt;-<span class="st"> </span><span class="kw">grep</span>(<span class="st">&quot;^Hb[ab]-&quot;</span>, <span class="kw">rownames</span>(summed.neural))</a>
<a class="sourceLine" id="cb544-2" data-line-number="2">alt.prop &lt;-<span class="st"> </span><span class="kw">controlAmbience</span>(<span class="kw">counts</span>(summed.neural), ambient,</a>
<a class="sourceLine" id="cb544-3" data-line-number="3">    <span class="dt">features=</span>is.hbb,  <span class="dt">mode=</span><span class="st">&quot;proportion&quot;</span>)</a>
<a class="sourceLine" id="cb544-4" data-line-number="4"><span class="kw">head</span>(alt.prop)</a></code></pre></div>
<pre><code>##               1       2      3   4
## Xkr4        NaN     NaN    NaN NaN
## Gm1992      NaN     NaN    NaN NaN
## Gm37381     NaN     NaN    NaN NaN
## Rp1         NaN     NaN    NaN NaN
## Sox17   0.06774 0.08798 0.4796   1
## Gm37323     NaN     NaN    NaN NaN</code></pre>
<div class="sourceCode" id="cb546"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb546-1" data-line-number="1">alt.non.ambient &lt;-<span class="st"> </span><span class="kw">rowMeans</span>(alt.prop, <span class="dt">na.rm=</span><span class="ot">TRUE</span>) <span class="op">&lt;=</span><span class="st"> </span><span class="fl">0.1</span></a>
<a class="sourceLine" id="cb546-2" data-line-number="2"><span class="kw">summary</span>(alt.non.ambient)</a></code></pre></div>
<pre><code>##    Mode   FALSE    TRUE    NA&#39;s 
## logical    1388   15393   12672</code></pre>
<div class="sourceCode" id="cb548"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb548-1" data-line-number="1">okay.genes &lt;-<span class="st"> </span><span class="kw">names</span>(alt.non.ambient)[<span class="kw">which</span>(alt.non.ambient)]</a>
<a class="sourceLine" id="cb548-2" data-line-number="2">tab.neural4 &lt;-<span class="st"> </span>tab.neural[<span class="kw">rownames</span>(tab.neural) <span class="op">%in%</span><span class="st"> </span>okay.genes,]</a>
<a class="sourceLine" id="cb548-3" data-line-number="3"><span class="kw">head</span>(tab.neural4)</a></code></pre></div>
<pre><code>## DataFrame with 6 rows and 5 columns
##                   logFC    logCPM         F       PValue          FDR
##               &lt;numeric&gt; &lt;numeric&gt; &lt;numeric&gt;    &lt;numeric&gt;    &lt;numeric&gt;
## Xist          -7.555686   8.21232  6657.298  0.00000e+00  0.00000e+00
## Erdr1          1.889536   7.61593  1407.112 2.34678e-289 3.57046e-286
## Uba52         -0.879668   8.38618   424.191  1.86584e-92  2.20792e-89
## Grb10         -1.403427   6.58314   401.353  1.13898e-87  1.21302e-84
## Gt(ROSA)26Sor  1.481294   5.71617   351.940  2.80072e-77  2.71161e-74
## Fdps           0.981388   7.21805   337.159  3.67655e-74  3.26294e-71</code></pre>
<p>Any highly expressed cell type-specific gene is a candidate for this procedure,
most typically in cell types that are highly specialized towards manufacturing a protein product.
Aside from hemoglobin, we could use immunoglobulins in populations containing B cells,
or insulin and glucagon in pancreas datasets (Figure <a href="marker-detection.html#fig:viol-gcg-lawlor">11.6</a>).
The experimental setting may also provide some genes that must only be present in the ambient solution;
for example, the mitochondrial transcripts can be used to estimate ambient contamination in single-nucleus RNA-seq,
while <em>Xist</em> can be used for datasets involving mixtures of male and female cells
(where the contaminating percentages are estimated from the profiles of male cells only).</p>
<p>If appropriate control features are available, this approach allows us to obtain a more accurate estimate of the contamination in each pseudo-bulk sample compared to the upper bound provided by <code>maximumAmbience()</code>.
This avoids the removal of genuine DEGs due to overestimation fo the ambient contamination from the latter.
However, the performance of this approach is fully dependent on the suitability of the control features - if a “control” feature is actually genuinely expressed in a cell type, the ambient contribution will be overestimated.
A simple mitigating strategy is to simply take the lower of the proportions from <code>controlAmbience()</code> and <code>maximumAmbience()</code>, with the idea being that the latter will avoid egregious overestimation when the control set is misspecified.</p>
</div>
<div id="without-an-ambient-profile" class="section level4">
<h4><span class="header-section-number">14.4.2.3</span> Without an ambient profile</h4>
<p>An estimate of the ambient profile is rarely available for public datasets where only the per-cell count matrices are provided.
In such cases, we must instead use the rest of the dataset to infer something about the effects of ambient contamination.
The most obvious approach is construct a proxy ambient profile by summing the counts for all cells from each sample, which can be used in place of the actual profile in the previous calculations.
This assumes equal contributions from all labels to the ambient pool, which is not entirely unrealistic (Figure <a href="multi-sample-comparisons.html#fig:proxy-ambience">14.10</a>) though some discrepancies can be expected due to the presence of particularly fragile cell types or extracellular RNA.</p>
<div class="sourceCode" id="cb550"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb550-1" data-line-number="1">proxy.ambient &lt;-<span class="st"> </span><span class="kw">aggregateAcrossCells</span>(summed.tal1,</a>
<a class="sourceLine" id="cb550-2" data-line-number="2">    <span class="dt">ids=</span>summed.tal1<span class="op">$</span>sample)</a>
<a class="sourceLine" id="cb550-3" data-line-number="3"></a>
<a class="sourceLine" id="cb550-4" data-line-number="4"><span class="kw">par</span>(<span class="dt">mfrow=</span><span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">2</span>))</a>
<a class="sourceLine" id="cb550-5" data-line-number="5"><span class="cf">for</span> (i <span class="cf">in</span> <span class="kw">seq_len</span>(<span class="kw">ncol</span>(proxy.ambient))) {</a>
<a class="sourceLine" id="cb550-6" data-line-number="6">    true &lt;-<span class="st"> </span>ambient[,i]</a>
<a class="sourceLine" id="cb550-7" data-line-number="7">    proxy &lt;-<span class="st"> </span><span class="kw">assay</span>(proxy.ambient)[,i]</a>
<a class="sourceLine" id="cb550-8" data-line-number="8">    logged &lt;-<span class="st"> </span>edgeR<span class="op">::</span><span class="kw">cpm</span>(<span class="kw">cbind</span>(proxy, true), <span class="dt">log=</span><span class="ot">TRUE</span>, <span class="dt">prior.count=</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb550-9" data-line-number="9">    logFC &lt;-<span class="st"> </span>logged[,<span class="dv">1</span>] <span class="op">-</span><span class="st"> </span>logged[,<span class="dv">2</span>]</a>
<a class="sourceLine" id="cb550-10" data-line-number="10">    abundance &lt;-<span class="st"> </span><span class="kw">rowMeans</span>(logged)</a>
<a class="sourceLine" id="cb550-11" data-line-number="11">    <span class="kw">plot</span>(abundance, logFC, <span class="dt">main=</span><span class="kw">paste</span>(<span class="st">&quot;Sample&quot;</span>, i))</a>
<a class="sourceLine" id="cb550-12" data-line-number="12">}</a></code></pre></div>
<div class="figure"><span id="fig:proxy-ambience"></span>
<img src="sample-comparisons_files/figure-html/proxy-ambience-1.png" alt="MA plots of the log-fold change of the proxy ambient profile over the real profile for each sample in the _Tal1_ chimera dataset." width="672" />
<p class="caption">
Figure 14.10: MA plots of the log-fold change of the proxy ambient profile over the real profile for each sample in the <em>Tal1</em> chimera dataset.
</p>
</div>
<p>We can also mitigate the effect of ambient contamination by focusing on label-specific DEGs.
Contamination-driven DEGs should be systematically present in comparisons for all labels, and thus can be eliminated by simply ignoring all genes that are significant in a majority of these comparisons (Section <a href="multi-sample-comparisons.html#cross-label-meta-analyses">14.3.3.2</a>).
The obvious drawback of this approach is that it discounts genuine DEGs that have a consistent effect in most/all labels, though one could perhaps argue that such “global” DEGs are not the main features of interest in label-specific analyses.
It is also complicated by fluctuations in detection power across comparisons involving different numbers of cells - or replicates, after filtering pseudo-bulk profiles by the number of cells.</p>
<div class="sourceCode" id="cb551"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb551-1" data-line-number="1">res.tal1 &lt;-<span class="st"> </span><span class="kw">pseudoBulkDGE</span>(summed.tal1, </a>
<a class="sourceLine" id="cb551-2" data-line-number="2">    <span class="dt">label=</span>summed.tal1<span class="op">$</span>label,</a>
<a class="sourceLine" id="cb551-3" data-line-number="3">    <span class="dt">design=</span><span class="op">~</span><span class="kw">factor</span>(block) <span class="op">+</span><span class="st"> </span>tomato,</a>
<a class="sourceLine" id="cb551-4" data-line-number="4">    <span class="dt">coef=</span><span class="st">&quot;tomatoTRUE&quot;</span>,</a>
<a class="sourceLine" id="cb551-5" data-line-number="5">    <span class="dt">condition=</span>summed.tal1<span class="op">$</span>tomato)</a>
<a class="sourceLine" id="cb551-6" data-line-number="6"></a>
<a class="sourceLine" id="cb551-7" data-line-number="7"><span class="co"># DE in the same direction across most labels.</span></a>
<a class="sourceLine" id="cb551-8" data-line-number="8">tal1.de &lt;-<span class="st"> </span><span class="kw">decideTestsPerLabel</span>(res.tal1)</a>
<a class="sourceLine" id="cb551-9" data-line-number="9">up.de &lt;-<span class="st"> </span><span class="kw">rowMeans</span>(tal1.de <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span> <span class="op">&amp;</span><span class="st"> </span><span class="op">!</span><span class="kw">is.na</span>(tal1.de))</a>
<a class="sourceLine" id="cb551-10" data-line-number="10">down.de &lt;-<span class="st"> </span><span class="kw">rowMeans</span>(tal1.de <span class="op">&lt;</span><span class="st"> </span><span class="dv">0</span> <span class="op">&amp;</span><span class="st"> </span><span class="op">!</span><span class="kw">is.na</span>(tal1.de))</a>
<a class="sourceLine" id="cb551-11" data-line-number="11"></a>
<a class="sourceLine" id="cb551-12" data-line-number="12"><span class="co"># Inspecting our neural crest results again.</span></a>
<a class="sourceLine" id="cb551-13" data-line-number="13">tab.neural.again &lt;-<span class="st"> </span>res.tal1[[<span class="st">&quot;Neural crest&quot;</span>]]</a>
<a class="sourceLine" id="cb551-14" data-line-number="14">tab.neural.again<span class="op">$</span>OtherUp &lt;-<span class="st"> </span>up.de</a>
<a class="sourceLine" id="cb551-15" data-line-number="15">tab.neural.again<span class="op">$</span>OtherDown &lt;-<span class="st"> </span>down.de</a>
<a class="sourceLine" id="cb551-16" data-line-number="16"><span class="kw">head</span>(tab.neural.again[<span class="kw">order</span>(tab.neural.again<span class="op">$</span>PValue),], <span class="dv">10</span>)</a></code></pre></div>
<pre><code>## DataFrame with 10 rows and 7 columns
##             logFC    logCPM         F       PValue          FDR   OtherUp
##         &lt;numeric&gt; &lt;numeric&gt; &lt;numeric&gt;    &lt;numeric&gt;    &lt;numeric&gt; &lt;numeric&gt;
## Xist    -7.555686   8.21232  6657.298  0.00000e+00  0.00000e+00  0.000000
## Hbb-bh1 -8.091042   9.15972 10758.256  0.00000e+00  0.00000e+00  0.000000
## Hbb-y   -8.415622   8.35705  7364.290  0.00000e+00  0.00000e+00  0.000000
## Hba-x   -7.724803   8.53284  7896.457  0.00000e+00  0.00000e+00  0.000000
## Hba-a1  -8.596706   6.74429  2756.573  0.00000e+00  0.00000e+00  0.000000
## Hba-a2  -8.866232   5.81300  1517.726 1.72378e-310 3.05972e-307  0.000000
## Erdr1    1.889536   7.61593  1407.112 2.34678e-289 3.57046e-286  0.444444
## Cdkn1c  -8.864528   4.96097   814.936 8.79980e-173 1.17147e-169  0.000000
## Uba52   -0.879668   8.38618   424.191  1.86584e-92  2.20792e-89  0.000000
## Grb10   -1.403427   6.58314   401.353  1.13898e-87  1.21302e-84  0.000000
##         OtherDown
##         &lt;numeric&gt;
## Xist     0.851852
## Hbb-bh1  0.925926
## Hbb-y    0.851852
## Hba-x    0.814815
## Hba-a1   0.777778
## Hba-a2   0.777778
## Erdr1    0.000000
## Cdkn1c   0.814815
## Uba52    0.814815
## Grb10    0.777778</code></pre>
<div class="sourceCode" id="cb553"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb553-1" data-line-number="1"><span class="co"># Actually removing those with a DE majority across labels.</span></a>
<a class="sourceLine" id="cb553-2" data-line-number="2">ignore &lt;-<span class="st"> </span>up.de <span class="op">&gt;</span><span class="st"> </span><span class="fl">0.5</span> <span class="op">|</span><span class="st"> </span>down.de <span class="op">&gt;</span><span class="st"> </span><span class="fl">0.5</span></a>
<a class="sourceLine" id="cb553-3" data-line-number="3">tab.neural.again &lt;-<span class="st"> </span>tab.neural.again[<span class="op">!</span>ignore,]</a>
<a class="sourceLine" id="cb553-4" data-line-number="4"><span class="kw">head</span>(tab.neural.again[<span class="kw">order</span>(tab.neural.again<span class="op">$</span>PValue),], <span class="dv">10</span>)</a></code></pre></div>
<pre><code>## DataFrame with 10 rows and 7 columns
##            logFC    logCPM         F       PValue          FDR   OtherUp
##        &lt;numeric&gt; &lt;numeric&gt; &lt;numeric&gt;    &lt;numeric&gt;    &lt;numeric&gt; &lt;numeric&gt;
## Erdr1   1.889536   7.61593 1407.1122 2.34678e-289 3.57046e-286  0.444444
## Fdps    0.981388   7.21805  337.1586  3.67655e-74  3.26294e-71  0.222222
## Msmo1   1.493771   5.43923  301.0658  1.57983e-66  1.05158e-63  0.222222
## Hmgcs1  1.250024   5.70837  252.1105  3.95670e-56  2.21783e-53  0.222222
## Idi1    1.173709   5.37688  180.8890  6.68049e-41  2.73643e-38  0.148148
## Ddit4   0.844702   5.59699  109.5505  1.63456e-25  3.95637e-23  0.444444
## Scd2    0.798049   5.70852  103.7377  2.98274e-24  7.05915e-22  0.259259
## Sox9    0.537460   7.17373   99.3336  2.69822e-23  5.74720e-21  0.148148
## Nkd1    0.719043   5.92690   93.9636  3.96635e-22  8.28267e-20  0.185185
## Fdft1   0.841061   5.32293   89.8826  3.06448e-21  5.93394e-19  0.185185
##        OtherDown
##        &lt;numeric&gt;
## Erdr1  0.0000000
## Fdps   0.1851852
## Msmo1  0.1851852
## Hmgcs1 0.1111111
## Idi1   0.1111111
## Ddit4  0.0000000
## Scd2   0.0740741
## Sox9   0.0740741
## Nkd1   0.0740741
## Fdft1  0.1111111</code></pre>
<p>The common theme here is that, in the absence of an ambient profile, we are using all labels as a proxy for the ambient effect.
This can have unpredictable consequences as the results for each label are now dependent on the behavior of the entire dataset.
For example, the metrics are susceptible to the idiosyncrasies of clustering where one cell type may be represented in multple related clusters that distort the percentages in <code>up.de</code> and <code>down.de</code> or the average log-fold change.
The metrics may also be invalidated in analyses of a subset of the data - for example, a subclustering analysis focusing on a particular cell type may mark all relevant DEGs as problematic because they are consistently DE in all subtypes.</p>
</div>
</div>
<div id="subtracting-ambient-counts" class="section level3">
<h3><span class="header-section-number">14.4.3</span> Subtracting ambient counts</h3>
<p>It is worth commenting on the seductive idea of subtracting the ambient counts from the pseudo-bulk samples.
This may seem like the most obvious approach for removing ambient contamination, but unfortunately, subtracted counts have unpredictable statistical properties due the distortion of the mean-variance relationship.
Minor relative fluctuations at very large counts become large fold-changes after subtraction, manifesting as spurious DE in genes where a substantial proportion of counts is derived from the ambient solution.
For example, several hemoglobin genes retain strong DE even after subtraction of the scaled ambient profile.</p>
<div class="sourceCode" id="cb555"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb555-1" data-line-number="1">scaled.ambient &lt;-<span class="st"> </span><span class="kw">controlAmbience</span>(<span class="kw">counts</span>(summed.neural), ambient,</a>
<a class="sourceLine" id="cb555-2" data-line-number="2">    <span class="dt">features=</span>is.hbb,  <span class="dt">mode=</span><span class="st">&quot;profile&quot;</span>)</a>
<a class="sourceLine" id="cb555-3" data-line-number="3">subtracted &lt;-<span class="st"> </span><span class="kw">counts</span>(summed.neural) <span class="op">-</span><span class="st"> </span>scaled.ambient</a>
<a class="sourceLine" id="cb555-4" data-line-number="4">subtracted &lt;-<span class="st"> </span><span class="kw">round</span>(subtracted)</a>
<a class="sourceLine" id="cb555-5" data-line-number="5">subtracted[subtracted <span class="op">&lt;</span><span class="st"> </span><span class="dv">0</span>] &lt;-<span class="st"> </span><span class="dv">0</span></a>
<a class="sourceLine" id="cb555-6" data-line-number="6">subtracted[is.hbb,]</a></code></pre></div>
<pre><code>##         [,1] [,2] [,3] [,4]
## Hbb-bt     0    0    7   18
## Hbb-bs     1    2   31   42
## Hbb-bh2    0    0    0    0
## Hbb-bh1    2    0    0    0
## Hbb-y      0    0   39  107
## Hba-x      1    1    0    0
## Hba-a1     0    0  365  452
## Hba-a2     0    0  314  329</code></pre>
<p>Another tempting approach is to use interaction models to implicitly subtract the ambient effect during GLM fitting.
The assumption is that, for a genuine DEG, the log-fold change within cells is larger in magnitude than that in the ambient solution.
This is based on the expectation that any DE in the latter is “diluted” by contributions from cell types where that gene is not DE.
Unfortunately, this is not always the case; a DE analysis of the ambient counts indicates that the hemoglobin log-fold change is actually stronger in the neural crest cells compared to the ambient solution, which leads to the rather awkward conclusion that the WT neural crest cells are expressing hemoglobin beyond that explained by ambient contamination.</p>
<div class="sourceCode" id="cb557"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb557-1" data-line-number="1">y.ambient &lt;-<span class="st"> </span><span class="kw">DGEList</span>(ambient, <span class="dt">samples=</span><span class="kw">colData</span>(summed.neural))</a>
<a class="sourceLine" id="cb557-2" data-line-number="2">y.ambient &lt;-<span class="st"> </span>y.ambient[<span class="kw">filterByExpr</span>(y.ambient, <span class="dt">group=</span>y.ambient<span class="op">$</span>samples<span class="op">$</span>tomato),]</a>
<a class="sourceLine" id="cb557-3" data-line-number="3">y.ambient &lt;-<span class="st"> </span><span class="kw">calcNormFactors</span>(y.ambient)</a>
<a class="sourceLine" id="cb557-4" data-line-number="4"></a>
<a class="sourceLine" id="cb557-5" data-line-number="5">design &lt;-<span class="st"> </span><span class="kw">model.matrix</span>(<span class="op">~</span><span class="kw">factor</span>(block) <span class="op">+</span><span class="st"> </span>tomato, y.ambient<span class="op">$</span>samples)</a>
<a class="sourceLine" id="cb557-6" data-line-number="6">y.ambient &lt;-<span class="st"> </span><span class="kw">estimateDisp</span>(y.ambient, design)</a>
<a class="sourceLine" id="cb557-7" data-line-number="7">fit.ambient &lt;-<span class="st"> </span><span class="kw">glmQLFit</span>(y.ambient, design, <span class="dt">robust=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb557-8" data-line-number="8">res.ambient &lt;-<span class="st"> </span><span class="kw">glmQLFTest</span>(fit.ambient, <span class="dt">coef=</span><span class="kw">ncol</span>(design))</a>
<a class="sourceLine" id="cb557-9" data-line-number="9"></a>
<a class="sourceLine" id="cb557-10" data-line-number="10"><span class="kw">summary</span>(<span class="kw">decideTests</span>(res.ambient))</a></code></pre></div>
<pre><code>##        tomatoTRUE
## Down         1910
## NotSig       7683
## Up           1645</code></pre>
<div class="sourceCode" id="cb559"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb559-1" data-line-number="1"><span class="kw">topTags</span>(res.ambient, <span class="dt">n=</span><span class="dv">10</span>)</a></code></pre></div>
<pre><code>## Coefficient:  tomatoTRUE 
##          logFC logCPM     F    PValue       FDR
## Hbb-y   -5.267 12.803 15115 3.523e-81 3.959e-77
## Hbb-bh1 -5.075 13.725 14002 8.892e-80 4.996e-76
## Hba-x   -4.827 13.122 13317 3.135e-79 1.175e-75
## Hba-a1  -4.662 10.734 11095 1.146e-76 3.220e-73
## Hba-a2  -4.521  9.480  8411 1.246e-72 2.800e-69
## Blvrb   -4.319  7.649  4129 3.066e-62 5.742e-59
## Xist    -4.376  7.484  3891 1.864e-61 2.993e-58
## Gypa    -5.138  7.213  3808 3.833e-61 5.384e-58
## Hbb-bs  -4.941  7.209  3604 3.728e-60 4.655e-57
## Car2    -3.499  8.534  4448 5.589e-60 6.281e-57</code></pre>
<p>(One possible explanation is that erythrocyte fragments are present in the cell-containing libraries but are not used to estimate the ambient profile, presumably because the UMI counts are too high for fragment-containing libraries to be treated as empty.
Technically speaking, this is not incorrect as, after all, those libraries are not actually empty (Section <a href="droplet-processing.html#qc-droplets">15.2</a>).
In effect, every cell in the WT sample is a fractional multiplet with partial erythrocyte identity from the included fragments, which results in stronger log-fold changes between genotypes for hemoglobin compared to those for the ambient solution.)</p>
<p>That aside, there are other issues with implicit subtraction in the fitted GLM that warrant caution with its use.
This strategy precludes detection of DEGs that are common to all cell types as there is no longer a dilution effect being applied to the log-fold change in the ambient solution.
It requires inclusion of the ambient profiles in the model, which is cause for at least some concern as they are unlikely to have the same degree of variability as the cell-derived pseudo-bulk profiles.
Interpretation is also complicated by the fact that we are only interested in log-fold changes that are more extreme in the cells compared to the ambient solution; a non-zero interaction term is not sufficient for removing spurious DE.</p>
<!--
Full interaction code, in case anyone's unconvinced.


```r
s <- factor(rep(1:4, 2))
new.geno <- rep(rep(c("KO", "WT"), each=2), 2)
is.ambient <- rep(c("N", "Y"), each=4)
design.amb <- model.matrix(~0 + s + new.geno:is.ambient)

# Get to full rank:
design.amb <- design.amb[,!grepl("is.ambientY", colnames(design.amb))] 

# Syntactically valid colnames:
colnames(design.amb) <- make.names(colnames(design.amb)) 
design.amb
```


```r
y.amb <- DGEList(cbind(counts(summed.neural), ambient)
y.amb <- y.amb[filterByExpr(y.amb, group=s),]
y.amb <- calcNormFactors(y.amb)
y.amb <- estimateDisp(y.amb, design.amb)
fit.amb <- glmQLFit(y.amb, design.amb, robust=TRUE)    

res.ko <- glmTreat(fit.amb, coef="new.genoKO.is.ambientN")
summary(decideTests(res.ko))
topTags(res.ko, n=10)

res.wt <- glmTreat(fit.amb, coef="new.genoWT.is.ambientN")
summary(decideTests(res.wt))
topTags(res.wt, n=10)

con <- makeContrasts(new.genoKO.is.ambientN - new.genoWT.is.ambientN, levels=design.amb)
res.amb <- glmTreat(fit.amb, contrast=con)
summary(decideTests(res.amb))
topTags(res.amb, n=10)
```


```r
tab.exp <- res.exp$table
tab.amb <- res.amb$table
okay <- sign(tab.exp$logFC)==sign(tab.amb$logFC)
summary(okay)
iut.p <- pmax(tab.exp$PValue, tab.amb$PValue)
iut.p[!okay] <- 1
final <- data.frame(row.names=rownames(tab.exp),
    logFC=tab.exp$logFC, interaction=tab.amb$logFC,
    PValue=iut.p, FDR=p.adjust(iut.p, method="BH"))
final <- final[order(final$PValue),]
sum(final$FDR <= 0.05)
head(final, 10)
```
-->
</div>
</div>
<div id="differential-abundance" class="section level2">
<h2><span class="header-section-number">14.5</span> Differential abundance between conditions</h2>
<div id="overview" class="section level3">
<h3><span class="header-section-number">14.5.1</span> Overview</h3>
<p>In a DA analysis, we test for significant changes in per-label cell abundance across conditions.
This will reveal which cell types are depleted or enriched upon treatment, which is arguably just as interesting as changes in expression within each cell type.
The DA analysis has a long history in flow cytometry <span class="citation">(Finak et al. <a href="#ref-finak2014opencyto">2014</a>; A. T. L. Lun, Richard, and Marioni <a href="#ref-lun2017testing">2017</a>)</span> where it is routinely used to examine the effects of different conditions on the composition of complex cell populations.
By performing it here, we effectively treat scRNA-seq as a “super-FACS” technology for defining relevant subpopulations using the entire transcriptome.</p>
<p>We prepare for the DA analysis by quantifying the number of cells assigned to each label (or cluster) in our WT chimeric experiment.
In this case, we are aiming to identify labels that change in abundance among the compartment of injected cells compared to the background.</p>
<div class="sourceCode" id="cb561"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb561-1" data-line-number="1">abundances &lt;-<span class="st"> </span><span class="kw">table</span>(merged<span class="op">$</span>celltype.mapped, merged<span class="op">$</span>sample) </a>
<a class="sourceLine" id="cb561-2" data-line-number="2">abundances &lt;-<span class="st"> </span><span class="kw">unclass</span>(abundances) </a>
<a class="sourceLine" id="cb561-3" data-line-number="3"><span class="kw">head</span>(abundances)</a></code></pre></div>
<pre><code>##                      
##                        5  6   7   8   9  10
##   Allantois           97 15 139 127 318 259
##   Blood progenitors 1  6  3  16   6   8  17
##   Blood progenitors 2 31  8  28  21  43 114
##   Cardiomyocytes      85 21  79  31 174 211
##   Caudal Mesoderm     10 10   9   3  10  29
##   Caudal epiblast      2  2   0   0  22  45</code></pre>
</div>
<div id="performing-the-da-analysis" class="section level3">
<h3><span class="header-section-number">14.5.2</span> Performing the DA analysis</h3>
<p>Our DA analysis will again be performed with the <em><a href="https://bioconductor.org/packages/3.12/edgeR">edgeR</a></em> package.
This allows us to take advantage of the NB GLM methods to model overdispersed count data in the presence of limited replication -
except that the counts are not of reads per gene, but of cells per label <span class="citation">(A. T. L. Lun, Richard, and Marioni <a href="#ref-lun2017testing">2017</a>)</span>.
The aim is to share information across labels to improve our estimates of the biological variability in cell abundance between replicates.</p>
<div class="sourceCode" id="cb563"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb563-1" data-line-number="1"><span class="co"># Attaching some column metadata.</span></a>
<a class="sourceLine" id="cb563-2" data-line-number="2">extra.info &lt;-<span class="st"> </span><span class="kw">colData</span>(merged)[<span class="kw">match</span>(<span class="kw">colnames</span>(abundances), merged<span class="op">$</span>sample),]</a>
<a class="sourceLine" id="cb563-3" data-line-number="3">y.ab &lt;-<span class="st"> </span><span class="kw">DGEList</span>(abundances, <span class="dt">samples=</span>extra.info)</a>
<a class="sourceLine" id="cb563-4" data-line-number="4">y.ab</a></code></pre></div>
<pre><code>## An object of class &quot;DGEList&quot;
## $counts
##                      
##                        5  6   7   8   9  10
##   Allantois           97 15 139 127 318 259
##   Blood progenitors 1  6  3  16   6   8  17
##   Blood progenitors 2 31  8  28  21  43 114
##   Cardiomyocytes      85 21  79  31 174 211
##   Caudal Mesoderm     10 10   9   3  10  29
## 29 more rows ...
## 
## $samples
##    group lib.size norm.factors batch       cell          barcode sample stage
## 5      1     2298            1     5  cell_9769 AAACCTGAGACTGTAA      5  E8.5
## 6      1     1026            1     6 cell_12180 AAACCTGCAGATGGCA      6  E8.5
## 7      1     2740            1     7 cell_13227 AAACCTGAGACAAGCC      7  E8.5
## 8      1     2904            1     8 cell_16234 AAACCTGCAAACCCAT      8  E8.5
## 9      1     4057            1     9 cell_19332 AAACCTGCAACGATCT      9  E8.5
## 10     1     6401            1    10 cell_23875 AAACCTGAGGCATGTG     10  E8.5
##    tomato pool stage.mapped              celltype.mapped closest.cell
## 5    TRUE    3        E8.25                   Mesenchyme   cell_24159
## 6   FALSE    3        E8.25             Somitic mesoderm   cell_63247
## 7    TRUE    4         E8.5             Somitic mesoderm   cell_25454
## 8   FALSE    4        E8.25                 ExE mesoderm  cell_139075
## 9    TRUE    5         E8.0                 ExE mesoderm  cell_116116
## 10  FALSE    5         E8.5 Forebrain/Midbrain/Hindbrain   cell_39343
##    doub.density sizeFactor label
## 5      0.029850     1.6349    19
## 6      0.291916     2.5981     6
## 7      0.601740     1.5939    17
## 8      0.004733     0.8707     9
## 9      0.079415     0.8933    15
## 10     0.040747     0.3947     1</code></pre>
<p>We filter out low-abundance labels as previously described.
This avoids cluttering the result table with very rare subpopulations that contain only a handful of cells.
For a DA analysis of cluster abundances, filtering is generally not required as most clusters will not be of low-abundance (otherwise there would not have been enough evidence to define the cluster in the first place).</p>
<div class="sourceCode" id="cb565"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb565-1" data-line-number="1">keep &lt;-<span class="st"> </span><span class="kw">filterByExpr</span>(y.ab, <span class="dt">group=</span>y.ab<span class="op">$</span>samples<span class="op">$</span>tomato)</a>
<a class="sourceLine" id="cb565-2" data-line-number="2">y.ab &lt;-<span class="st"> </span>y.ab[keep,]</a>
<a class="sourceLine" id="cb565-3" data-line-number="3"><span class="kw">summary</span>(keep)</a></code></pre></div>
<pre><code>##    Mode   FALSE    TRUE 
## logical      10      24</code></pre>
<p>Unlike DE analyses, we do not perform an additional normalization step with <code>calcNormFactors()</code>.
This means that we are only normalizing based on the “library size”, i.e., the total number of cells in each sample.
Any changes we detect between conditions will subsequently represent differences in the proportion of cells in each cluster.
The motivation behind this decision is discussed in more detail in Section <a href="multi-sample-comparisons.html#composition-effects">14.5.3</a>.</p>
<p>We formulate the design matrix with a blocking factor for the batch of origin for each sample and an additive term for the td-Tomato status (i.e., injection effect).
Here, the log-fold change in our model refers to the change in cell abundance after injection, rather than the change in gene expression.</p>
<div class="sourceCode" id="cb567"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb567-1" data-line-number="1">design &lt;-<span class="st"> </span><span class="kw">model.matrix</span>(<span class="op">~</span><span class="kw">factor</span>(pool) <span class="op">+</span><span class="st"> </span><span class="kw">factor</span>(tomato), y.ab<span class="op">$</span>samples)</a></code></pre></div>
<p>We use the <code>estimateDisp()</code> function to estimate the NB dipersion for each cluster (Figure <a href="multi-sample-comparisons.html#fig:abplotbcv">14.11</a>).
We turn off the trend as we do not have enough points for its stable estimation.</p>
<div class="sourceCode" id="cb568"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb568-1" data-line-number="1">y.ab &lt;-<span class="st"> </span><span class="kw">estimateDisp</span>(y.ab, design, <span class="dt">trend=</span><span class="st">&quot;none&quot;</span>)</a>
<a class="sourceLine" id="cb568-2" data-line-number="2"><span class="kw">summary</span>(y.ab<span class="op">$</span>common.dispersion)</a></code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##  0.0614  0.0614  0.0614  0.0614  0.0614  0.0614</code></pre>
<div class="sourceCode" id="cb570"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb570-1" data-line-number="1"><span class="kw">plotBCV</span>(y.ab, <span class="dt">cex=</span><span class="dv">1</span>)</a></code></pre></div>
<div class="figure"><span id="fig:abplotbcv"></span>
<img src="sample-comparisons_files/figure-html/abplotbcv-1.png" alt="Biological coefficient of variation (BCV) for each label with respect to its average abundance. BCVs are defined as the square root of the NB dispersion. Common dispersion estimates are shown in red." width="672" />
<p class="caption">
Figure 14.11: Biological coefficient of variation (BCV) for each label with respect to its average abundance. BCVs are defined as the square root of the NB dispersion. Common dispersion estimates are shown in red.
</p>
</div>
<p>We repeat this process with the QL dispersion, again disabling the trend (Figure <a href="multi-sample-comparisons.html#fig:abplotql">14.12</a>).</p>
<div class="sourceCode" id="cb571"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb571-1" data-line-number="1">fit.ab &lt;-<span class="st"> </span><span class="kw">glmQLFit</span>(y.ab, design, <span class="dt">robust=</span><span class="ot">TRUE</span>, <span class="dt">abundance.trend=</span><span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb571-2" data-line-number="2"><span class="kw">summary</span>(fit.ab<span class="op">$</span>var.prior)</a></code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##    1.25    1.25    1.25    1.25    1.25    1.25</code></pre>
<div class="sourceCode" id="cb573"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb573-1" data-line-number="1"><span class="kw">summary</span>(fit.ab<span class="op">$</span>df.prior)</a></code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##     Inf     Inf     Inf     Inf     Inf     Inf</code></pre>
<div class="sourceCode" id="cb575"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb575-1" data-line-number="1"><span class="kw">plotQLDisp</span>(fit.ab, <span class="dt">cex=</span><span class="dv">1</span>)</a></code></pre></div>
<div class="figure"><span id="fig:abplotql"></span>
<img src="sample-comparisons_files/figure-html/abplotql-1.png" alt="QL dispersion estimates for each label with respect to its average abundance. Quarter-root values of the raw estimates are shown in black while the shrunken estimates are shown in red. Shrinkage is performed towards the common dispersion in blue." width="672" />
<p class="caption">
Figure 14.12: QL dispersion estimates for each label with respect to its average abundance. Quarter-root values of the raw estimates are shown in black while the shrunken estimates are shown in red. Shrinkage is performed towards the common dispersion in blue.
</p>
</div>
<p>We test for differences in abundance between td-Tomato-positive and negative samples using <code>glmQLFTest()</code>.
We see that extra-embryonic ectoderm is strongly depleted in the injected cells.
This is consistent with the expectation that cells injected into the blastocyst should not contribute to extra-embryonic tissue.
The injected cells also contribute more to the mesenchyme, which may also be of interest.</p>
<div class="sourceCode" id="cb576"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb576-1" data-line-number="1">res &lt;-<span class="st"> </span><span class="kw">glmQLFTest</span>(fit.ab, <span class="dt">coef=</span><span class="kw">ncol</span>(design))</a>
<a class="sourceLine" id="cb576-2" data-line-number="2"><span class="kw">summary</span>(<span class="kw">decideTests</span>(res))</a></code></pre></div>
<pre><code>##        factor(tomato)TRUE
## Down                    1
## NotSig                 22
## Up                      1</code></pre>
<div class="sourceCode" id="cb578"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb578-1" data-line-number="1"><span class="kw">topTags</span>(res)</a></code></pre></div>
<pre><code>## Coefficient:  factor(tomato)TRUE 
##                                  logFC logCPM      F    PValue       FDR
## ExE ectoderm                   -6.5663  13.02 66.267 1.352e-10 3.245e-09
## Mesenchyme                      1.1652  16.29 11.291 1.535e-03 1.841e-02
## Allantois                       0.8345  15.51  5.312 2.555e-02 1.621e-01
## Cardiomyocytes                  0.8484  14.86  5.204 2.701e-02 1.621e-01
## Neural crest                   -0.7706  14.76  4.106 4.830e-02 2.149e-01
## Endothelium                     0.7519  14.29  3.912 5.371e-02 2.149e-01
## Erythroid3                     -0.6431  17.28  3.604 6.367e-02 2.183e-01
## Haematoendothelial progenitors  0.6581  14.72  3.124 8.351e-02 2.505e-01
## ExE mesoderm                    0.3805  15.68  1.181 2.827e-01 6.258e-01
## Pharyngeal mesoderm             0.3793  15.72  1.169 2.850e-01 6.258e-01</code></pre>
</div>
<div id="composition-effects" class="section level3">
<h3><span class="header-section-number">14.5.3</span> Handling composition effects</h3>
<div id="background" class="section level4">
<h4><span class="header-section-number">14.5.3.1</span> Background</h4>
<p>As mentioned above, we do not use <code>calcNormFactors()</code> in our default DA analysis.
This normalization step assumes that most of the input features are not different between conditions.
While this assumption is reasonable for most types of gene expression data, it is generally too strong for cell type abundance - most experiments consist of only a few cell types that may all change in abundance upon perturbation.
Thus, our default approach is to only normalize based on the total number of cells in each sample, which means that we are effectively testing for differential proportions between conditions.</p>
<p>Unfortunately, the use of the total number of cells leaves us susceptible to composition effects.
For example, a large increase in abundance for one cell subpopulation will introduce decreases in proportion for all other subpopulations - which is technically correct, but may be misleading if one concludes that those other subpopulations are decreasing in abundance of their own volition.
If composition biases are proving problematic for interpretation of DA results, we have several avenues for removing them or mitigating their impact by leveraging <em>a priori</em> biological knowledge.</p>
</div>
<div id="assuming-most-labels-do-not-change" class="section level4">
<h4><span class="header-section-number">14.5.3.2</span> Assuming most labels do not change</h4>
<p>If it is possible to assume that most labels (i.e., cell types) do not change in abundance, we can use <code>calcNormFactors()</code> to compute normalization factors.
This seems to be a fairly reasonable assumption for the WT chimeras where the injection is expected to have only a modest effect at most.</p>
<div class="sourceCode" id="cb580"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb580-1" data-line-number="1">y.ab2 &lt;-<span class="st"> </span><span class="kw">calcNormFactors</span>(y.ab)</a>
<a class="sourceLine" id="cb580-2" data-line-number="2">y.ab2<span class="op">$</span>samples<span class="op">$</span>norm.factors</a></code></pre></div>
<pre><code>## [1] 1.0055 1.0833 1.1658 0.7614 1.0616 0.9743</code></pre>
<p>We then proceed with the remainder of the <em><a href="https://bioconductor.org/packages/3.12/edgeR">edgeR</a></em> analysis, shown below in condensed format.
Many of the positive log-fold changes are shifted towards zero, consistent with the removal of composition biases from the presence of extra-embryonic ectoderm in only background cells.
In particular, the mesenchyme is no longer significantly DA after injection.</p>
<div class="sourceCode" id="cb582"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb582-1" data-line-number="1">y.ab2 &lt;-<span class="st"> </span><span class="kw">estimateDisp</span>(y.ab2, design, <span class="dt">trend=</span><span class="st">&quot;none&quot;</span>)</a>
<a class="sourceLine" id="cb582-2" data-line-number="2">fit.ab2 &lt;-<span class="st"> </span><span class="kw">glmQLFit</span>(y.ab2, design, <span class="dt">robust=</span><span class="ot">TRUE</span>, <span class="dt">abundance.trend=</span><span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb582-3" data-line-number="3">res2 &lt;-<span class="st"> </span><span class="kw">glmQLFTest</span>(fit.ab2, <span class="dt">coef=</span><span class="kw">ncol</span>(design))</a>
<a class="sourceLine" id="cb582-4" data-line-number="4"><span class="kw">topTags</span>(res2, <span class="dt">n=</span><span class="dv">10</span>)</a></code></pre></div>
<pre><code>## Coefficient:  factor(tomato)TRUE 
##                                  logFC logCPM      F    PValue       FDR
## ExE ectoderm                   -6.9215  13.17 70.364 5.738e-11 1.377e-09
## Mesenchyme                      0.9513  16.27  6.787 1.219e-02 1.143e-01
## Neural crest                   -1.0032  14.78  6.464 1.429e-02 1.143e-01
## Erythroid3                     -0.8504  17.35  5.517 2.299e-02 1.380e-01
## Cardiomyocytes                  0.6400  14.84  2.735 1.047e-01 4.809e-01
## Allantois                       0.6054  15.51  2.503 1.202e-01 4.809e-01
## Forebrain/Midbrain/Hindbrain   -0.4943  16.55  1.928 1.713e-01 5.178e-01
## Endothelium                     0.5482  14.27  1.917 1.726e-01 5.178e-01
## Erythroid2                     -0.4818  16.00  1.677 2.015e-01 5.373e-01
## Haematoendothelial progenitors  0.4262  14.73  1.185 2.818e-01 6.240e-01</code></pre>
</div>
<div id="removing-the-offending-labels" class="section level4">
<h4><span class="header-section-number">14.5.3.3</span> Removing the offending labels</h4>
<p>Another approach is to repeat the analysis after removing DA clusters containing many cells.
This provides a clearer picture of the changes in abundance among the remaining clusters.
Here, we remove the extra-embryonic ectoderm and reset the total number of cells for all samples with <code>keep.lib.sizes=FALSE</code>.</p>
<div class="sourceCode" id="cb584"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb584-1" data-line-number="1">offenders &lt;-<span class="st"> &quot;ExE ectoderm&quot;</span></a>
<a class="sourceLine" id="cb584-2" data-line-number="2">y.ab3 &lt;-<span class="st"> </span>y.ab[<span class="kw">setdiff</span>(<span class="kw">rownames</span>(y.ab), offenders),, keep.lib.sizes=<span class="ot">FALSE</span>]</a>
<a class="sourceLine" id="cb584-3" data-line-number="3">y.ab3<span class="op">$</span>samples   </a></code></pre></div>
<pre><code>##    group lib.size norm.factors batch       cell          barcode sample stage
## 5      1     2268            1     5  cell_9769 AAACCTGAGACTGTAA      5  E8.5
## 6      1      993            1     6 cell_12180 AAACCTGCAGATGGCA      6  E8.5
## 7      1     2708            1     7 cell_13227 AAACCTGAGACAAGCC      7  E8.5
## 8      1     2749            1     8 cell_16234 AAACCTGCAAACCCAT      8  E8.5
## 9      1     4009            1     9 cell_19332 AAACCTGCAACGATCT      9  E8.5
## 10     1     6224            1    10 cell_23875 AAACCTGAGGCATGTG     10  E8.5
##    tomato pool stage.mapped              celltype.mapped closest.cell
## 5    TRUE    3        E8.25                   Mesenchyme   cell_24159
## 6   FALSE    3        E8.25             Somitic mesoderm   cell_63247
## 7    TRUE    4         E8.5             Somitic mesoderm   cell_25454
## 8   FALSE    4        E8.25                 ExE mesoderm  cell_139075
## 9    TRUE    5         E8.0                 ExE mesoderm  cell_116116
## 10  FALSE    5         E8.5 Forebrain/Midbrain/Hindbrain   cell_39343
##    doub.density sizeFactor label
## 5      0.029850     1.6349    19
## 6      0.291916     2.5981     6
## 7      0.601740     1.5939    17
## 8      0.004733     0.8707     9
## 9      0.079415     0.8933    15
## 10     0.040747     0.3947     1</code></pre>
<div class="sourceCode" id="cb586"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb586-1" data-line-number="1">y.ab3 &lt;-<span class="st"> </span><span class="kw">estimateDisp</span>(y.ab3, design, <span class="dt">trend=</span><span class="st">&quot;none&quot;</span>)</a>
<a class="sourceLine" id="cb586-2" data-line-number="2">fit.ab3 &lt;-<span class="st"> </span><span class="kw">glmQLFit</span>(y.ab3, design, <span class="dt">robust=</span><span class="ot">TRUE</span>, <span class="dt">abundance.trend=</span><span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb586-3" data-line-number="3">res3 &lt;-<span class="st"> </span><span class="kw">glmQLFTest</span>(fit.ab3, <span class="dt">coef=</span><span class="kw">ncol</span>(design))</a>
<a class="sourceLine" id="cb586-4" data-line-number="4"><span class="kw">topTags</span>(res3, <span class="dt">n=</span><span class="dv">10</span>)</a></code></pre></div>
<pre><code>## Coefficient:  factor(tomato)TRUE 
##                                  logFC logCPM      F   PValue     FDR
## Mesenchyme                      1.1274  16.32 11.501 0.001438 0.03308
## Allantois                       0.7950  15.54  5.231 0.026836 0.18284
## Cardiomyocytes                  0.8104  14.90  5.152 0.027956 0.18284
## Neural crest                   -0.8085  14.80  4.903 0.031798 0.18284
## Erythroid3                     -0.6808  17.32  4.387 0.041743 0.19202
## Endothelium                     0.7151  14.32  3.830 0.056443 0.21636
## Haematoendothelial progenitors  0.6189  14.76  2.993 0.090338 0.29683
## Def. endoderm                   0.4911  12.43  1.084 0.303347 0.67818
## ExE mesoderm                    0.3419  15.71  1.036 0.314058 0.67818
## Pharyngeal mesoderm             0.3407  15.76  1.025 0.316623 0.67818</code></pre>
<p>A similar strategy can be used to focus on proportional changes within a single subpopulation of a very heterogeneous data set.
For example, if we collected a whole blood data set, we could subset to T cells and test for changes in T cell subtypes (memory, killer, regulatory, etc.) using the total number of T cells in each sample as the library size.
This avoids detecting changes in T cell subsets that are driven by compositional effects from changes in abundance of, say, B cells in the same sample.</p>
</div>
<div id="testing-against-a-log-fold-change-threshold" class="section level4">
<h4><span class="header-section-number">14.5.3.4</span> Testing against a log-fold change threshold</h4>
<p>Here, we assume that composition bias introduces a spurious log<sub>2</sub>-fold change of no more than <span class="math inline">\(\tau\)</span> for a non-DA label.
This can be roughly interpreted as the maximum log-fold change in the total number of cells caused by DA in other labels.
(By comparison, fold-differences in the totals due to differences in capture efficiency or the size of the original cell population are not attributable to composition bias and should not be considered when choosing <span class="math inline">\(\tau\)</span>.)
We then mitigate the effect of composition biases by testing each label for changes in abundance beyond <span class="math inline">\(\tau\)</span> <span class="citation">(McCarthy and Smyth <a href="#ref-mccarthy2009treat">2009</a>; A. T. L. Lun, Richard, and Marioni <a href="#ref-lun2017testing">2017</a>)</span>.</p>
<div class="sourceCode" id="cb588"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb588-1" data-line-number="1">res.lfc &lt;-<span class="st"> </span><span class="kw">glmTreat</span>(fit.ab, <span class="dt">coef=</span><span class="kw">ncol</span>(design), <span class="dt">lfc=</span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb588-2" data-line-number="2"><span class="kw">summary</span>(<span class="kw">decideTests</span>(res.lfc))</a></code></pre></div>
<pre><code>##        factor(tomato)TRUE
## Down                    1
## NotSig                 23
## Up                      0</code></pre>
<div class="sourceCode" id="cb590"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb590-1" data-line-number="1"><span class="kw">topTags</span>(res.lfc)</a></code></pre></div>
<pre><code>## Coefficient:  factor(tomato)TRUE 
##                                  logFC unshrunk.logFC logCPM    PValue
## ExE ectoderm                   -6.5663        -7.0015  13.02 2.626e-09
## Mesenchyme                      1.1652         1.1658  16.29 1.323e-01
## Cardiomyocytes                  0.8484         0.8498  14.86 3.796e-01
## Allantois                       0.8345         0.8354  15.51 3.975e-01
## Neural crest                   -0.7706        -0.7719  14.76 4.501e-01
## Endothelium                     0.7519         0.7536  14.29 4.665e-01
## Haematoendothelial progenitors  0.6581         0.6591  14.72 5.622e-01
## Def. endoderm                   0.5262         0.5311  12.40 5.934e-01
## Erythroid3                     -0.6431        -0.6432  17.28 6.118e-01
## Caudal Mesoderm                -0.3996        -0.4036  12.09 6.827e-01
##                                      FDR
## ExE ectoderm                   6.303e-08
## Mesenchyme                     9.950e-01
## Cardiomyocytes                 9.950e-01
## Allantois                      9.950e-01
## Neural crest                   9.950e-01
## Endothelium                    9.950e-01
## Haematoendothelial progenitors 9.950e-01
## Def. endoderm                  9.950e-01
## Erythroid3                     9.950e-01
## Caudal Mesoderm                9.950e-01</code></pre>
<p>The choice of <span class="math inline">\(\tau\)</span> can be loosely motivated by external experimental data.
For example, if we observe a doubling of cell numbers in an <em>in vitro</em> system after treatment, we might be inclined to set <span class="math inline">\(\tau=1\)</span>.
This ensures that any non-DA subpopulation is not reported as being depleted after treatment.
Some caution is still required, though - even if the external numbers are accurate, we need to assume that cell capture efficiency is (on average) equal between conditions to justify their use as <span class="math inline">\(\tau\)</span>.
And obviously, the use of a non-zero <span class="math inline">\(\tau\)</span> will reduce power to detect real changes when the composition bias is not present.</p>
</div>
</div>
</div>
<div id="comments-on-interpretation" class="section level2">
<h2><span class="header-section-number">14.6</span> Comments on interpretation</h2>
<div id="de-da-duality" class="section level3">
<h3><span class="header-section-number">14.6.1</span> DE or DA? Two sides of the same coin</h3>
<p>While useful, the distinction between DA and DE analyses is inherently artificial for scRNA-seq data.
This is because the labels used in the former are defined based on the genes to be tested in the latter.
To illustrate, consider a scRNA-seq experiment involving two biological conditions with several shared cell types.
We focus on a cell type <span class="math inline">\(X\)</span> that is present in both conditions but contains some DEGs between conditions.
This leads to two possible outcomes:</p>
<ol style="list-style-type: decimal">
<li>The DE between conditions causes <span class="math inline">\(X\)</span> to form two separate clusters (say, <span class="math inline">\(X_1\)</span> and <span class="math inline">\(X_2\)</span>) in expression space.
This manifests as DA where <span class="math inline">\(X_1\)</span> is enriched in one condition and <span class="math inline">\(X_2\)</span> is enriched in the other condition.</li>
<li>The DE between conditions is not sufficient to split <span class="math inline">\(X\)</span> into two separate clusters,
e.g., because the data integration procedure identifies them as corresponding cell types and merges them together.
This means that the differences between conditions manifest as DE within the single cluster corresponding to <span class="math inline">\(X\)</span>.</li>
</ol>
<p>We have described the example above in terms of clustering, but the same arguments apply for any labelling strategy based on the expression profiles, e.g., automated cell type assignment (Chapter <a href="cell-type-annotation.html#cell-type-annotation">12</a>).
Moreover, the choice between outcomes 1 and 2 is made implicitly by the combined effect of the data merging, clustering and label assignment procedures.
For example, differences between conditions are more likely to manifest as DE for coarser clusters and as DA for finer clusters, but this is difficult to predict reliably.</p>
<p>The moral of the story is that DA and DE analyses are simply two different perspectives on the same phenomena.
For any comprehensive characterization of differences between populations, it is usually necessary to consider both analyses.
Indeed, they complement each other almost by definition, e.g., clustering parameters that reduce DE will increase DA and vice versa.</p>
</div>
<div id="sacrificing-differences" class="section level3">
<h3><span class="header-section-number">14.6.2</span> Sacrificing biology by integration</h3>
<p>Earlier in this chapter, we defined clusters from corrected values after applying <code>fastMNN()</code> to cells from all samples in the chimera dataset.
Alert readers may realize that this would result in the removal of biological differences between our conditions.
Any systematic difference in expression caused by injection would be treated as a batch effect and lost when cells from different samples are aligned to the same coordinate space.
Now, one may not consider injection to be an interesting biological effect, but the same reasoning applies for other conditions, e.g., integration of wild-type and knock-out samples (Section <a href="multi-sample-comparisons.html#ambient-problems">14.4</a>) would result in the loss of any knock-out effect in the corrected values.</p>
<p>This loss is both expected and desirable.
As we mentioned in Section <a href="integrating-datasets.html#using-corrected-values">13.7</a>, the main motivation for performing batch correction is to enable us to characterize population heterogeneity in a consistent manner across samples.
This remains true in situations with multiple conditions where we would like one set of clusters and annotations that can be used as common labels for the DE or DA analyses described above.
The alternative would be to cluster each condition separately and to attempt to identify matching clusters across conditions - not straightforward for poorly separated clusters in contexts like differentiation.</p>
<p>It may seem distressing to some that a (potentially very interesting) biological difference between conditions is lost during correction.
However, this concern is largely misplaced as the correction is only ever used for defining common clusters and annotations.
The DE analysis itself is performed on pseudo-bulk samples created from the uncorrected counts, preserving the biological difference and ensuring that it manifests in the list of DE genes for affected cell types.
Of course, if the DE is strong enough, it may result in a new condition-specific cluster that would be captured by a DA analysis as discussed in Section <a href="multi-sample-comparisons.html#de-da-duality">14.6.1</a>.</p>
<p>One final consideration is the interaction of condition-specific expression with the assumptions of each batch correction method.
For example, MNN correction assumes that the differences between samples are orthogonal to the variation within samples.
Arguably, this assumption is becomes more questionable if the between-sample differences are biological in nature, e.g., a treatment effect that makes one cell type seem more transcriptionally similar to another may cause the wrong clusters to be aligned across conditions.
As usual, users will benefit from the diagnostics described in Chapter <a href="integrating-datasets.html#integrating-datasets">13</a> and a healthy dose of skepticism.</p>
</div>
</div>
<div id="session-info" class="section level2 unnumbered">
<h2>Session Info</h2>
<button class="aaron-collapse">
View session info
</button>
<div class="aaron-content">
<pre><code>R version 4.0.2 (2020-06-22)
Platform: x86_64-pc-linux-gnu (64-bit)
Running under: Ubuntu 18.04.5 LTS

Matrix products: default
BLAS:   /home/biocbuild/bbs-3.12-bioc/R/lib/libRblas.so
LAPACK: /home/biocbuild/bbs-3.12-bioc/R/lib/libRlapack.so

locale:
 [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C              
 [3] LC_TIME=en_US.UTF-8        LC_COLLATE=C              
 [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8   
 [7] LC_PAPER=en_US.UTF-8       LC_NAME=C                 
 [9] LC_ADDRESS=C               LC_TELEPHONE=C            
[11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C       

attached base packages:
[1] parallel  stats4    stats     graphics  grDevices utils     datasets 
[8] methods   base     

other attached packages:
 [1] DropletUtils_1.9.10         scuttle_0.99.12            
 [3] MouseGastrulationData_1.3.0 scran_1.17.15              
 [5] edgeR_3.31.4                limma_3.45.10              
 [7] scater_1.17.4               ggplot2_3.3.2              
 [9] BiocSingular_1.5.0          SingleCellExperiment_1.11.6
[11] SummarizedExperiment_1.19.6 DelayedArray_0.15.7        
[13] matrixStats_0.56.0          Matrix_1.2-18              
[15] Biobase_2.49.0              GenomicRanges_1.41.6       
[17] GenomeInfoDb_1.25.10        IRanges_2.23.10            
[19] S4Vectors_0.27.12           BiocGenerics_0.35.4        
[21] BiocStyle_2.17.0            simpleSingleCell_1.13.16   

loaded via a namespace (and not attached):
  [1] ggbeeswarm_0.6.0              colorspace_1.4-1             
  [3] ellipsis_0.3.1                bluster_0.99.1               
  [5] XVector_0.29.3                BiocNeighbors_1.7.0          
  [7] farver_2.0.3                  bit64_4.0.2                  
  [9] interactiveDisplayBase_1.27.5 AnnotationDbi_1.51.3         
 [11] R.methodsS3_1.8.0             codetools_0.2-16             
 [13] splines_4.0.2                 knitr_1.29                   
 [15] dbplyr_1.4.4                  R.oo_1.23.0                  
 [17] pheatmap_1.0.12               graph_1.67.1                 
 [19] HDF5Array_1.17.3              shiny_1.5.0                  
 [21] BiocManager_1.30.10           compiler_4.0.2               
 [23] httr_1.4.2                    dqrng_0.2.1                  
 [25] assertthat_0.2.1              fastmap_1.0.1                
 [27] later_1.1.0.1                 htmltools_0.5.0              
 [29] tools_4.0.2                   rsvd_1.0.3                   
 [31] igraph_1.2.5                  gtable_0.3.0                 
 [33] glue_1.4.1                    GenomeInfoDbData_1.2.3       
 [35] dplyr_1.0.1                   rappdirs_0.3.1               
 [37] Rcpp_1.0.5                    rhdf5filters_1.1.2           
 [39] vctrs_0.3.2                   ExperimentHub_1.15.1         
 [41] DelayedMatrixStats_1.11.1     xfun_0.16                    
 [43] stringr_1.4.0                 ps_1.3.4                     
 [45] mime_0.9                      lifecycle_0.2.0              
 [47] irlba_2.3.3                   statmod_1.4.34               
 [49] XML_3.99-0.5                  AnnotationHub_2.21.2         
 [51] zlibbioc_1.35.0               scales_1.1.1                 
 [53] promises_1.1.1                rhdf5_2.33.7                 
 [55] RColorBrewer_1.1-2            yaml_2.2.1                   
 [57] curl_4.3                      memoise_1.1.0                
 [59] gridExtra_2.3                 stringi_1.4.6                
 [61] RSQLite_2.2.0                 BiocVersion_3.12.0           
 [63] highr_0.8                     BiocParallel_1.23.2          
 [65] rlang_0.4.7                   pkgconfig_2.0.3              
 [67] bitops_1.0-6                  evaluate_0.14                
 [69] lattice_0.20-41               Rhdf5lib_1.11.3              
 [71] purrr_0.3.4                   CodeDepends_0.6.5            
 [73] labeling_0.3                  cowplot_1.0.0                
 [75] bit_4.0.4                     processx_3.4.3               
 [77] tidyselect_1.1.0              magrittr_1.5                 
 [79] bookdown_0.20                 R6_2.4.1                     
 [81] generics_0.0.2                DBI_1.1.0                    
 [83] pillar_1.4.6                  withr_2.2.0                  
 [85] RCurl_1.98-1.2                tibble_3.0.3                 
 [87] crayon_1.3.4                  BiocFileCache_1.13.1         
 [89] rmarkdown_2.3                 viridis_0.5.1                
 [91] locfit_1.5-9.4                grid_4.0.2                   
 [93] blob_1.2.1                    callr_3.4.3                  
 [95] digest_0.6.25                 xtable_1.8-4                 
 [97] httpuv_1.5.4                  R.utils_2.9.2                
 [99] munsell_0.5.0                 beeswarm_0.2.3               
[101] viridisLite_0.3.0             vipor_0.4.5                  </code></pre>
</div>

</div>
</div>
<h3> Bibliography</h3>
<div id="refs" class="references">
<div id="ref-chen2016reads">
<p>Chen, Y., A. T. Lun, and G. K. Smyth. 2016. “From reads to genes to pathways: differential expression analysis of RNA-Seq experiments using Rsubread and the edgeR quasi-likelihood pipeline.” <em>F1000Res</em> 5:1438.</p>
</div>
<div id="ref-crowell2019discovery">
<p>Crowell, H. L., C. Soneson, P.-L. Germain, D. Calini, L. Collin, C. Raposo, D. Malhotra, and M. D. Robinson. 2019. “On the Discovery of Population-Specific State Transitions from Multi-Sample Multi-Condition Single-Cell Rna Sequencing Data.” <em>bioRxiv</em>. <a href="https://doi.org/10.1101/713412" class="uri">https://doi.org/10.1101/713412</a>.</p>
</div>
<div id="ref-finak2014opencyto">
<p>Finak, G., J. Frelinger, W. Jiang, E. W. Newell, J. Ramey, M. M. Davis, S. A. Kalams, S. C. De Rosa, and R. Gottardo. 2014. “OpenCyto: an open source infrastructure for scalable, robust, reproducible, and automated, end-to-end flow cytometry data analysis.” <em>PLoS Comput. Biol.</em> 10 (8):e1003806.</p>
</div>
<div id="ref-lun2017overcoming">
<p>Lun, A. T. L., and J. C. Marioni. 2017. “Overcoming confounding plate effects in differential expression analyses of single-cell RNA-seq data.” <em>Biostatistics</em> 18 (3):451–64.</p>
</div>
<div id="ref-lun2017testing">
<p>Lun, A. T. L., A. C. Richard, and J. C. Marioni. 2017. “Testing for differential abundance in mass cytometry data.” <em>Nat. Methods</em> 14 (7):707–9.</p>
</div>
<div id="ref-lun2018distinguishing">
<p>Lun, A., S. Riesenfeld, T. Andrews, T. P. Dao, T. Gomes, participants in the 1<sup>st</sup> Human Cell Atlas Jamboree, and J. Marioni. 2019. “EmptyDrops: distinguishing cells from empty droplets in droplet-based single-cell RNA sequencing data.” <em>Genome Biol.</em> 20 (1):63.</p>
</div>
<div id="ref-mccarthy2009treat">
<p>McCarthy, D. J., and G. K. Smyth. 2009. “Testing significance relative to a fold-change threshold is a TREAT.” <em>Bioinformatics</em> 25 (6):765–71.</p>
</div>
<div id="ref-phipson2016robust">
<p>Phipson, B., S. Lee, I. J. Majewski, W. S. Alexander, and G. K. Smyth. 2016. “Robust Hyperparameter Estimation Protects Against Hypervariable Genes and Improves Power to Detect Differential Expression.” <em>Ann. Appl. Stat.</em> 10 (2):946–63.</p>
</div>
<div id="ref-pijuansala2019single">
<p>Pijuan-Sala, B., J. A. Griffiths, C. Guibentif, T. W. Hiscock, W. Jawaid, F. J. Calero-Nieto, C. Mulas, et al. 2019. “A Single-Cell Molecular Map of Mouse Gastrulation and Early Organogenesis.” <em>Nature</em> 566 (7745):490–95.</p>
</div>
<div id="ref-richard2018tcell">
<p>Richard, A. C., A. T. L. Lun, W. W. Y. Lau, B. Gottgens, J. C. Marioni, and G. M. Griffiths. 2018. “T cell cytolytic capacity is independent of initial stimulation strength.” <em>Nat. Immunol.</em> 19 (8):849–58.</p>
</div>
<div id="ref-robinson2010edgeR">
<p>Robinson, M. D., D. J. McCarthy, and G. K. Smyth. 2010. “edgeR: a Bioconductor package for differential expression analysis of digital gene expression data.” <em>Bioinformatics</em> 26 (1):139–40.</p>
</div>
<div id="ref-robinson2010scaling">
<p>Robinson, M. D., and A. Oshlack. 2010. “A scaling normalization method for differential expression analysis of RNA-seq data.” <em>Genome Biol.</em> 11 (3):R25.</p>
</div>
<div id="ref-scialdone2016resolving">
<p>Scialdone, A., Y. Tanaka, W. Jawaid, V. Moignard, N. K. Wilson, I. C. Macaulay, J. C. Marioni, and B. Gottgens. 2016. “Resolving early mesoderm diversification through single-cell expression profiling.” <em>Nature</em> 535 (7611):289–93.</p>
</div>
<div id="ref-tung2017batch">
<p>Tung, P. Y., J. D. Blischak, C. J. Hsiao, D. A. Knowles, J. E. Burnett, J. K. Pritchard, and Y. Gilad. 2017. “Batch effects and the effective design of single-cell gene expression studies.” <em>Sci. Rep.</em> 7 (January):39921.</p>
</div>
<div id="ref-young2018soupx">
<p>Young, M. D., and S. Behjati. 2018. “SoupX Removes Ambient RNA Contamination from Droplet Based Single Cell RNA Sequencing Data.” <em>bioRxiv</em>.</p>
</div>
<div id="ref-zheng2017massively">
<p>Zheng, G. X., J. M. Terry, P. Belgrader, P. Ryvkin, Z. W. Bent, R. Wilson, S. B. Ziraldo, et al. 2017. “Massively parallel digital transcriptional profiling of single cells.” <em>Nat Commun</em> 8 (January):14049.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="integrating-datasets.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="droplet-processing.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": false,
"twitter": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/Bioconductor/OrchestratingSingleCellAnalysis-base/edit/master/sample-comparisons.Rmd",
"text": "Edit"
},
"history": {
"link": "https://github.com/Bioconductor/OrchestratingSingleCellAnalysis-base/commits/master/sample-comparisons.Rmd",
"text": null
},
"view": {
"link": "https://github.com/Bioconductor/OrchestratingSingleCellAnalysis-base/blob/master/sample-comparisons.Rmd",
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
