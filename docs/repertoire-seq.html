<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 21 Analyzing repertoire sequencing data | Orchestrating Single-Cell Analysis with Bioconductor</title>
  <meta name="description" content="Or: how I learned to stop worrying and love the t-SNEs." />
  <meta name="generator" content="bookdown 0.20 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 21 Analyzing repertoire sequencing data | Orchestrating Single-Cell Analysis with Bioconductor" />
  <meta property="og:type" content="book" />
  
  <meta property="og:image" content="https://www.bioconductor.org/images/logo_bioconductor.gif" />
  <meta property="og:description" content="Or: how I learned to stop worrying and love the t-SNEs." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 21 Analyzing repertoire sequencing data | Orchestrating Single-Cell Analysis with Bioconductor" />
  
  <meta name="twitter:description" content="Or: how I learned to stop worrying and love the t-SNEs." />
  <meta name="twitter:image" content="https://www.bioconductor.org/images/logo_bioconductor.gif" />



<meta name="date" content="2020-08-17" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  <link rel="shortcut icon" href="favicon.ico" type="image/x-icon" />
<link rel="prev" href="integrating-with-protein-abundance.html"/>
<link rel="next" href="interactive-sharing.html"/>
<script src="libs/header-attrs-2.3/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Orchestrating Single-Cell Analysis</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome</a></li>
<li class="part"><span><b>I Preamble</b></span></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="introduction.html"><a href="introduction.html#what-you-will-learn"><i class="fa fa-check"></i><b>1.1</b> What you will learn</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="introduction.html"><a href="introduction.html#preliminaries"><i class="fa fa-check"></i><b>1.1.1</b> Preliminaries</a></li>
<li class="chapter" data-level="1.1.2" data-path="introduction.html"><a href="introduction.html#workflows"><i class="fa fa-check"></i><b>1.1.2</b> Workflows</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="introduction.html"><a href="introduction.html#what-you-wont-learn"><i class="fa fa-check"></i><b>1.2</b> What you won’t learn</a></li>
<li class="chapter" data-level="1.3" data-path="introduction.html"><a href="introduction.html#who-we-wrote-this-for"><i class="fa fa-check"></i><b>1.3</b> Who we wrote this for</a></li>
<li class="chapter" data-level="1.4" data-path="introduction.html"><a href="introduction.html#why-we-wrote-this"><i class="fa fa-check"></i><b>1.4</b> Why we wrote this</a></li>
<li class="chapter" data-level="1.5" data-path="introduction.html"><a href="introduction.html#acknowledgements"><i class="fa fa-check"></i><b>1.5</b> Acknowledgements</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="learning-r-and-more.html"><a href="learning-r-and-more.html"><i class="fa fa-check"></i><b>2</b> Learning R and Bioconductor</a>
<ul>
<li class="chapter" data-level="2.1" data-path="learning-r-and-more.html"><a href="learning-r-and-more.html#the-benefits-of-r-and-bioconductor"><i class="fa fa-check"></i><b>2.1</b> The Benefits of R and Bioconductor</a></li>
<li class="chapter" data-level="2.2" data-path="learning-r-and-more.html"><a href="learning-r-and-more.html#getting-started-with-r"><i class="fa fa-check"></i><b>2.2</b> Learning R Online</a></li>
<li class="chapter" data-level="2.3" data-path="learning-r-and-more.html"><a href="learning-r-and-more.html#running-r-locally"><i class="fa fa-check"></i><b>2.3</b> Running R Locally</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="learning-r-and-more.html"><a href="learning-r-and-more.html#installing-r"><i class="fa fa-check"></i><b>2.3.1</b> Installing R</a></li>
<li class="chapter" data-level="2.3.2" data-path="learning-r-and-more.html"><a href="learning-r-and-more.html#installing-r-bioconductor-packages"><i class="fa fa-check"></i><b>2.3.2</b> Installing R &amp; Bioconductor Packages</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="learning-r-and-more.html"><a href="learning-r-and-more.html#getting-help-in-and-out-of-r"><i class="fa fa-check"></i><b>2.4</b> Getting Help In (and Out) of R</a></li>
<li class="chapter" data-level="2.5" data-path="learning-r-and-more.html"><a href="learning-r-and-more.html#bioconductor-documentation"><i class="fa fa-check"></i><b>2.5</b> Bioconductor Help</a>
<ul>
<li class="chapter" data-level="2.5.1" data-path="learning-r-and-more.html"><a href="learning-r-and-more.html#bioconductor-packages"><i class="fa fa-check"></i><b>2.5.1</b> Bioconductor Packages</a></li>
<li class="chapter" data-level="2.5.2" data-path="learning-r-and-more.html"><a href="learning-r-and-more.html#biocviews"><i class="fa fa-check"></i><b>2.5.2</b> biocViews</a></li>
<li class="chapter" data-level="2.5.3" data-path="learning-r-and-more.html"><a href="learning-r-and-more.html#bioconductor-forums"><i class="fa fa-check"></i><b>2.5.3</b> Bioconductor Forums</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="beyond-r-basics.html"><a href="beyond-r-basics.html"><i class="fa fa-check"></i><b>3</b> Beyond R Basics</a>
<ul>
<li class="chapter" data-level="3.1" data-path="beyond-r-basics.html"><a href="beyond-r-basics.html#becoming-an-r-expert"><i class="fa fa-check"></i><b>3.1</b> Becoming an R Expert</a></li>
<li class="chapter" data-level="3.2" data-path="beyond-r-basics.html"><a href="beyond-r-basics.html#becoming-a-bioconductor-developer"><i class="fa fa-check"></i><b>3.2</b> Becoming an R/Bioconductor Developer</a></li>
<li class="chapter" data-level="3.3" data-path="beyond-r-basics.html"><a href="beyond-r-basics.html#nice-companions-for-r"><i class="fa fa-check"></i><b>3.3</b> Nice Companions for R</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="beyond-r-basics.html"><a href="beyond-r-basics.html#shellbash"><i class="fa fa-check"></i><b>3.3.1</b> Shell/Bash</a></li>
<li class="chapter" data-level="3.3.2" data-path="beyond-r-basics.html"><a href="beyond-r-basics.html#git"><i class="fa fa-check"></i><b>3.3.2</b> Git</a></li>
<li class="chapter" data-level="3.3.3" data-path="beyond-r-basics.html"><a href="beyond-r-basics.html#other-languages"><i class="fa fa-check"></i><b>3.3.3</b> Other Languages</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="data-infrastructure.html"><a href="data-infrastructure.html"><i class="fa fa-check"></i><b>4</b> Data Infrastructure</a>
<ul>
<li class="chapter" data-level="4.1" data-path="data-infrastructure.html"><a href="data-infrastructure.html#background"><i class="fa fa-check"></i><b>4.1</b> Background</a></li>
<li class="chapter" data-level="4.2" data-path="data-infrastructure.html"><a href="data-infrastructure.html#storing-primary-experimental-data"><i class="fa fa-check"></i><b>4.2</b> Storing primary experimental data</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="data-infrastructure.html"><a href="data-infrastructure.html#filling-the-assays-slot"><i class="fa fa-check"></i><b>4.2.1</b> Filling the <code>assays</code> slot</a></li>
<li class="chapter" data-level="4.2.2" data-path="data-infrastructure.html"><a href="data-infrastructure.html#adding-more-assays"><i class="fa fa-check"></i><b>4.2.2</b> Adding more <code>assays</code></a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="data-infrastructure.html"><a href="data-infrastructure.html#handling-metadata"><i class="fa fa-check"></i><b>4.3</b> Handling metadata</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="data-infrastructure.html"><a href="data-infrastructure.html#on-the-columns"><i class="fa fa-check"></i><b>4.3.1</b> On the columns</a></li>
<li class="chapter" data-level="4.3.2" data-path="data-infrastructure.html"><a href="data-infrastructure.html#on-the-rows"><i class="fa fa-check"></i><b>4.3.2</b> On the rows</a></li>
<li class="chapter" data-level="4.3.3" data-path="data-infrastructure.html"><a href="data-infrastructure.html#other-metadata"><i class="fa fa-check"></i><b>4.3.3</b> Other metadata</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="data-infrastructure.html"><a href="data-infrastructure.html#single-cell-specific-fields"><i class="fa fa-check"></i><b>4.4</b> Single-cell-specific fields</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="data-infrastructure.html"><a href="data-infrastructure.html#background-1"><i class="fa fa-check"></i><b>4.4.1</b> Background</a></li>
<li class="chapter" data-level="4.4.2" data-path="data-infrastructure.html"><a href="data-infrastructure.html#dimensionality-reduction-results"><i class="fa fa-check"></i><b>4.4.2</b> Dimensionality reduction results</a></li>
<li class="chapter" data-level="4.4.3" data-path="data-infrastructure.html"><a href="data-infrastructure.html#alternative-experiments"><i class="fa fa-check"></i><b>4.4.3</b> Alternative Experiments</a></li>
<li class="chapter" data-level="4.4.4" data-path="data-infrastructure.html"><a href="data-infrastructure.html#size-factors"><i class="fa fa-check"></i><b>4.4.4</b> Size factors</a></li>
<li class="chapter" data-level="4.4.5" data-path="data-infrastructure.html"><a href="data-infrastructure.html#column-labels"><i class="fa fa-check"></i><b>4.4.5</b> Column labels</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="data-infrastructure.html"><a href="data-infrastructure.html#conclusion"><i class="fa fa-check"></i><b>4.5</b> Conclusion</a></li>
</ul></li>
<li class="part"><span><b>II Focus Topics</b></span></li>
<li class="chapter" data-level="5" data-path="overview.html"><a href="overview.html"><i class="fa fa-check"></i><b>5</b> Overview</a>
<ul>
<li class="chapter" data-level="5.1" data-path="introduction.html"><a href="introduction.html#introduction"><i class="fa fa-check"></i><b>5.1</b> Introduction</a></li>
<li class="chapter" data-level="5.2" data-path="overview.html"><a href="overview.html#experimental-design"><i class="fa fa-check"></i><b>5.2</b> Experimental Design</a></li>
<li class="chapter" data-level="5.3" data-path="overview.html"><a href="overview.html#obtaining-a-count-matrix"><i class="fa fa-check"></i><b>5.3</b> Obtaining a count matrix</a></li>
<li class="chapter" data-level="5.4" data-path="overview.html"><a href="overview.html#data-processing-and-downstream-analysis"><i class="fa fa-check"></i><b>5.4</b> Data processing and downstream analysis</a></li>
<li class="chapter" data-level="5.5" data-path="overview.html"><a href="overview.html#quick-start"><i class="fa fa-check"></i><b>5.5</b> Quick start</a></li>
<li class="chapter" data-level="" data-path="overview.html"><a href="overview.html#session-info"><i class="fa fa-check"></i>Session Info</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="quality-control.html"><a href="quality-control.html"><i class="fa fa-check"></i><b>6</b> Quality Control</a>
<ul>
<li class="chapter" data-level="6.1" data-path="quality-control.html"><a href="quality-control.html#quality-control-motivation"><i class="fa fa-check"></i><b>6.1</b> Motivation</a></li>
<li class="chapter" data-level="6.2" data-path="quality-control.html"><a href="quality-control.html#choice-of-qc-metrics"><i class="fa fa-check"></i><b>6.2</b> Choice of QC metrics</a></li>
<li class="chapter" data-level="6.3" data-path="quality-control.html"><a href="quality-control.html#identifying-low-quality-cells"><i class="fa fa-check"></i><b>6.3</b> Identifying low-quality cells</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="quality-control.html"><a href="quality-control.html#fixed-qc"><i class="fa fa-check"></i><b>6.3.1</b> With fixed thresholds</a></li>
<li class="chapter" data-level="6.3.2" data-path="quality-control.html"><a href="quality-control.html#quality-control-outlier"><i class="fa fa-check"></i><b>6.3.2</b> With adaptive thresholds</a></li>
<li class="chapter" data-level="6.3.3" data-path="quality-control.html"><a href="quality-control.html#other-approaches"><i class="fa fa-check"></i><b>6.3.3</b> Other approaches</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="quality-control.html"><a href="quality-control.html#quality-control-plots"><i class="fa fa-check"></i><b>6.4</b> Checking diagnostic plots</a></li>
<li class="chapter" data-level="6.5" data-path="quality-control.html"><a href="quality-control.html#quality-control-discarded"><i class="fa fa-check"></i><b>6.5</b> Removing low-quality cells</a></li>
<li class="chapter" data-level="6.6" data-path="quality-control.html"><a href="quality-control.html#marking-qc"><i class="fa fa-check"></i><b>6.6</b> Marking low-quality cells</a></li>
<li class="chapter" data-level="" data-path="overview.html"><a href="overview.html#session-info"><i class="fa fa-check"></i>Session Info</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="normalization.html"><a href="normalization.html"><i class="fa fa-check"></i><b>7</b> Normalization</a>
<ul>
<li class="chapter" data-level="7.1" data-path="normalization.html"><a href="normalization.html#motivation"><i class="fa fa-check"></i><b>7.1</b> Motivation</a></li>
<li class="chapter" data-level="7.2" data-path="normalization.html"><a href="normalization.html#library-size-normalization"><i class="fa fa-check"></i><b>7.2</b> Library size normalization</a></li>
<li class="chapter" data-level="7.3" data-path="normalization.html"><a href="normalization.html#normalization-by-deconvolution"><i class="fa fa-check"></i><b>7.3</b> Normalization by deconvolution</a></li>
<li class="chapter" data-level="7.4" data-path="normalization.html"><a href="normalization.html#spike-norm"><i class="fa fa-check"></i><b>7.4</b> Normalization by spike-ins</a></li>
<li class="chapter" data-level="7.5" data-path="normalization.html"><a href="normalization.html#applying-the-size-factors"><i class="fa fa-check"></i><b>7.5</b> Applying the size factors</a>
<ul>
<li class="chapter" data-level="7.5.1" data-path="normalization.html"><a href="normalization.html#normalization-transformation"><i class="fa fa-check"></i><b>7.5.1</b> Scaling and log-transforming</a></li>
<li class="chapter" data-level="7.5.2" data-path="normalization.html"><a href="normalization.html#downsampling-and-log-transforming"><i class="fa fa-check"></i><b>7.5.2</b> Downsampling and log-transforming</a></li>
<li class="chapter" data-level="7.5.3" data-path="normalization.html"><a href="normalization.html#other-options"><i class="fa fa-check"></i><b>7.5.3</b> Other options</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="overview.html"><a href="overview.html#session-info"><i class="fa fa-check"></i>Session Info</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="feature-selection.html"><a href="feature-selection.html"><i class="fa fa-check"></i><b>8</b> Feature selection</a>
<ul>
<li class="chapter" data-level="8.1" data-path="normalization.html"><a href="normalization.html#motivation"><i class="fa fa-check"></i><b>8.1</b> Motivation</a></li>
<li class="chapter" data-level="8.2" data-path="feature-selection.html"><a href="feature-selection.html#quantifying-per-gene-variation"><i class="fa fa-check"></i><b>8.2</b> Quantifying per-gene variation</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="feature-selection.html"><a href="feature-selection.html#variance-of-the-log-counts"><i class="fa fa-check"></i><b>8.2.1</b> Variance of the log-counts</a></li>
<li class="chapter" data-level="8.2.2" data-path="feature-selection.html"><a href="feature-selection.html#coefficient-of-variation"><i class="fa fa-check"></i><b>8.2.2</b> Coefficient of variation</a></li>
<li class="chapter" data-level="8.2.3" data-path="feature-selection.html"><a href="feature-selection.html#sec:spikeins"><i class="fa fa-check"></i><b>8.2.3</b> Quantifying technical noise</a></li>
<li class="chapter" data-level="8.2.4" data-path="feature-selection.html"><a href="feature-selection.html#accounting-for-blocking-factors"><i class="fa fa-check"></i><b>8.2.4</b> Accounting for blocking factors</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="feature-selection.html"><a href="feature-selection.html#hvg-selection"><i class="fa fa-check"></i><b>8.3</b> Selecting highly variable genes</a>
<ul>
<li class="chapter" data-level="8.3.1" data-path="overview.html"><a href="overview.html#overview"><i class="fa fa-check"></i><b>8.3.1</b> Overview</a></li>
<li class="chapter" data-level="8.3.2" data-path="feature-selection.html"><a href="feature-selection.html#based-on-the-largest-metrics"><i class="fa fa-check"></i><b>8.3.2</b> Based on the largest metrics</a></li>
<li class="chapter" data-level="8.3.3" data-path="feature-selection.html"><a href="feature-selection.html#based-on-significance"><i class="fa fa-check"></i><b>8.3.3</b> Based on significance</a></li>
<li class="chapter" data-level="8.3.4" data-path="feature-selection.html"><a href="feature-selection.html#feature-selection-positive"><i class="fa fa-check"></i><b>8.3.4</b> Keeping all genes above the trend</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="feature-selection.html"><a href="feature-selection.html#apriori-hvgs"><i class="fa fa-check"></i><b>8.4</b> Selecting <em>a priori</em> genes of interest</a></li>
<li class="chapter" data-level="8.5" data-path="feature-selection.html"><a href="feature-selection.html#feature-selection-subsetting"><i class="fa fa-check"></i><b>8.5</b> Putting it all together</a></li>
<li class="chapter" data-level="" data-path="overview.html"><a href="overview.html#session-info"><i class="fa fa-check"></i>Session Info</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="dimensionality-reduction.html"><a href="dimensionality-reduction.html"><i class="fa fa-check"></i><b>9</b> Dimensionality reduction</a>
<ul>
<li class="chapter" data-level="9.1" data-path="overview.html"><a href="overview.html#overview"><i class="fa fa-check"></i><b>9.1</b> Overview</a></li>
<li class="chapter" data-level="9.2" data-path="dimensionality-reduction.html"><a href="dimensionality-reduction.html#principal-components-analysis"><i class="fa fa-check"></i><b>9.2</b> Principal components analysis</a></li>
<li class="chapter" data-level="9.3" data-path="dimensionality-reduction.html"><a href="dimensionality-reduction.html#choosing-the-number-of-pcs"><i class="fa fa-check"></i><b>9.3</b> Choosing the number of PCs</a>
<ul>
<li class="chapter" data-level="9.3.1" data-path="normalization.html"><a href="normalization.html#motivation"><i class="fa fa-check"></i><b>9.3.1</b> Motivation</a></li>
<li class="chapter" data-level="9.3.2" data-path="dimensionality-reduction.html"><a href="dimensionality-reduction.html#using-the-elbow-point"><i class="fa fa-check"></i><b>9.3.2</b> Using the elbow point</a></li>
<li class="chapter" data-level="9.3.3" data-path="dimensionality-reduction.html"><a href="dimensionality-reduction.html#using-the-technical-noise"><i class="fa fa-check"></i><b>9.3.3</b> Using the technical noise</a></li>
<li class="chapter" data-level="9.3.4" data-path="dimensionality-reduction.html"><a href="dimensionality-reduction.html#based-on-population-structure"><i class="fa fa-check"></i><b>9.3.4</b> Based on population structure</a></li>
<li class="chapter" data-level="9.3.5" data-path="dimensionality-reduction.html"><a href="dimensionality-reduction.html#using-random-matrix-theory"><i class="fa fa-check"></i><b>9.3.5</b> Using random matrix theory</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="dimensionality-reduction.html"><a href="dimensionality-reduction.html#dimensionality-reduction-for-visualization"><i class="fa fa-check"></i><b>9.4</b> Dimensionality reduction for visualization</a>
<ul>
<li class="chapter" data-level="9.4.1" data-path="dimensionality-reduction.html"><a href="dimensionality-reduction.html#motivation-1"><i class="fa fa-check"></i><b>9.4.1</b> Motivation</a></li>
<li class="chapter" data-level="9.4.2" data-path="dimensionality-reduction.html"><a href="dimensionality-reduction.html#visualizing-with-pca"><i class="fa fa-check"></i><b>9.4.2</b> Visualizing with PCA</a></li>
<li class="chapter" data-level="9.4.3" data-path="dimensionality-reduction.html"><a href="dimensionality-reduction.html#t-stochastic-neighbor-embedding"><i class="fa fa-check"></i><b>9.4.3</b> <span class="math inline">\(t\)</span>-stochastic neighbor embedding</a></li>
<li class="chapter" data-level="9.4.4" data-path="dimensionality-reduction.html"><a href="dimensionality-reduction.html#uniform-manifold-approximation-and-projection"><i class="fa fa-check"></i><b>9.4.4</b> Uniform manifold approximation and projection</a></li>
<li class="chapter" data-level="9.4.5" data-path="dimensionality-reduction.html"><a href="dimensionality-reduction.html#visualization-interpretation"><i class="fa fa-check"></i><b>9.4.5</b> Interpreting the plots</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="overview.html"><a href="overview.html#session-info"><i class="fa fa-check"></i>Session Info</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="clustering.html"><a href="clustering.html"><i class="fa fa-check"></i><b>10</b> Clustering</a>
<ul>
<li class="chapter" data-level="10.1" data-path="normalization.html"><a href="normalization.html#motivation"><i class="fa fa-check"></i><b>10.1</b> Motivation</a></li>
<li class="chapter" data-level="10.2" data-path="clustering.html"><a href="clustering.html#what-is-the-true-clustering"><i class="fa fa-check"></i><b>10.2</b> What is the “true clustering”?</a></li>
<li class="chapter" data-level="10.3" data-path="clustering.html"><a href="clustering.html#clustering-graph"><i class="fa fa-check"></i><b>10.3</b> Graph-based clustering</a>
<ul>
<li class="chapter" data-level="10.3.1" data-path="data-infrastructure.html"><a href="data-infrastructure.html#background"><i class="fa fa-check"></i><b>10.3.1</b> Background</a></li>
<li class="chapter" data-level="10.3.2" data-path="clustering.html"><a href="clustering.html#implementation"><i class="fa fa-check"></i><b>10.3.2</b> Implementation</a></li>
<li class="chapter" data-level="10.3.3" data-path="clustering.html"><a href="clustering.html#other-parameters"><i class="fa fa-check"></i><b>10.3.3</b> Other parameters</a></li>
<li class="chapter" data-level="10.3.4" data-path="clustering.html"><a href="clustering.html#assessing-cluster-separation"><i class="fa fa-check"></i><b>10.3.4</b> Assessing cluster separation</a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="clustering.html"><a href="clustering.html#k-means-clustering"><i class="fa fa-check"></i><b>10.4</b> <span class="math inline">\(k\)</span>-means clustering</a>
<ul>
<li class="chapter" data-level="10.4.1" data-path="data-infrastructure.html"><a href="data-infrastructure.html#background-1"><i class="fa fa-check"></i><b>10.4.1</b> Background</a></li>
<li class="chapter" data-level="10.4.2" data-path="clustering.html"><a href="clustering.html#base-implementation"><i class="fa fa-check"></i><b>10.4.2</b> Base implementation</a></li>
<li class="chapter" data-level="10.4.3" data-path="clustering.html"><a href="clustering.html#assessing-cluster-separation-1"><i class="fa fa-check"></i><b>10.4.3</b> Assessing cluster separation</a></li>
<li class="chapter" data-level="10.4.4" data-path="clustering.html"><a href="clustering.html#in-two-step-procedures"><i class="fa fa-check"></i><b>10.4.4</b> In two-step procedures</a></li>
</ul></li>
<li class="chapter" data-level="10.5" data-path="clustering.html"><a href="clustering.html#hierarchical-clustering"><i class="fa fa-check"></i><b>10.5</b> Hierarchical clustering</a>
<ul>
<li class="chapter" data-level="10.5.1" data-path="clustering.html"><a href="clustering.html#background-2"><i class="fa fa-check"></i><b>10.5.1</b> Background</a></li>
<li class="chapter" data-level="10.5.2" data-path="clustering.html"><a href="clustering.html#implementation-1"><i class="fa fa-check"></i><b>10.5.2</b> Implementation</a></li>
<li class="chapter" data-level="10.5.3" data-path="clustering.html"><a href="clustering.html#silhouette-width"><i class="fa fa-check"></i><b>10.5.3</b> Assessing cluster separation</a></li>
</ul></li>
<li class="chapter" data-level="10.6" data-path="clustering.html"><a href="clustering.html#general-purpose-cluster-diagnostics"><i class="fa fa-check"></i><b>10.6</b> General-purpose cluster diagnostics</a>
<ul>
<li class="chapter" data-level="10.6.1" data-path="clustering.html"><a href="clustering.html#cluster-separation-redux"><i class="fa fa-check"></i><b>10.6.1</b> Cluster separation, redux</a></li>
<li class="chapter" data-level="10.6.2" data-path="clustering.html"><a href="clustering.html#comparing-different-clusterings"><i class="fa fa-check"></i><b>10.6.2</b> Comparing different clusterings</a></li>
<li class="chapter" data-level="10.6.3" data-path="clustering.html"><a href="clustering.html#cluster-bootstrapping"><i class="fa fa-check"></i><b>10.6.3</b> Evaluating cluster stability</a></li>
</ul></li>
<li class="chapter" data-level="10.7" data-path="clustering.html"><a href="clustering.html#subclustering"><i class="fa fa-check"></i><b>10.7</b> Subclustering</a></li>
<li class="chapter" data-level="" data-path="overview.html"><a href="overview.html#session-info"><i class="fa fa-check"></i>Session Info</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="marker-detection.html"><a href="marker-detection.html"><i class="fa fa-check"></i><b>11</b> Marker gene detection</a>
<ul>
<li class="chapter" data-level="11.1" data-path="normalization.html"><a href="normalization.html#motivation"><i class="fa fa-check"></i><b>11.1</b> Motivation</a></li>
<li class="chapter" data-level="11.2" data-path="marker-detection.html"><a href="marker-detection.html#pairwise-tests-between-clusters"><i class="fa fa-check"></i><b>11.2</b> Pairwise tests between clusters</a>
<ul>
<li class="chapter" data-level="11.2.1" data-path="dimensionality-reduction.html"><a href="dimensionality-reduction.html#motivation-1"><i class="fa fa-check"></i><b>11.2.1</b> Motivation</a></li>
<li class="chapter" data-level="11.2.2" data-path="marker-detection.html"><a href="marker-detection.html#combining-pairwise-statistics-per-cluster"><i class="fa fa-check"></i><b>11.2.2</b> Combining pairwise statistics per cluster</a></li>
<li class="chapter" data-level="11.2.3" data-path="marker-detection.html"><a href="marker-detection.html#using-the-log-fold-change"><i class="fa fa-check"></i><b>11.2.3</b> Using the log-fold change</a></li>
</ul></li>
<li class="chapter" data-level="11.3" data-path="marker-detection.html"><a href="marker-detection.html#marker-tests"><i class="fa fa-check"></i><b>11.3</b> Alternative testing regimes</a>
<ul>
<li class="chapter" data-level="11.3.1" data-path="marker-detection.html"><a href="marker-detection.html#using-the-wilcoxon-rank-sum-test"><i class="fa fa-check"></i><b>11.3.1</b> Using the Wilcoxon rank sum test</a></li>
<li class="chapter" data-level="11.3.2" data-path="marker-detection.html"><a href="marker-detection.html#using-a-binomial-test"><i class="fa fa-check"></i><b>11.3.2</b> Using a binomial test</a></li>
<li class="chapter" data-level="11.3.3" data-path="marker-detection.html"><a href="marker-detection.html#using-custom-de-methods"><i class="fa fa-check"></i><b>11.3.3</b> Using custom DE methods</a></li>
<li class="chapter" data-level="11.3.4" data-path="marker-detection.html"><a href="marker-detection.html#combining-multiple-marker-statistics"><i class="fa fa-check"></i><b>11.3.4</b> Combining multiple marker statistics</a></li>
</ul></li>
<li class="chapter" data-level="11.4" data-path="marker-detection.html"><a href="marker-detection.html#marker-batch"><i class="fa fa-check"></i><b>11.4</b> Handling blocking factors</a>
<ul>
<li class="chapter" data-level="11.4.1" data-path="marker-detection.html"><a href="marker-detection.html#using-the-block-argument"><i class="fa fa-check"></i><b>11.4.1</b> Using the <code>block=</code> argument</a></li>
<li class="chapter" data-level="11.4.2" data-path="marker-detection.html"><a href="marker-detection.html#using-the-design-argument"><i class="fa fa-check"></i><b>11.4.2</b> Using the <code>design=</code> argument</a></li>
</ul></li>
<li class="chapter" data-level="11.5" data-path="marker-detection.html"><a href="marker-detection.html#p-value-invalidity"><i class="fa fa-check"></i><b>11.5</b> Invalidity of <span class="math inline">\(p\)</span>-values</a>
<ul>
<li class="chapter" data-level="11.5.1" data-path="marker-detection.html"><a href="marker-detection.html#from-data-snooping"><i class="fa fa-check"></i><b>11.5.1</b> From data snooping</a></li>
<li class="chapter" data-level="11.5.2" data-path="marker-detection.html"><a href="marker-detection.html#false-replicates"><i class="fa fa-check"></i><b>11.5.2</b> Nature of replication</a></li>
</ul></li>
<li class="chapter" data-level="11.6" data-path="marker-detection.html"><a href="marker-detection.html#further-comments"><i class="fa fa-check"></i><b>11.6</b> Further comments</a></li>
<li class="chapter" data-level="" data-path="overview.html"><a href="overview.html#session-info"><i class="fa fa-check"></i>Session Info</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="cell-type-annotation.html"><a href="cell-type-annotation.html"><i class="fa fa-check"></i><b>12</b> Cell type annotation</a>
<ul>
<li class="chapter" data-level="12.1" data-path="normalization.html"><a href="normalization.html#motivation"><i class="fa fa-check"></i><b>12.1</b> Motivation</a></li>
<li class="chapter" data-level="12.2" data-path="cell-type-annotation.html"><a href="cell-type-annotation.html#assigning-cell-labels-from-reference-data"><i class="fa fa-check"></i><b>12.2</b> Assigning cell labels from reference data</a>
<ul>
<li class="chapter" data-level="12.2.1" data-path="overview.html"><a href="overview.html#overview"><i class="fa fa-check"></i><b>12.2.1</b> Overview</a></li>
<li class="chapter" data-level="12.2.2" data-path="cell-type-annotation.html"><a href="cell-type-annotation.html#using-existing-references"><i class="fa fa-check"></i><b>12.2.2</b> Using existing references</a></li>
<li class="chapter" data-level="12.2.3" data-path="cell-type-annotation.html"><a href="cell-type-annotation.html#using-custom-references"><i class="fa fa-check"></i><b>12.2.3</b> Using custom references</a></li>
</ul></li>
<li class="chapter" data-level="12.3" data-path="cell-type-annotation.html"><a href="cell-type-annotation.html#assigning-cell-labels-from-gene-sets"><i class="fa fa-check"></i><b>12.3</b> Assigning cell labels from gene sets</a></li>
<li class="chapter" data-level="12.4" data-path="cell-type-annotation.html"><a href="cell-type-annotation.html#assigning-cluster-labels-from-markers"><i class="fa fa-check"></i><b>12.4</b> Assigning cluster labels from markers</a></li>
<li class="chapter" data-level="12.5" data-path="cell-type-annotation.html"><a href="cell-type-annotation.html#computing-gene-set-activities"><i class="fa fa-check"></i><b>12.5</b> Computing gene set activities</a></li>
<li class="chapter" data-level="" data-path="overview.html"><a href="overview.html#session-info"><i class="fa fa-check"></i>Session Info</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="integrating-datasets.html"><a href="integrating-datasets.html"><i class="fa fa-check"></i><b>13</b> Integrating Datasets</a>
<ul>
<li class="chapter" data-level="13.1" data-path="normalization.html"><a href="normalization.html#motivation"><i class="fa fa-check"></i><b>13.1</b> Motivation</a></li>
<li class="chapter" data-level="13.2" data-path="integrating-datasets.html"><a href="integrating-datasets.html#setting-up-the-data"><i class="fa fa-check"></i><b>13.2</b> Setting up the data</a></li>
<li class="chapter" data-level="13.3" data-path="integrating-datasets.html"><a href="integrating-datasets.html#batch-diagnosis"><i class="fa fa-check"></i><b>13.3</b> Diagnosing batch effects</a></li>
<li class="chapter" data-level="13.4" data-path="integrating-datasets.html"><a href="integrating-datasets.html#linear-regression"><i class="fa fa-check"></i><b>13.4</b> Linear regression</a></li>
<li class="chapter" data-level="13.5" data-path="integrating-datasets.html"><a href="integrating-datasets.html#performing-mnn-correction"><i class="fa fa-check"></i><b>13.5</b> Performing MNN correction</a>
<ul>
<li class="chapter" data-level="13.5.1" data-path="integrating-datasets.html"><a href="integrating-datasets.html#algorithm-overview"><i class="fa fa-check"></i><b>13.5.1</b> Algorithm overview</a></li>
<li class="chapter" data-level="13.5.2" data-path="integrating-datasets.html"><a href="integrating-datasets.html#application-to-the-pbmc-data"><i class="fa fa-check"></i><b>13.5.2</b> Application to the PBMC data</a></li>
<li class="chapter" data-level="13.5.3" data-path="integrating-datasets.html"><a href="integrating-datasets.html#correction-diagnostics"><i class="fa fa-check"></i><b>13.5.3</b> Correction diagnostics</a></li>
</ul></li>
<li class="chapter" data-level="13.6" data-path="integrating-datasets.html"><a href="integrating-datasets.html#preserving-biological-heterogeneity"><i class="fa fa-check"></i><b>13.6</b> Preserving biological heterogeneity</a>
<ul>
<li class="chapter" data-level="13.6.1" data-path="integrating-datasets.html"><a href="integrating-datasets.html#comparison-to-within-batch-clusters"><i class="fa fa-check"></i><b>13.6.1</b> Comparison to within-batch clusters</a></li>
<li class="chapter" data-level="13.6.2" data-path="integrating-datasets.html"><a href="integrating-datasets.html#integration-with-markers"><i class="fa fa-check"></i><b>13.6.2</b> Encouraging consistency with marker genes</a></li>
</ul></li>
<li class="chapter" data-level="13.7" data-path="integrating-datasets.html"><a href="integrating-datasets.html#using-corrected-values"><i class="fa fa-check"></i><b>13.7</b> Using the corrected values</a></li>
<li class="chapter" data-level="" data-path="overview.html"><a href="overview.html#session-info"><i class="fa fa-check"></i>Session Info</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="multi-sample-comparisons.html"><a href="multi-sample-comparisons.html"><i class="fa fa-check"></i><b>14</b> Multi-sample comparisons</a>
<ul>
<li class="chapter" data-level="14.1" data-path="normalization.html"><a href="normalization.html#motivation"><i class="fa fa-check"></i><b>14.1</b> Motivation</a></li>
<li class="chapter" data-level="14.2" data-path="integrating-datasets.html"><a href="integrating-datasets.html#setting-up-the-data"><i class="fa fa-check"></i><b>14.2</b> Setting up the data</a></li>
<li class="chapter" data-level="14.3" data-path="multi-sample-comparisons.html"><a href="multi-sample-comparisons.html#differential-expression-between-conditions"><i class="fa fa-check"></i><b>14.3</b> Differential expression between conditions</a>
<ul>
<li class="chapter" data-level="14.3.1" data-path="multi-sample-comparisons.html"><a href="multi-sample-comparisons.html#creating-pseudo-bulk-samples"><i class="fa fa-check"></i><b>14.3.1</b> Creating pseudo-bulk samples</a></li>
<li class="chapter" data-level="14.3.2" data-path="multi-sample-comparisons.html"><a href="multi-sample-comparisons.html#performing-the-de-analysis"><i class="fa fa-check"></i><b>14.3.2</b> Performing the DE analysis</a></li>
<li class="chapter" data-level="14.3.3" data-path="multi-sample-comparisons.html"><a href="multi-sample-comparisons.html#putting-it-all-together"><i class="fa fa-check"></i><b>14.3.3</b> Putting it all together</a></li>
</ul></li>
<li class="chapter" data-level="14.4" data-path="multi-sample-comparisons.html"><a href="multi-sample-comparisons.html#ambient-problems"><i class="fa fa-check"></i><b>14.4</b> Avoiding problems with ambient RNA</a>
<ul>
<li class="chapter" data-level="14.4.1" data-path="dimensionality-reduction.html"><a href="dimensionality-reduction.html#motivation-1"><i class="fa fa-check"></i><b>14.4.1</b> Motivation</a></li>
<li class="chapter" data-level="14.4.2" data-path="multi-sample-comparisons.html"><a href="multi-sample-comparisons.html#finding-affected-degs"><i class="fa fa-check"></i><b>14.4.2</b> Finding affected DEGs</a></li>
<li class="chapter" data-level="14.4.3" data-path="multi-sample-comparisons.html"><a href="multi-sample-comparisons.html#subtracting-ambient-counts"><i class="fa fa-check"></i><b>14.4.3</b> Subtracting ambient counts</a></li>
</ul></li>
<li class="chapter" data-level="14.5" data-path="multi-sample-comparisons.html"><a href="multi-sample-comparisons.html#differential-abundance"><i class="fa fa-check"></i><b>14.5</b> Differential abundance between conditions</a>
<ul>
<li class="chapter" data-level="14.5.1" data-path="overview.html"><a href="overview.html#overview"><i class="fa fa-check"></i><b>14.5.1</b> Overview</a></li>
<li class="chapter" data-level="14.5.2" data-path="multi-sample-comparisons.html"><a href="multi-sample-comparisons.html#performing-the-da-analysis"><i class="fa fa-check"></i><b>14.5.2</b> Performing the DA analysis</a></li>
<li class="chapter" data-level="14.5.3" data-path="multi-sample-comparisons.html"><a href="multi-sample-comparisons.html#composition-effects"><i class="fa fa-check"></i><b>14.5.3</b> Handling composition effects</a></li>
</ul></li>
<li class="chapter" data-level="14.6" data-path="multi-sample-comparisons.html"><a href="multi-sample-comparisons.html#comments-on-interpretation"><i class="fa fa-check"></i><b>14.6</b> Comments on interpretation</a>
<ul>
<li class="chapter" data-level="14.6.1" data-path="multi-sample-comparisons.html"><a href="multi-sample-comparisons.html#de-da-duality"><i class="fa fa-check"></i><b>14.6.1</b> DE or DA? Two sides of the same coin</a></li>
<li class="chapter" data-level="14.6.2" data-path="multi-sample-comparisons.html"><a href="multi-sample-comparisons.html#sacrificing-differences"><i class="fa fa-check"></i><b>14.6.2</b> Sacrificing biology by integration</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="overview.html"><a href="overview.html#session-info"><i class="fa fa-check"></i>Session Info</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="droplet-processing.html"><a href="droplet-processing.html"><i class="fa fa-check"></i><b>15</b> Droplet processing</a>
<ul>
<li class="chapter" data-level="15.1" data-path="normalization.html"><a href="normalization.html#motivation"><i class="fa fa-check"></i><b>15.1</b> Motivation</a></li>
<li class="chapter" data-level="15.2" data-path="droplet-processing.html"><a href="droplet-processing.html#qc-droplets"><i class="fa fa-check"></i><b>15.2</b> Calling cells from empty droplets</a>
<ul>
<li class="chapter" data-level="15.2.1" data-path="data-infrastructure.html"><a href="data-infrastructure.html#background"><i class="fa fa-check"></i><b>15.2.1</b> Background</a></li>
<li class="chapter" data-level="15.2.2" data-path="droplet-processing.html"><a href="droplet-processing.html#testing-for-empty-droplets"><i class="fa fa-check"></i><b>15.2.2</b> Testing for empty droplets</a></li>
<li class="chapter" data-level="15.2.3" data-path="droplet-processing.html"><a href="droplet-processing.html#relationship-with-other-qc-metrics"><i class="fa fa-check"></i><b>15.2.3</b> Relationship with other QC metrics</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="overview.html"><a href="overview.html#session-info"><i class="fa fa-check"></i>Session Info</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="doublet-detection.html"><a href="doublet-detection.html"><i class="fa fa-check"></i><b>16</b> Doublet detection</a>
<ul>
<li class="chapter" data-level="16.1" data-path="overview.html"><a href="overview.html#overview"><i class="fa fa-check"></i><b>16.1</b> Overview</a></li>
<li class="chapter" data-level="16.2" data-path="doublet-detection.html"><a href="doublet-detection.html#doublet-detection-with-clusters"><i class="fa fa-check"></i><b>16.2</b> Doublet detection with clusters</a></li>
<li class="chapter" data-level="16.3" data-path="doublet-detection.html"><a href="doublet-detection.html#doublet-simulation"><i class="fa fa-check"></i><b>16.3</b> Doublet detection by simulation</a></li>
<li class="chapter" data-level="16.4" data-path="doublet-detection.html"><a href="doublet-detection.html#doublet-detection-in-multiplexed-experiments"><i class="fa fa-check"></i><b>16.4</b> Doublet detection in multiplexed experiments</a>
<ul>
<li class="chapter" data-level="16.4.1" data-path="data-infrastructure.html"><a href="data-infrastructure.html#background"><i class="fa fa-check"></i><b>16.4.1</b> Background</a></li>
<li class="chapter" data-level="16.4.2" data-path="doublet-detection.html"><a href="doublet-detection.html#identifying-inter-sample-doublets"><i class="fa fa-check"></i><b>16.4.2</b> Identifying inter-sample doublets</a></li>
<li class="chapter" data-level="16.4.3" data-path="doublet-detection.html"><a href="doublet-detection.html#guilt-by-association-for-unmarked-doublets"><i class="fa fa-check"></i><b>16.4.3</b> Guilt by association for unmarked doublets</a></li>
</ul></li>
<li class="chapter" data-level="16.5" data-path="marker-detection.html"><a href="marker-detection.html#further-comments"><i class="fa fa-check"></i><b>16.5</b> Further comments</a></li>
<li class="chapter" data-level="" data-path="overview.html"><a href="overview.html#session-info"><i class="fa fa-check"></i>Session Info</a></li>
</ul></li>
<li class="chapter" data-level="17" data-path="cell-cycle-assignment.html"><a href="cell-cycle-assignment.html"><i class="fa fa-check"></i><b>17</b> Cell cycle assignment</a>
<ul>
<li class="chapter" data-level="17.1" data-path="normalization.html"><a href="normalization.html#motivation"><i class="fa fa-check"></i><b>17.1</b> Motivation</a></li>
<li class="chapter" data-level="17.2" data-path="cell-cycle-assignment.html"><a href="cell-cycle-assignment.html#using-the-cyclins"><i class="fa fa-check"></i><b>17.2</b> Using the cyclins</a></li>
<li class="chapter" data-level="17.3" data-path="cell-cycle-assignment.html"><a href="cell-cycle-assignment.html#using-reference-profiles"><i class="fa fa-check"></i><b>17.3</b> Using reference profiles</a></li>
<li class="chapter" data-level="17.4" data-path="cell-cycle-assignment.html"><a href="cell-cycle-assignment.html#using-the-cyclone-classifier"><i class="fa fa-check"></i><b>17.4</b> Using the <code>cyclone()</code> classifier</a></li>
<li class="chapter" data-level="17.5" data-path="cell-cycle-assignment.html"><a href="cell-cycle-assignment.html#removing-cell-cycle-effects"><i class="fa fa-check"></i><b>17.5</b> Removing cell cycle effects</a>
<ul>
<li class="chapter" data-level="17.5.1" data-path="cell-cycle-assignment.html"><a href="cell-cycle-assignment.html#comments"><i class="fa fa-check"></i><b>17.5.1</b> Comments</a></li>
<li class="chapter" data-level="17.5.2" data-path="cell-cycle-assignment.html"><a href="cell-cycle-assignment.html#with-linear-regression-and-friends"><i class="fa fa-check"></i><b>17.5.2</b> With linear regression and friends</a></li>
<li class="chapter" data-level="17.5.3" data-path="cell-cycle-assignment.html"><a href="cell-cycle-assignment.html#removing-cell-cycle-related-genes"><i class="fa fa-check"></i><b>17.5.3</b> Removing cell cycle-related genes</a></li>
<li class="chapter" data-level="17.5.4" data-path="cell-cycle-assignment.html"><a href="cell-cycle-assignment.html#using-contrastive-pca"><i class="fa fa-check"></i><b>17.5.4</b> Using contrastive PCA</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="overview.html"><a href="overview.html#session-info"><i class="fa fa-check"></i>Session Info</a></li>
</ul></li>
<li class="chapter" data-level="18" data-path="trajectory-analysis.html"><a href="trajectory-analysis.html"><i class="fa fa-check"></i><b>18</b> Trajectory Analysis</a>
<ul>
<li class="chapter" data-level="18.1" data-path="overview.html"><a href="overview.html#overview"><i class="fa fa-check"></i><b>18.1</b> Overview</a></li>
<li class="chapter" data-level="18.2" data-path="trajectory-analysis.html"><a href="trajectory-analysis.html#obtaining-pseudotime-orderings"><i class="fa fa-check"></i><b>18.2</b> Obtaining pseudotime orderings</a>
<ul>
<li class="chapter" data-level="18.2.1" data-path="trajectory-analysis.html"><a href="trajectory-analysis.html#overview-1"><i class="fa fa-check"></i><b>18.2.1</b> Overview</a></li>
<li class="chapter" data-level="18.2.2" data-path="trajectory-analysis.html"><a href="trajectory-analysis.html#cluster-based-minimum-spanning-tree"><i class="fa fa-check"></i><b>18.2.2</b> Cluster-based minimum spanning tree</a></li>
<li class="chapter" data-level="18.2.3" data-path="trajectory-analysis.html"><a href="trajectory-analysis.html#principal-curves"><i class="fa fa-check"></i><b>18.2.3</b> Principal curves</a></li>
</ul></li>
<li class="chapter" data-level="18.3" data-path="trajectory-analysis.html"><a href="trajectory-analysis.html#characterizing-trajectories"><i class="fa fa-check"></i><b>18.3</b> Characterizing trajectories</a>
<ul>
<li class="chapter" data-level="18.3.1" data-path="trajectory-analysis.html"><a href="trajectory-analysis.html#overview-2"><i class="fa fa-check"></i><b>18.3.1</b> Overview</a></li>
<li class="chapter" data-level="18.3.2" data-path="trajectory-analysis.html"><a href="trajectory-analysis.html#changes-along-a-trajectory"><i class="fa fa-check"></i><b>18.3.2</b> Changes along a trajectory</a></li>
<li class="chapter" data-level="18.3.3" data-path="trajectory-analysis.html"><a href="trajectory-analysis.html#changes-between-paths"><i class="fa fa-check"></i><b>18.3.3</b> Changes between paths</a></li>
<li class="chapter" data-level="18.3.4" data-path="marker-detection.html"><a href="marker-detection.html#further-comments"><i class="fa fa-check"></i><b>18.3.4</b> Further comments</a></li>
</ul></li>
<li class="chapter" data-level="18.4" data-path="trajectory-analysis.html"><a href="trajectory-analysis.html#finding-the-root"><i class="fa fa-check"></i><b>18.4</b> Finding the root</a>
<ul>
<li class="chapter" data-level="18.4.1" data-path="trajectory-analysis.html"><a href="trajectory-analysis.html#overview-3"><i class="fa fa-check"></i><b>18.4.1</b> Overview</a></li>
<li class="chapter" data-level="18.4.2" data-path="trajectory-analysis.html"><a href="trajectory-analysis.html#entropy-based-methods"><i class="fa fa-check"></i><b>18.4.2</b> Entropy-based methods</a></li>
<li class="chapter" data-level="18.4.3" data-path="trajectory-analysis.html"><a href="trajectory-analysis.html#rna-velocity"><i class="fa fa-check"></i><b>18.4.3</b> RNA velocity</a></li>
<li class="chapter" data-level="18.4.4" data-path="trajectory-analysis.html"><a href="trajectory-analysis.html#real-timepoints"><i class="fa fa-check"></i><b>18.4.4</b> Real timepoints</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="trajectory-analysis.html"><a href="trajectory-analysis.html#session-information"><i class="fa fa-check"></i>Session information</a></li>
</ul></li>
<li class="chapter" data-level="19" data-path="single-nuclei-rna-seq-processing.html"><a href="single-nuclei-rna-seq-processing.html"><i class="fa fa-check"></i><b>19</b> Single-nuclei RNA-seq processing</a>
<ul>
<li class="chapter" data-level="19.1" data-path="introduction.html"><a href="introduction.html#introduction"><i class="fa fa-check"></i><b>19.1</b> Introduction</a></li>
<li class="chapter" data-level="19.2" data-path="single-nuclei-rna-seq-processing.html"><a href="single-nuclei-rna-seq-processing.html#quality-control-for-stripped-nuclei"><i class="fa fa-check"></i><b>19.2</b> Quality control for stripped nuclei</a></li>
<li class="chapter" data-level="19.3" data-path="single-nuclei-rna-seq-processing.html"><a href="single-nuclei-rna-seq-processing.html#comments-on-downstream-analyses"><i class="fa fa-check"></i><b>19.3</b> Comments on downstream analyses</a></li>
<li class="chapter" data-level="19.4" data-path="single-nuclei-rna-seq-processing.html"><a href="single-nuclei-rna-seq-processing.html#tricks-with-ambient-contamination"><i class="fa fa-check"></i><b>19.4</b> Tricks with ambient contamination</a></li>
<li class="chapter" data-level="" data-path="overview.html"><a href="overview.html#session-info"><i class="fa fa-check"></i>Session Info</a></li>
</ul></li>
<li class="chapter" data-level="20" data-path="integrating-with-protein-abundance.html"><a href="integrating-with-protein-abundance.html"><i class="fa fa-check"></i><b>20</b> Integrating with protein abundance</a>
<ul>
<li class="chapter" data-level="20.1" data-path="normalization.html"><a href="normalization.html#motivation"><i class="fa fa-check"></i><b>20.1</b> Motivation</a></li>
<li class="chapter" data-level="20.2" data-path="integrating-with-protein-abundance.html"><a href="integrating-with-protein-abundance.html#preprocessing"><i class="fa fa-check"></i><b>20.2</b> Preprocessing</a>
<ul>
<li class="chapter" data-level="20.2.1" data-path="integrating-datasets.html"><a href="integrating-datasets.html#setting-up-the-data"><i class="fa fa-check"></i><b>20.2.1</b> Setting up the data</a></li>
<li class="chapter" data-level="20.2.2" data-path="quality-control.html"><a href="quality-control.html#quality-control"><i class="fa fa-check"></i><b>20.2.2</b> Quality control</a></li>
<li class="chapter" data-level="20.2.3" data-path="normalization.html"><a href="normalization.html#normalization"><i class="fa fa-check"></i><b>20.2.3</b> Normalization</a></li>
</ul></li>
<li class="chapter" data-level="20.3" data-path="integrating-with-protein-abundance.html"><a href="integrating-with-protein-abundance.html#clustering-and-interpretation"><i class="fa fa-check"></i><b>20.3</b> Clustering and interpretation</a></li>
<li class="chapter" data-level="20.4" data-path="integrating-with-protein-abundance.html"><a href="integrating-with-protein-abundance.html#integration-with-gene-expression-data"><i class="fa fa-check"></i><b>20.4</b> Integration with gene expression data</a>
<ul>
<li class="chapter" data-level="20.4.1" data-path="integrating-with-protein-abundance.html"><a href="integrating-with-protein-abundance.html#by-subclustering"><i class="fa fa-check"></i><b>20.4.1</b> By subclustering</a></li>
<li class="chapter" data-level="20.4.2" data-path="integrating-with-protein-abundance.html"><a href="integrating-with-protein-abundance.html#by-combined-clustering"><i class="fa fa-check"></i><b>20.4.2</b> By combined clustering</a></li>
<li class="chapter" data-level="20.4.3" data-path="integrating-with-protein-abundance.html"><a href="integrating-with-protein-abundance.html#by-differential-testing"><i class="fa fa-check"></i><b>20.4.3</b> By differential testing</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="overview.html"><a href="overview.html#session-info"><i class="fa fa-check"></i>Session Info</a></li>
</ul></li>
<li class="chapter" data-level="21" data-path="repertoire-seq.html"><a href="repertoire-seq.html"><i class="fa fa-check"></i><b>21</b> Analyzing repertoire sequencing data</a>
<ul>
<li class="chapter" data-level="21.1" data-path="normalization.html"><a href="normalization.html#motivation"><i class="fa fa-check"></i><b>21.1</b> Motivation</a></li>
<li class="chapter" data-level="21.2" data-path="repertoire-seq.html"><a href="repertoire-seq.html#loading-the-tcr-repertoire"><i class="fa fa-check"></i><b>21.2</b> Loading the TCR repertoire</a></li>
<li class="chapter" data-level="21.3" data-path="repertoire-seq.html"><a href="repertoire-seq.html#leveraging-list-semantics"><i class="fa fa-check"></i><b>21.3</b> Leveraging <code>List</code> semantics</a></li>
<li class="chapter" data-level="21.4" data-path="repertoire-seq.html"><a href="repertoire-seq.html#converting-back-to-dataframes"><i class="fa fa-check"></i><b>21.4</b> Converting back to <code>DataFrame</code>s</a></li>
<li class="chapter" data-level="21.5" data-path="repertoire-seq.html"><a href="repertoire-seq.html#case-study-for-clonotype-analyses"><i class="fa fa-check"></i><b>21.5</b> Case study for clonotype analyses</a></li>
<li class="chapter" data-level="21.6" data-path="repertoire-seq.html"><a href="repertoire-seq.html#repeating-for-immunoglobulins"><i class="fa fa-check"></i><b>21.6</b> Repeating for immunoglobulins</a></li>
<li class="chapter" data-level="" data-path="overview.html"><a href="overview.html#session-info"><i class="fa fa-check"></i>Session Info</a></li>
</ul></li>
<li class="chapter" data-level="22" data-path="interactive-sharing.html"><a href="interactive-sharing.html"><i class="fa fa-check"></i><b>22</b> Interactive data exploration</a>
<ul>
<li class="chapter" data-level="22.1" data-path="normalization.html"><a href="normalization.html#motivation"><i class="fa fa-check"></i><b>22.1</b> Motivation</a></li>
<li class="chapter" data-level="22.2" data-path="interactive-sharing.html"><a href="interactive-sharing.html#interactive-quickstart"><i class="fa fa-check"></i><b>22.2</b> Quick start</a></li>
<li class="chapter" data-level="22.3" data-path="interactive-sharing.html"><a href="interactive-sharing.html#isee-examples"><i class="fa fa-check"></i><b>22.3</b> Usage examples</a>
<ul>
<li class="chapter" data-level="22.3.1" data-path="quality-control.html"><a href="quality-control.html#quality-control"><i class="fa fa-check"></i><b>22.3.1</b> Quality control</a></li>
<li class="chapter" data-level="22.3.2" data-path="interactive-sharing.html"><a href="interactive-sharing.html#annotation-of-cell-populations"><i class="fa fa-check"></i><b>22.3.2</b> Annotation of cell populations</a></li>
<li class="chapter" data-level="22.3.3" data-path="interactive-sharing.html"><a href="interactive-sharing.html#querying-features-of-interest"><i class="fa fa-check"></i><b>22.3.3</b> Querying features of interest</a></li>
</ul></li>
<li class="chapter" data-level="22.4" data-path="interactive-sharing.html"><a href="interactive-sharing.html#reproducible-visualizations"><i class="fa fa-check"></i><b>22.4</b> Reproducible visualizations</a></li>
<li class="chapter" data-level="22.5" data-path="interactive-sharing.html"><a href="interactive-sharing.html#dissemination"><i class="fa fa-check"></i><b>22.5</b> Dissemination of analysis results</a></li>
<li class="chapter" data-level="22.6" data-path="interactive-sharing.html"><a href="interactive-sharing.html#additional-resources"><i class="fa fa-check"></i><b>22.6</b> Additional resources</a></li>
<li class="chapter" data-level="" data-path="overview.html"><a href="overview.html#session-info"><i class="fa fa-check"></i>Session Info</a></li>
</ul></li>
<li class="chapter" data-level="23" data-path="dealing-with-big-data.html"><a href="dealing-with-big-data.html"><i class="fa fa-check"></i><b>23</b> Dealing with big data</a>
<ul>
<li class="chapter" data-level="23.1" data-path="normalization.html"><a href="normalization.html#motivation"><i class="fa fa-check"></i><b>23.1</b> Motivation</a></li>
<li class="chapter" data-level="23.2" data-path="dealing-with-big-data.html"><a href="dealing-with-big-data.html#fast-approximations"><i class="fa fa-check"></i><b>23.2</b> Fast approximations</a>
<ul>
<li class="chapter" data-level="23.2.1" data-path="dealing-with-big-data.html"><a href="dealing-with-big-data.html#nearest-neighbor-searching"><i class="fa fa-check"></i><b>23.2.1</b> Nearest neighbor searching</a></li>
<li class="chapter" data-level="23.2.2" data-path="dealing-with-big-data.html"><a href="dealing-with-big-data.html#big-data-svd"><i class="fa fa-check"></i><b>23.2.2</b> Singular value decomposition</a></li>
</ul></li>
<li class="chapter" data-level="23.3" data-path="dealing-with-big-data.html"><a href="dealing-with-big-data.html#parallelization"><i class="fa fa-check"></i><b>23.3</b> Parallelization</a></li>
<li class="chapter" data-level="23.4" data-path="dealing-with-big-data.html"><a href="dealing-with-big-data.html#out-of-memory-representations"><i class="fa fa-check"></i><b>23.4</b> Out of memory representations</a></li>
<li class="chapter" data-level="" data-path="overview.html"><a href="overview.html#session-info"><i class="fa fa-check"></i>Session Info</a></li>
</ul></li>
<li class="chapter" data-level="24" data-path="interoperability.html"><a href="interoperability.html"><i class="fa fa-check"></i><b>24</b> Interoperability</a>
<ul>
<li class="chapter" data-level="24.1" data-path="normalization.html"><a href="normalization.html#motivation"><i class="fa fa-check"></i><b>24.1</b> Motivation</a></li>
<li class="chapter" data-level="24.2" data-path="interoperability.html"><a href="interoperability.html#interchanging-with-seurat"><i class="fa fa-check"></i><b>24.2</b> Interchanging with <em>Seurat</em></a></li>
<li class="chapter" data-level="24.3" data-path="interoperability.html"><a href="interoperability.html#interchanging-with-scanpy"><i class="fa fa-check"></i><b>24.3</b> Interchanging with <em>scanpy</em></a></li>
<li class="chapter" data-level="" data-path="overview.html"><a href="overview.html#session-info"><i class="fa fa-check"></i>Session Info</a></li>
</ul></li>
<li class="part"><span><b>III Workflows</b></span></li>
<li class="chapter" data-level="25" data-path="lun-416b-cell-line-smart-seq2.html"><a href="lun-416b-cell-line-smart-seq2.html"><i class="fa fa-check"></i><b>25</b> Lun 416B cell line (Smart-seq2)</a>
<ul>
<li class="chapter" data-level="25.1" data-path="introduction.html"><a href="introduction.html#introduction"><i class="fa fa-check"></i><b>25.1</b> Introduction</a></li>
<li class="chapter" data-level="25.2" data-path="lun-416b-cell-line-smart-seq2.html"><a href="lun-416b-cell-line-smart-seq2.html#data-loading"><i class="fa fa-check"></i><b>25.2</b> Data loading</a></li>
<li class="chapter" data-level="25.3" data-path="quality-control.html"><a href="quality-control.html#quality-control"><i class="fa fa-check"></i><b>25.3</b> Quality control</a></li>
<li class="chapter" data-level="25.4" data-path="normalization.html"><a href="normalization.html#normalization"><i class="fa fa-check"></i><b>25.4</b> Normalization</a></li>
<li class="chapter" data-level="25.5" data-path="lun-416b-cell-line-smart-seq2.html"><a href="lun-416b-cell-line-smart-seq2.html#variance-modelling"><i class="fa fa-check"></i><b>25.5</b> Variance modelling</a></li>
<li class="chapter" data-level="25.6" data-path="lun-416b-cell-line-smart-seq2.html"><a href="lun-416b-cell-line-smart-seq2.html#batch-correction"><i class="fa fa-check"></i><b>25.6</b> Batch correction</a></li>
<li class="chapter" data-level="25.7" data-path="dimensionality-reduction.html"><a href="dimensionality-reduction.html#dimensionality-reduction"><i class="fa fa-check"></i><b>25.7</b> Dimensionality reduction</a></li>
<li class="chapter" data-level="25.8" data-path="clustering.html"><a href="clustering.html#clustering"><i class="fa fa-check"></i><b>25.8</b> Clustering</a></li>
<li class="chapter" data-level="25.9" data-path="lun-416b-cell-line-smart-seq2.html"><a href="lun-416b-cell-line-smart-seq2.html#interpretation"><i class="fa fa-check"></i><b>25.9</b> Interpretation</a></li>
<li class="chapter" data-level="" data-path="overview.html"><a href="overview.html#session-info"><i class="fa fa-check"></i>Session Info</a></li>
</ul></li>
<li class="chapter" data-level="26" data-path="zeisel-mouse-brain-strt-seq.html"><a href="zeisel-mouse-brain-strt-seq.html"><i class="fa fa-check"></i><b>26</b> Zeisel mouse brain (STRT-Seq)</a>
<ul>
<li class="chapter" data-level="26.1" data-path="introduction.html"><a href="introduction.html#introduction"><i class="fa fa-check"></i><b>26.1</b> Introduction</a></li>
<li class="chapter" data-level="26.2" data-path="lun-416b-cell-line-smart-seq2.html"><a href="lun-416b-cell-line-smart-seq2.html#data-loading"><i class="fa fa-check"></i><b>26.2</b> Data loading</a></li>
<li class="chapter" data-level="26.3" data-path="quality-control.html"><a href="quality-control.html#quality-control"><i class="fa fa-check"></i><b>26.3</b> Quality control</a></li>
<li class="chapter" data-level="26.4" data-path="normalization.html"><a href="normalization.html#normalization"><i class="fa fa-check"></i><b>26.4</b> Normalization</a></li>
<li class="chapter" data-level="26.5" data-path="lun-416b-cell-line-smart-seq2.html"><a href="lun-416b-cell-line-smart-seq2.html#variance-modelling"><i class="fa fa-check"></i><b>26.5</b> Variance modelling</a></li>
<li class="chapter" data-level="26.6" data-path="dimensionality-reduction.html"><a href="dimensionality-reduction.html#dimensionality-reduction"><i class="fa fa-check"></i><b>26.6</b> Dimensionality reduction</a></li>
<li class="chapter" data-level="26.7" data-path="clustering.html"><a href="clustering.html#clustering"><i class="fa fa-check"></i><b>26.7</b> Clustering</a></li>
<li class="chapter" data-level="26.8" data-path="lun-416b-cell-line-smart-seq2.html"><a href="lun-416b-cell-line-smart-seq2.html#interpretation"><i class="fa fa-check"></i><b>26.8</b> Interpretation</a></li>
<li class="chapter" data-level="" data-path="overview.html"><a href="overview.html#session-info"><i class="fa fa-check"></i>Session Info</a></li>
</ul></li>
<li class="chapter" data-level="27" data-path="unfiltered-human-pbmcs-10x-genomics.html"><a href="unfiltered-human-pbmcs-10x-genomics.html"><i class="fa fa-check"></i><b>27</b> Unfiltered human PBMCs (10X Genomics)</a>
<ul>
<li class="chapter" data-level="27.1" data-path="introduction.html"><a href="introduction.html#introduction"><i class="fa fa-check"></i><b>27.1</b> Introduction</a></li>
<li class="chapter" data-level="27.2" data-path="lun-416b-cell-line-smart-seq2.html"><a href="lun-416b-cell-line-smart-seq2.html#data-loading"><i class="fa fa-check"></i><b>27.2</b> Data loading</a></li>
<li class="chapter" data-level="27.3" data-path="quality-control.html"><a href="quality-control.html#quality-control"><i class="fa fa-check"></i><b>27.3</b> Quality control</a></li>
<li class="chapter" data-level="27.4" data-path="normalization.html"><a href="normalization.html#normalization"><i class="fa fa-check"></i><b>27.4</b> Normalization</a></li>
<li class="chapter" data-level="27.5" data-path="lun-416b-cell-line-smart-seq2.html"><a href="lun-416b-cell-line-smart-seq2.html#variance-modelling"><i class="fa fa-check"></i><b>27.5</b> Variance modelling</a></li>
<li class="chapter" data-level="27.6" data-path="dimensionality-reduction.html"><a href="dimensionality-reduction.html#dimensionality-reduction"><i class="fa fa-check"></i><b>27.6</b> Dimensionality reduction</a></li>
<li class="chapter" data-level="27.7" data-path="clustering.html"><a href="clustering.html#clustering"><i class="fa fa-check"></i><b>27.7</b> Clustering</a></li>
<li class="chapter" data-level="27.8" data-path="lun-416b-cell-line-smart-seq2.html"><a href="lun-416b-cell-line-smart-seq2.html#interpretation"><i class="fa fa-check"></i><b>27.8</b> Interpretation</a></li>
<li class="chapter" data-level="" data-path="overview.html"><a href="overview.html#session-info"><i class="fa fa-check"></i>Session Info</a></li>
</ul></li>
<li class="chapter" data-level="28" data-path="filtered-human-pbmcs-10x-genomics.html"><a href="filtered-human-pbmcs-10x-genomics.html"><i class="fa fa-check"></i><b>28</b> Filtered human PBMCs (10X Genomics)</a>
<ul>
<li class="chapter" data-level="28.1" data-path="introduction.html"><a href="introduction.html#introduction"><i class="fa fa-check"></i><b>28.1</b> Introduction</a></li>
<li class="chapter" data-level="28.2" data-path="lun-416b-cell-line-smart-seq2.html"><a href="lun-416b-cell-line-smart-seq2.html#data-loading"><i class="fa fa-check"></i><b>28.2</b> Data loading</a></li>
<li class="chapter" data-level="28.3" data-path="quality-control.html"><a href="quality-control.html#quality-control"><i class="fa fa-check"></i><b>28.3</b> Quality control</a></li>
<li class="chapter" data-level="28.4" data-path="normalization.html"><a href="normalization.html#normalization"><i class="fa fa-check"></i><b>28.4</b> Normalization</a></li>
<li class="chapter" data-level="28.5" data-path="lun-416b-cell-line-smart-seq2.html"><a href="lun-416b-cell-line-smart-seq2.html#variance-modelling"><i class="fa fa-check"></i><b>28.5</b> Variance modelling</a></li>
<li class="chapter" data-level="28.6" data-path="dimensionality-reduction.html"><a href="dimensionality-reduction.html#dimensionality-reduction"><i class="fa fa-check"></i><b>28.6</b> Dimensionality reduction</a></li>
<li class="chapter" data-level="28.7" data-path="clustering.html"><a href="clustering.html#clustering"><i class="fa fa-check"></i><b>28.7</b> Clustering</a></li>
<li class="chapter" data-level="28.8" data-path="filtered-human-pbmcs-10x-genomics.html"><a href="filtered-human-pbmcs-10x-genomics.html#data-integration"><i class="fa fa-check"></i><b>28.8</b> Data integration</a></li>
<li class="chapter" data-level="" data-path="overview.html"><a href="overview.html#session-info"><i class="fa fa-check"></i>Session Info</a></li>
</ul></li>
<li class="chapter" data-level="29" data-path="human-pbmc-with-surface-proteins-10x-genomics.html"><a href="human-pbmc-with-surface-proteins-10x-genomics.html"><i class="fa fa-check"></i><b>29</b> Human PBMC with surface proteins (10X Genomics)</a>
<ul>
<li class="chapter" data-level="29.1" data-path="introduction.html"><a href="introduction.html#introduction"><i class="fa fa-check"></i><b>29.1</b> Introduction</a></li>
<li class="chapter" data-level="29.2" data-path="lun-416b-cell-line-smart-seq2.html"><a href="lun-416b-cell-line-smart-seq2.html#data-loading"><i class="fa fa-check"></i><b>29.2</b> Data loading</a></li>
<li class="chapter" data-level="29.3" data-path="quality-control.html"><a href="quality-control.html#quality-control"><i class="fa fa-check"></i><b>29.3</b> Quality control</a></li>
<li class="chapter" data-level="29.4" data-path="normalization.html"><a href="normalization.html#normalization"><i class="fa fa-check"></i><b>29.4</b> Normalization</a></li>
<li class="chapter" data-level="29.5" data-path="dimensionality-reduction.html"><a href="dimensionality-reduction.html#dimensionality-reduction"><i class="fa fa-check"></i><b>29.5</b> Dimensionality reduction</a></li>
<li class="chapter" data-level="29.6" data-path="clustering.html"><a href="clustering.html#clustering"><i class="fa fa-check"></i><b>29.6</b> Clustering</a></li>
<li class="chapter" data-level="" data-path="overview.html"><a href="overview.html#session-info"><i class="fa fa-check"></i>Session Info</a></li>
</ul></li>
<li class="chapter" data-level="30" data-path="grun-human-pancreas-cel-seq2.html"><a href="grun-human-pancreas-cel-seq2.html"><i class="fa fa-check"></i><b>30</b> Grun human pancreas (CEL-seq2)</a>
<ul>
<li class="chapter" data-level="30.1" data-path="introduction.html"><a href="introduction.html#introduction"><i class="fa fa-check"></i><b>30.1</b> Introduction</a></li>
<li class="chapter" data-level="30.2" data-path="lun-416b-cell-line-smart-seq2.html"><a href="lun-416b-cell-line-smart-seq2.html#data-loading"><i class="fa fa-check"></i><b>30.2</b> Data loading</a></li>
<li class="chapter" data-level="30.3" data-path="quality-control.html"><a href="quality-control.html#quality-control"><i class="fa fa-check"></i><b>30.3</b> Quality control</a></li>
<li class="chapter" data-level="30.4" data-path="normalization.html"><a href="normalization.html#normalization"><i class="fa fa-check"></i><b>30.4</b> Normalization</a></li>
<li class="chapter" data-level="30.5" data-path="lun-416b-cell-line-smart-seq2.html"><a href="lun-416b-cell-line-smart-seq2.html#variance-modelling"><i class="fa fa-check"></i><b>30.5</b> Variance modelling</a></li>
<li class="chapter" data-level="30.6" data-path="filtered-human-pbmcs-10x-genomics.html"><a href="filtered-human-pbmcs-10x-genomics.html#data-integration"><i class="fa fa-check"></i><b>30.6</b> Data integration</a></li>
<li class="chapter" data-level="30.7" data-path="dimensionality-reduction.html"><a href="dimensionality-reduction.html#dimensionality-reduction"><i class="fa fa-check"></i><b>30.7</b> Dimensionality reduction</a></li>
<li class="chapter" data-level="30.8" data-path="clustering.html"><a href="clustering.html#clustering"><i class="fa fa-check"></i><b>30.8</b> Clustering</a></li>
<li class="chapter" data-level="" data-path="overview.html"><a href="overview.html#session-info"><i class="fa fa-check"></i>Session Info</a></li>
</ul></li>
<li class="chapter" data-level="31" data-path="muraro-human-pancreas-cel-seq.html"><a href="muraro-human-pancreas-cel-seq.html"><i class="fa fa-check"></i><b>31</b> Muraro human pancreas (CEL-seq)</a>
<ul>
<li class="chapter" data-level="31.1" data-path="introduction.html"><a href="introduction.html#introduction"><i class="fa fa-check"></i><b>31.1</b> Introduction</a></li>
<li class="chapter" data-level="31.2" data-path="lun-416b-cell-line-smart-seq2.html"><a href="lun-416b-cell-line-smart-seq2.html#data-loading"><i class="fa fa-check"></i><b>31.2</b> Data loading</a></li>
<li class="chapter" data-level="31.3" data-path="quality-control.html"><a href="quality-control.html#quality-control"><i class="fa fa-check"></i><b>31.3</b> Quality control</a></li>
<li class="chapter" data-level="31.4" data-path="normalization.html"><a href="normalization.html#normalization"><i class="fa fa-check"></i><b>31.4</b> Normalization</a></li>
<li class="chapter" data-level="31.5" data-path="lun-416b-cell-line-smart-seq2.html"><a href="lun-416b-cell-line-smart-seq2.html#variance-modelling"><i class="fa fa-check"></i><b>31.5</b> Variance modelling</a></li>
<li class="chapter" data-level="31.6" data-path="filtered-human-pbmcs-10x-genomics.html"><a href="filtered-human-pbmcs-10x-genomics.html#data-integration"><i class="fa fa-check"></i><b>31.6</b> Data integration</a></li>
<li class="chapter" data-level="31.7" data-path="dimensionality-reduction.html"><a href="dimensionality-reduction.html#dimensionality-reduction"><i class="fa fa-check"></i><b>31.7</b> Dimensionality reduction</a></li>
<li class="chapter" data-level="31.8" data-path="clustering.html"><a href="clustering.html#clustering"><i class="fa fa-check"></i><b>31.8</b> Clustering</a></li>
<li class="chapter" data-level="" data-path="overview.html"><a href="overview.html#session-info"><i class="fa fa-check"></i>Session Info</a></li>
</ul></li>
<li class="chapter" data-level="32" data-path="lawlor-human-pancreas-smarter.html"><a href="lawlor-human-pancreas-smarter.html"><i class="fa fa-check"></i><b>32</b> Lawlor human pancreas (SMARTer)</a>
<ul>
<li class="chapter" data-level="32.1" data-path="introduction.html"><a href="introduction.html#introduction"><i class="fa fa-check"></i><b>32.1</b> Introduction</a></li>
<li class="chapter" data-level="32.2" data-path="lun-416b-cell-line-smart-seq2.html"><a href="lun-416b-cell-line-smart-seq2.html#data-loading"><i class="fa fa-check"></i><b>32.2</b> Data loading</a></li>
<li class="chapter" data-level="32.3" data-path="quality-control.html"><a href="quality-control.html#quality-control"><i class="fa fa-check"></i><b>32.3</b> Quality control</a></li>
<li class="chapter" data-level="32.4" data-path="normalization.html"><a href="normalization.html#normalization"><i class="fa fa-check"></i><b>32.4</b> Normalization</a></li>
<li class="chapter" data-level="32.5" data-path="lun-416b-cell-line-smart-seq2.html"><a href="lun-416b-cell-line-smart-seq2.html#variance-modelling"><i class="fa fa-check"></i><b>32.5</b> Variance modelling</a></li>
<li class="chapter" data-level="32.6" data-path="dimensionality-reduction.html"><a href="dimensionality-reduction.html#dimensionality-reduction"><i class="fa fa-check"></i><b>32.6</b> Dimensionality reduction</a></li>
<li class="chapter" data-level="32.7" data-path="clustering.html"><a href="clustering.html#clustering"><i class="fa fa-check"></i><b>32.7</b> Clustering</a></li>
<li class="chapter" data-level="" data-path="overview.html"><a href="overview.html#session-info"><i class="fa fa-check"></i>Session Info</a></li>
</ul></li>
<li class="chapter" data-level="33" data-path="segerstolpe-human-pancreas-smart-seq2.html"><a href="segerstolpe-human-pancreas-smart-seq2.html"><i class="fa fa-check"></i><b>33</b> Segerstolpe human pancreas (Smart-seq2)</a>
<ul>
<li class="chapter" data-level="33.1" data-path="introduction.html"><a href="introduction.html#introduction"><i class="fa fa-check"></i><b>33.1</b> Introduction</a></li>
<li class="chapter" data-level="33.2" data-path="lun-416b-cell-line-smart-seq2.html"><a href="lun-416b-cell-line-smart-seq2.html#data-loading"><i class="fa fa-check"></i><b>33.2</b> Data loading</a></li>
<li class="chapter" data-level="33.3" data-path="quality-control.html"><a href="quality-control.html#quality-control"><i class="fa fa-check"></i><b>33.3</b> Quality control</a></li>
<li class="chapter" data-level="33.4" data-path="normalization.html"><a href="normalization.html#normalization"><i class="fa fa-check"></i><b>33.4</b> Normalization</a></li>
<li class="chapter" data-level="33.5" data-path="lun-416b-cell-line-smart-seq2.html"><a href="lun-416b-cell-line-smart-seq2.html#variance-modelling"><i class="fa fa-check"></i><b>33.5</b> Variance modelling</a></li>
<li class="chapter" data-level="33.6" data-path="dimensionality-reduction.html"><a href="dimensionality-reduction.html#dimensionality-reduction"><i class="fa fa-check"></i><b>33.6</b> Dimensionality reduction</a></li>
<li class="chapter" data-level="33.7" data-path="clustering.html"><a href="clustering.html#clustering"><i class="fa fa-check"></i><b>33.7</b> Clustering</a></li>
<li class="chapter" data-level="33.8" data-path="filtered-human-pbmcs-10x-genomics.html"><a href="filtered-human-pbmcs-10x-genomics.html#data-integration"><i class="fa fa-check"></i><b>33.8</b> Data integration</a></li>
<li class="chapter" data-level="33.9" data-path="segerstolpe-human-pancreas-smart-seq2.html"><a href="segerstolpe-human-pancreas-smart-seq2.html#segerstolpe-comparison"><i class="fa fa-check"></i><b>33.9</b> Multi-sample comparisons</a></li>
<li class="chapter" data-level="" data-path="overview.html"><a href="overview.html#session-info"><i class="fa fa-check"></i>Session Info</a></li>
</ul></li>
<li class="chapter" data-level="34" data-path="merged-pancreas.html"><a href="merged-pancreas.html"><i class="fa fa-check"></i><b>34</b> Merged human pancreas datasets</a>
<ul>
<li class="chapter" data-level="34.1" data-path="introduction.html"><a href="introduction.html#introduction"><i class="fa fa-check"></i><b>34.1</b> Introduction</a></li>
<li class="chapter" data-level="34.2" data-path="merged-pancreas.html"><a href="merged-pancreas.html#the-good"><i class="fa fa-check"></i><b>34.2</b> The good</a></li>
<li class="chapter" data-level="34.3" data-path="merged-pancreas.html"><a href="merged-pancreas.html#the-bad"><i class="fa fa-check"></i><b>34.3</b> The bad</a></li>
<li class="chapter" data-level="34.4" data-path="merged-pancreas.html"><a href="merged-pancreas.html#the-ugly"><i class="fa fa-check"></i><b>34.4</b> The ugly</a></li>
<li class="chapter" data-level="" data-path="overview.html"><a href="overview.html#session-info"><i class="fa fa-check"></i>Session Info</a></li>
</ul></li>
<li class="chapter" data-level="35" data-path="merged-hcsc.html"><a href="merged-hcsc.html"><i class="fa fa-check"></i><b>35</b> Grun mouse HSC (CEL-seq)</a>
<ul>
<li class="chapter" data-level="35.1" data-path="introduction.html"><a href="introduction.html#introduction"><i class="fa fa-check"></i><b>35.1</b> Introduction</a></li>
<li class="chapter" data-level="35.2" data-path="lun-416b-cell-line-smart-seq2.html"><a href="lun-416b-cell-line-smart-seq2.html#data-loading"><i class="fa fa-check"></i><b>35.2</b> Data loading</a></li>
<li class="chapter" data-level="35.3" data-path="quality-control.html"><a href="quality-control.html#quality-control"><i class="fa fa-check"></i><b>35.3</b> Quality control</a></li>
<li class="chapter" data-level="35.4" data-path="normalization.html"><a href="normalization.html#normalization"><i class="fa fa-check"></i><b>35.4</b> Normalization</a></li>
<li class="chapter" data-level="35.5" data-path="lun-416b-cell-line-smart-seq2.html"><a href="lun-416b-cell-line-smart-seq2.html#variance-modelling"><i class="fa fa-check"></i><b>35.5</b> Variance modelling</a></li>
<li class="chapter" data-level="35.6" data-path="dimensionality-reduction.html"><a href="dimensionality-reduction.html#dimensionality-reduction"><i class="fa fa-check"></i><b>35.6</b> Dimensionality reduction</a></li>
<li class="chapter" data-level="35.7" data-path="clustering.html"><a href="clustering.html#clustering"><i class="fa fa-check"></i><b>35.7</b> Clustering</a></li>
<li class="chapter" data-level="35.8" data-path="merged-hcsc.html"><a href="merged-hcsc.html#marker-gene-detection"><i class="fa fa-check"></i><b>35.8</b> Marker gene detection</a></li>
<li class="chapter" data-level="" data-path="overview.html"><a href="overview.html#session-info"><i class="fa fa-check"></i>Session Info</a></li>
</ul></li>
<li class="chapter" data-level="36" data-path="nestorowa-mouse-hsc-smart-seq2.html"><a href="nestorowa-mouse-hsc-smart-seq2.html"><i class="fa fa-check"></i><b>36</b> Nestorowa mouse HSC (Smart-seq2)</a>
<ul>
<li class="chapter" data-level="36.1" data-path="introduction.html"><a href="introduction.html#introduction"><i class="fa fa-check"></i><b>36.1</b> Introduction</a></li>
<li class="chapter" data-level="36.2" data-path="lun-416b-cell-line-smart-seq2.html"><a href="lun-416b-cell-line-smart-seq2.html#data-loading"><i class="fa fa-check"></i><b>36.2</b> Data loading</a></li>
<li class="chapter" data-level="36.3" data-path="quality-control.html"><a href="quality-control.html#quality-control"><i class="fa fa-check"></i><b>36.3</b> Quality control</a></li>
<li class="chapter" data-level="36.4" data-path="normalization.html"><a href="normalization.html#normalization"><i class="fa fa-check"></i><b>36.4</b> Normalization</a></li>
<li class="chapter" data-level="36.5" data-path="lun-416b-cell-line-smart-seq2.html"><a href="lun-416b-cell-line-smart-seq2.html#variance-modelling"><i class="fa fa-check"></i><b>36.5</b> Variance modelling</a></li>
<li class="chapter" data-level="36.6" data-path="dimensionality-reduction.html"><a href="dimensionality-reduction.html#dimensionality-reduction"><i class="fa fa-check"></i><b>36.6</b> Dimensionality reduction</a></li>
<li class="chapter" data-level="36.7" data-path="clustering.html"><a href="clustering.html#clustering"><i class="fa fa-check"></i><b>36.7</b> Clustering</a></li>
<li class="chapter" data-level="36.8" data-path="merged-hcsc.html"><a href="merged-hcsc.html#marker-gene-detection"><i class="fa fa-check"></i><b>36.8</b> Marker gene detection</a></li>
<li class="chapter" data-level="36.9" data-path="cell-type-annotation.html"><a href="cell-type-annotation.html#cell-type-annotation"><i class="fa fa-check"></i><b>36.9</b> Cell type annotation</a></li>
<li class="chapter" data-level="36.10" data-path="nestorowa-mouse-hsc-smart-seq2.html"><a href="nestorowa-mouse-hsc-smart-seq2.html#miscellaneous-analyses"><i class="fa fa-check"></i><b>36.10</b> Miscellaneous analyses</a></li>
<li class="chapter" data-level="" data-path="overview.html"><a href="overview.html#session-info"><i class="fa fa-check"></i>Session Info</a></li>
</ul></li>
<li class="chapter" data-level="37" data-path="pijuan-sala-chimeric-mouse-embryo-10x-genomics.html"><a href="pijuan-sala-chimeric-mouse-embryo-10x-genomics.html"><i class="fa fa-check"></i><b>37</b> Pijuan-Sala chimeric mouse embryo (10X Genomics)</a>
<ul>
<li class="chapter" data-level="37.1" data-path="introduction.html"><a href="introduction.html#introduction"><i class="fa fa-check"></i><b>37.1</b> Introduction</a></li>
<li class="chapter" data-level="37.2" data-path="lun-416b-cell-line-smart-seq2.html"><a href="lun-416b-cell-line-smart-seq2.html#data-loading"><i class="fa fa-check"></i><b>37.2</b> Data loading</a></li>
<li class="chapter" data-level="37.3" data-path="quality-control.html"><a href="quality-control.html#quality-control"><i class="fa fa-check"></i><b>37.3</b> Quality control</a></li>
<li class="chapter" data-level="37.4" data-path="normalization.html"><a href="normalization.html#normalization"><i class="fa fa-check"></i><b>37.4</b> Normalization</a></li>
<li class="chapter" data-level="37.5" data-path="lun-416b-cell-line-smart-seq2.html"><a href="lun-416b-cell-line-smart-seq2.html#variance-modelling"><i class="fa fa-check"></i><b>37.5</b> Variance modelling</a></li>
<li class="chapter" data-level="37.6" data-path="pijuan-sala-chimeric-mouse-embryo-10x-genomics.html"><a href="pijuan-sala-chimeric-mouse-embryo-10x-genomics.html#merging"><i class="fa fa-check"></i><b>37.6</b> Merging</a></li>
<li class="chapter" data-level="37.7" data-path="clustering.html"><a href="clustering.html#clustering"><i class="fa fa-check"></i><b>37.7</b> Clustering</a></li>
<li class="chapter" data-level="37.8" data-path="dimensionality-reduction.html"><a href="dimensionality-reduction.html#dimensionality-reduction"><i class="fa fa-check"></i><b>37.8</b> Dimensionality reduction</a></li>
<li class="chapter" data-level="" data-path="overview.html"><a href="overview.html#session-info"><i class="fa fa-check"></i>Session Info</a></li>
</ul></li>
<li class="chapter" data-level="38" data-path="bach-mouse-mammary-gland-10x-genomics.html"><a href="bach-mouse-mammary-gland-10x-genomics.html"><i class="fa fa-check"></i><b>38</b> Bach mouse mammary gland (10X Genomics)</a>
<ul>
<li class="chapter" data-level="38.1" data-path="introduction.html"><a href="introduction.html#introduction"><i class="fa fa-check"></i><b>38.1</b> Introduction</a></li>
<li class="chapter" data-level="38.2" data-path="lun-416b-cell-line-smart-seq2.html"><a href="lun-416b-cell-line-smart-seq2.html#data-loading"><i class="fa fa-check"></i><b>38.2</b> Data loading</a></li>
<li class="chapter" data-level="38.3" data-path="quality-control.html"><a href="quality-control.html#quality-control"><i class="fa fa-check"></i><b>38.3</b> Quality control</a></li>
<li class="chapter" data-level="38.4" data-path="normalization.html"><a href="normalization.html#normalization"><i class="fa fa-check"></i><b>38.4</b> Normalization</a></li>
<li class="chapter" data-level="38.5" data-path="lun-416b-cell-line-smart-seq2.html"><a href="lun-416b-cell-line-smart-seq2.html#variance-modelling"><i class="fa fa-check"></i><b>38.5</b> Variance modelling</a></li>
<li class="chapter" data-level="38.6" data-path="dimensionality-reduction.html"><a href="dimensionality-reduction.html#dimensionality-reduction"><i class="fa fa-check"></i><b>38.6</b> Dimensionality reduction</a></li>
<li class="chapter" data-level="38.7" data-path="clustering.html"><a href="clustering.html#clustering"><i class="fa fa-check"></i><b>38.7</b> Clustering</a></li>
<li class="chapter" data-level="" data-path="overview.html"><a href="overview.html#session-info"><i class="fa fa-check"></i>Session Info</a></li>
</ul></li>
<li class="part"><span><b>IV Appendix</b></span></li>
<li class="chapter" data-level="39" data-path="contributors.html"><a href="contributors.html"><i class="fa fa-check"></i><b>39</b> Contributors</a>
<ul>
<li><a href="contributors.html#aaron-lun-phd"><em>Aaron Lun, PhD</em></a></li>
<li><a href="contributors.html#robert-amezquita-phd"><em>Robert Amezquita, PhD</em></a></li>
<li><a href="contributors.html#stephanie-hicks-phd"><em>Stephanie Hicks, PhD</em></a></li>
<li><a href="contributors.html#raphael-gottardo-phd"><em>Raphael Gottardo, PhD</em></a></li>
<li class="chapter" data-level="" data-path="contributors.html"><a href="contributors.html#other-notable-entities"><i class="fa fa-check"></i>Other notable entities</a></li>
</ul></li>
<li class="chapter" data-level="40" data-path="bibliography.html"><a href="bibliography.html"><i class="fa fa-check"></i><b>40</b> Bibliography</a></li>
<li class="divider"></li>
<li><a href="https://bioconductor.org" target="blank">Published by Bioconductor</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Orchestrating Single-Cell Analysis with Bioconductor</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="repertoire-seq" class="section level1" number="21">
<h1><span class="header-section-number">Chapter 21</span> Analyzing repertoire sequencing data</h1>
<script>
document.addEventListener("click", function (event) {
    if (event.target.classList.contains("rebook-collapse")) {
        event.target.classList.toggle("active");
        var content = event.target.nextElementSibling;
        if (content.style.display === "block") {
            content.style.display = "none";
        } else {
            content.style.display = "block";
        }
    }
})
</script>
<style>
.rebook-collapse {
  background-color: #eee;
  color: #444;
  cursor: pointer;
  padding: 18px;
  width: 100%;
  border: none;
  text-align: left;
  outline: none;
  font-size: 15px;
}

.rebook-content {
  padding: 0 18px;
  display: none;
  overflow: hidden;
  background-color: #f1f1f1;
}
</style>
<div class="figure"><span id="fig:unnamed-chunk-1"></span>
<img src="https://raw.githubusercontent.com/Bioconductor/OSCABase/images/images/placeholder_yuno.jpg" alt="This page is under construction."  />
<p class="caption">
Figure 21.1: This page is under construction.
</p>
</div>
<div id="motivation" class="section level2" number="21.1">
<h2><span class="header-section-number">21.1</span> Motivation</h2>
<p>An organism’s immune repertoire is defined as the set of T and B cell subtypes that contain genetic diversity in the T cell receptor (TCR) components or immunoglobin chains, respectively.
This diversity is important for ensuring that the adaptive immune system can respond effectively to a wide range of antigens.
We can profile the immune repertoire by simply sequencing the relevant transcripts <span class="citation">(Georgiou et al. <a href="#ref-georgiou2014promise" role="doc-biblioref">2014</a>; Rosati et al. <a href="#ref-rosati2017overview" role="doc-biblioref">2017</a>)</span>, a procedure that can be combined with previously mentioned technologies <span class="citation">(Zheng et al. <a href="#ref-zheng2017massively" role="doc-biblioref">2017</a>)</span> to achieve single-cell resolution.
This data can then be used to characterize an individual’s immune response based on the expansion of T or B cell clones, i.e., multiple cells with the same sequences for each TCR component or immunoglobulin chain.</p>
<p>By itself, single-cell repertoire sequencing data can be readily analyzed with a variety of tools such as those from the <a href="https://immcantation.readthedocs.io/en/stable/">ImmCantation suite</a>.
For example, the <em><a href="https://CRAN.R-project.org/package=alakazam">alakazam</a></em> package provides functions to perform common analyses to quantify clonal diversity, reconstruct lineages, examine amino acid properties and so on.
We will not attempt to regurgitate their documentation in this chapter; rather, we will focus on how we can integrate repertoire sequencing data structures into our existing <code>SingleCellExperiment</code> framework.
This is not entirely trivial as each cell may have zero, one or multiple sequences for any given repertoire component, whereas we only obtain a single expression profile for that cell.</p>
<p>We would like to define a single data structure that captures both the expression profile and repertoire state for each cell.
This ensures synchronization during operations like subsetting (as previously discussed for the <code>SingleCellExperiment</code> class) and reduces book-keeping errors throughout the course of an interactive analysis.
We achieve this using the <code>SplitDataFrameList</code> class from the <em><a href="https://bioconductor.org/packages/3.12/IRanges">IRanges</a></em> package, which allows us to accommodate repertoire sequencing data into existing Bioconductor classes while retaining compatibility with functions from external analysis tools.
We demonstrate on a publicly available 10X Genomics dataset using mouse PBMCs, for which the expression and ADT data have already been processed below:</p>
<button class="rebook-collapse">
View history
</button>
<div class="rebook-content">
<div class="sourceCode" id="cb790"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb790-1"><a href="repertoire-seq.html#cb790-1" aria-hidden="true"></a><span class="co">#--- loading ---#</span></span>
<span id="cb790-2"><a href="repertoire-seq.html#cb790-2" aria-hidden="true"></a><span class="kw">library</span>(BiocFileCache)</span>
<span id="cb790-3"><a href="repertoire-seq.html#cb790-3" aria-hidden="true"></a>bfc &lt;-<span class="st"> </span><span class="kw">BiocFileCache</span>(<span class="dt">ask=</span><span class="ot">FALSE</span>)</span>
<span id="cb790-4"><a href="repertoire-seq.html#cb790-4" aria-hidden="true"></a>exprs.data &lt;-<span class="st"> </span><span class="kw">bfcrpath</span>(bfc, <span class="kw">file.path</span>(</span>
<span id="cb790-5"><a href="repertoire-seq.html#cb790-5" aria-hidden="true"></a>    <span class="st">&quot;http://cf.10xgenomics.com/samples/cell-vdj/3.1.0&quot;</span>,</span>
<span id="cb790-6"><a href="repertoire-seq.html#cb790-6" aria-hidden="true"></a>    <span class="st">&quot;vdj_v1_hs_pbmc3&quot;</span>,</span>
<span id="cb790-7"><a href="repertoire-seq.html#cb790-7" aria-hidden="true"></a>    <span class="st">&quot;vdj_v1_hs_pbmc3_filtered_feature_bc_matrix.tar.gz&quot;</span>))</span>
<span id="cb790-8"><a href="repertoire-seq.html#cb790-8" aria-hidden="true"></a><span class="kw">untar</span>(exprs.data, <span class="dt">exdir=</span><span class="kw">tempdir</span>())</span>
<span id="cb790-9"><a href="repertoire-seq.html#cb790-9" aria-hidden="true"></a></span>
<span id="cb790-10"><a href="repertoire-seq.html#cb790-10" aria-hidden="true"></a><span class="kw">library</span>(DropletUtils)</span>
<span id="cb790-11"><a href="repertoire-seq.html#cb790-11" aria-hidden="true"></a>sce.pbmc &lt;-<span class="st"> </span><span class="kw">read10xCounts</span>(<span class="kw">file.path</span>(<span class="kw">tempdir</span>(), <span class="st">&quot;filtered_feature_bc_matrix&quot;</span>))</span>
<span id="cb790-12"><a href="repertoire-seq.html#cb790-12" aria-hidden="true"></a>sce.pbmc &lt;-<span class="st"> </span><span class="kw">splitAltExps</span>(sce.pbmc, <span class="kw">rowData</span>(sce.pbmc)<span class="op">$</span>Type)</span>
<span id="cb790-13"><a href="repertoire-seq.html#cb790-13" aria-hidden="true"></a></span>
<span id="cb790-14"><a href="repertoire-seq.html#cb790-14" aria-hidden="true"></a><span class="co">#--- quality-control ---#</span></span>
<span id="cb790-15"><a href="repertoire-seq.html#cb790-15" aria-hidden="true"></a><span class="kw">library</span>(scater)</span>
<span id="cb790-16"><a href="repertoire-seq.html#cb790-16" aria-hidden="true"></a>is.mito &lt;-<span class="st"> </span><span class="kw">grep</span>(<span class="st">&quot;^MT-&quot;</span>, <span class="kw">rowData</span>(sce.pbmc)<span class="op">$</span>Symbol)</span>
<span id="cb790-17"><a href="repertoire-seq.html#cb790-17" aria-hidden="true"></a>stats &lt;-<span class="st"> </span><span class="kw">perCellQCMetrics</span>(sce.pbmc, <span class="dt">subsets=</span><span class="kw">list</span>(<span class="dt">Mito=</span>is.mito))</span>
<span id="cb790-18"><a href="repertoire-seq.html#cb790-18" aria-hidden="true"></a></span>
<span id="cb790-19"><a href="repertoire-seq.html#cb790-19" aria-hidden="true"></a>high.mito &lt;-<span class="st"> </span><span class="kw">isOutlier</span>(stats<span class="op">$</span>subsets_Mito_percent, <span class="dt">type=</span><span class="st">&quot;higher&quot;</span>)</span>
<span id="cb790-20"><a href="repertoire-seq.html#cb790-20" aria-hidden="true"></a>low.adt &lt;-<span class="st"> </span>stats<span class="op">$</span><span class="st">`</span><span class="dt">altexps_Antibody Capture_detected</span><span class="st">`</span> <span class="op">&lt;</span><span class="st"> </span><span class="kw">nrow</span>(<span class="kw">altExp</span>(sce.pbmc))<span class="op">/</span><span class="dv">2</span></span>
<span id="cb790-21"><a href="repertoire-seq.html#cb790-21" aria-hidden="true"></a></span>
<span id="cb790-22"><a href="repertoire-seq.html#cb790-22" aria-hidden="true"></a>discard &lt;-<span class="st"> </span>high.mito <span class="op">|</span><span class="st"> </span>low.adt</span>
<span id="cb790-23"><a href="repertoire-seq.html#cb790-23" aria-hidden="true"></a>sce.pbmc &lt;-<span class="st"> </span>sce.pbmc[,<span class="op">!</span>discard]</span>
<span id="cb790-24"><a href="repertoire-seq.html#cb790-24" aria-hidden="true"></a></span>
<span id="cb790-25"><a href="repertoire-seq.html#cb790-25" aria-hidden="true"></a><span class="co">#--- normalization ---#</span></span>
<span id="cb790-26"><a href="repertoire-seq.html#cb790-26" aria-hidden="true"></a><span class="kw">library</span>(scran)</span>
<span id="cb790-27"><a href="repertoire-seq.html#cb790-27" aria-hidden="true"></a></span>
<span id="cb790-28"><a href="repertoire-seq.html#cb790-28" aria-hidden="true"></a><span class="kw">set.seed</span>(<span class="dv">1000</span>)</span>
<span id="cb790-29"><a href="repertoire-seq.html#cb790-29" aria-hidden="true"></a>clusters &lt;-<span class="st"> </span><span class="kw">quickCluster</span>(sce.pbmc)</span>
<span id="cb790-30"><a href="repertoire-seq.html#cb790-30" aria-hidden="true"></a>sce.pbmc &lt;-<span class="st"> </span><span class="kw">computeSumFactors</span>(sce.pbmc, <span class="dt">cluster=</span>clusters)</span>
<span id="cb790-31"><a href="repertoire-seq.html#cb790-31" aria-hidden="true"></a><span class="kw">altExp</span>(sce.pbmc) &lt;-<span class="st"> </span><span class="kw">computeMedianFactors</span>(<span class="kw">altExp</span>(sce.pbmc))</span>
<span id="cb790-32"><a href="repertoire-seq.html#cb790-32" aria-hidden="true"></a>sce.pbmc &lt;-<span class="st"> </span><span class="kw">logNormCounts</span>(sce.pbmc, <span class="dt">use_altexps=</span><span class="ot">TRUE</span>)</span>
<span id="cb790-33"><a href="repertoire-seq.html#cb790-33" aria-hidden="true"></a></span>
<span id="cb790-34"><a href="repertoire-seq.html#cb790-34" aria-hidden="true"></a><span class="co">#--- dimensionality-reduction ---#</span></span>
<span id="cb790-35"><a href="repertoire-seq.html#cb790-35" aria-hidden="true"></a><span class="kw">set.seed</span>(<span class="dv">100000</span>)</span>
<span id="cb790-36"><a href="repertoire-seq.html#cb790-36" aria-hidden="true"></a><span class="kw">altExp</span>(sce.pbmc) &lt;-<span class="st"> </span><span class="kw">runTSNE</span>(<span class="kw">altExp</span>(sce.pbmc))</span>
<span id="cb790-37"><a href="repertoire-seq.html#cb790-37" aria-hidden="true"></a></span>
<span id="cb790-38"><a href="repertoire-seq.html#cb790-38" aria-hidden="true"></a><span class="kw">set.seed</span>(<span class="dv">1000000</span>)</span>
<span id="cb790-39"><a href="repertoire-seq.html#cb790-39" aria-hidden="true"></a><span class="kw">altExp</span>(sce.pbmc) &lt;-<span class="st"> </span><span class="kw">runUMAP</span>(<span class="kw">altExp</span>(sce.pbmc))</span>
<span id="cb790-40"><a href="repertoire-seq.html#cb790-40" aria-hidden="true"></a></span>
<span id="cb790-41"><a href="repertoire-seq.html#cb790-41" aria-hidden="true"></a><span class="co">#--- clustering ---#</span></span>
<span id="cb790-42"><a href="repertoire-seq.html#cb790-42" aria-hidden="true"></a>g.adt &lt;-<span class="st"> </span><span class="kw">buildSNNGraph</span>(<span class="kw">altExp</span>(sce.pbmc), <span class="dt">k=</span><span class="dv">10</span>, <span class="dt">d=</span><span class="ot">NA</span>)</span>
<span id="cb790-43"><a href="repertoire-seq.html#cb790-43" aria-hidden="true"></a>clust.adt &lt;-<span class="st"> </span>igraph<span class="op">::</span><span class="kw">cluster_walktrap</span>(g.adt)<span class="op">$</span>membership</span>
<span id="cb790-44"><a href="repertoire-seq.html#cb790-44" aria-hidden="true"></a><span class="kw">colLabels</span>(<span class="kw">altExp</span>(sce.pbmc)) &lt;-<span class="st"> </span><span class="kw">factor</span>(clust.adt)</span></code></pre></div>
</div>
<div class="sourceCode" id="cb791"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb791-1"><a href="repertoire-seq.html#cb791-1" aria-hidden="true"></a>sce.pbmc</span></code></pre></div>
<pre><code>## class: SingleCellExperiment 
## dim: 33538 6660 
## metadata(1): Samples
## assays(2): counts logcounts
## rownames(33538): ENSG00000243485 ENSG00000237613 ... ENSG00000277475
##   ENSG00000268674
## rowData names(3): ID Symbol Type
## colnames: NULL
## colData names(3): Sample Barcode sizeFactor
## reducedDimNames(0):
## altExpNames(1): Antibody Capture</code></pre>
<div class="sourceCode" id="cb793"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb793-1"><a href="repertoire-seq.html#cb793-1" aria-hidden="true"></a><span class="co"># Moving ADT-based clustering to the top level for convenience.</span></span>
<span id="cb793-2"><a href="repertoire-seq.html#cb793-2" aria-hidden="true"></a><span class="kw">colLabels</span>(sce.pbmc) &lt;-<span class="st"> </span><span class="kw">colLabels</span>(<span class="kw">altExp</span>(sce.pbmc))</span></code></pre></div>
</div>
<div id="loading-the-tcr-repertoire" class="section level2" number="21.2">
<h2><span class="header-section-number">21.2</span> Loading the TCR repertoire</h2>
<p>First, we obtain the filtered TCR contig annotations for the same set of cells.
Each row of the resulting data frame contains information about a single TCR component sequence in one cell, broken down into the alleles of the V(D)J genes making up that component (<code>v_gene</code>, <code>d_gene</code>, <code>j_gene</code>) where possible.
The number of reads and UMIs supporting the set of allele assignments for a cell is also shown, though only the UMI count should be used for quantifying expression of a particular TCR sequence.
Each cell is assigned to a clonotype (<code>raw_clonotype_id</code>) based on the combination of the <span class="math inline">\(\alpha\)</span>-chain (TRA) and <span class="math inline">\(\beta\)</span>-chain (TRB) sequences in that cell.</p>
<div class="sourceCode" id="cb794"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb794-1"><a href="repertoire-seq.html#cb794-1" aria-hidden="true"></a><span class="kw">library</span>(BiocFileCache)</span>
<span id="cb794-2"><a href="repertoire-seq.html#cb794-2" aria-hidden="true"></a>bfc &lt;-<span class="st"> </span><span class="kw">BiocFileCache</span>(<span class="dt">ask=</span><span class="ot">FALSE</span>)</span>
<span id="cb794-3"><a href="repertoire-seq.html#cb794-3" aria-hidden="true"></a>tcr.data &lt;-<span class="st"> </span><span class="kw">bfcrpath</span>(bfc, <span class="kw">file.path</span>(</span>
<span id="cb794-4"><a href="repertoire-seq.html#cb794-4" aria-hidden="true"></a>    <span class="st">&quot;http://cf.10xgenomics.com/samples/cell-vdj/3.1.0&quot;</span>,</span>
<span id="cb794-5"><a href="repertoire-seq.html#cb794-5" aria-hidden="true"></a>    <span class="st">&quot;vdj_v1_hs_pbmc3/vdj_v1_hs_pbmc3_t_filtered_contig_annotations.csv&quot;</span>))</span>
<span id="cb794-6"><a href="repertoire-seq.html#cb794-6" aria-hidden="true"></a>tcr &lt;-<span class="st"> </span><span class="kw">read.csv</span>(tcr.data, <span class="dt">stringsAsFactors=</span><span class="ot">FALSE</span>)</span>
<span id="cb794-7"><a href="repertoire-seq.html#cb794-7" aria-hidden="true"></a><span class="kw">nrow</span>(tcr)</span></code></pre></div>
<pre><code>## [1] 10121</code></pre>
<div class="sourceCode" id="cb796"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb796-1"><a href="repertoire-seq.html#cb796-1" aria-hidden="true"></a><span class="kw">head</span>(tcr)</span></code></pre></div>
<pre><code>##              barcode is_cell                   contig_id high_confidence length
## 1 AAACCTGAGATCTGAA-1    True AAACCTGAGATCTGAA-1_contig_1            True    521
## 2 AAACCTGAGATCTGAA-1    True AAACCTGAGATCTGAA-1_contig_2            True    474
## 3 AAACCTGAGGAACTGC-1    True AAACCTGAGGAACTGC-1_contig_1            True    496
## 4 AAACCTGAGGAACTGC-1    True AAACCTGAGGAACTGC-1_contig_2            True    505
## 5 AAACCTGAGGAGTCTG-1    True AAACCTGAGGAGTCTG-1_contig_1            True    495
## 6 AAACCTGAGGAGTCTG-1    True AAACCTGAGGAGTCTG-1_contig_2            True    526
##   chain     v_gene d_gene  j_gene c_gene full_length productive
## 1   TRB   TRBV20-1   None TRBJ2-7  TRBC2        True       True
## 2   TRA   TRAV13-1   None  TRAJ44   TRAC        True       True
## 3   TRB    TRBV7-2   None TRBJ2-1  TRBC2        True       True
## 4   TRA TRAV23/DV6   None  TRAJ34   TRAC        True       True
## 5   TRA      TRAV2   None  TRAJ38   TRAC        True       True
## 6   TRB    TRBV6-2   None TRBJ1-1  TRBC1        True       True
##                 cdr3                                                cdr3_nt
## 1     CSARDKGLSYEQYF             TGCAGTGCTAGAGACAAGGGGCTTAGCTACGAGCAGTACTTC
## 2 CAASIGPLGTGTASKLTF TGTGCAGCAAGTATCGGCCCCCTAGGAACCGGCACTGCCAGTAAACTCACCTTT
## 3      CASSLGPSGEQFF                TGTGCCAGCAGCTTGGGACCATCGGGTGAGCAGTTCTTC
## 4       CAASDNTDKLIF                   TGTGCAGCAAGCGATAACACCGACAAGCTCATCTTT
## 5   CAVEANNAGNNRKLIW       TGTGCTGTGGAGGCTAATAATGCTGGCAACAACCGTAAGCTGATTTGG
## 6      CASSRTGGTEAFF                TGTGCCAGCAGTCGGACAGGGGGCACTGAAGCTTTCTTT
##   reads umis raw_clonotype_id         raw_consensus_id
## 1  9327   12     clonotype100 clonotype100_consensus_1
## 2  3440    3     clonotype100 clonotype100_consensus_2
## 3 32991   29     clonotype101 clonotype101_consensus_2
## 4 10714    9     clonotype101 clonotype101_consensus_1
## 5  1734    3     clonotype102 clonotype102_consensus_1
## 6 15530   13     clonotype102 clonotype102_consensus_2</code></pre>
<p>The challenge in incorporating all of these data structures into a single object lies in the fact that each cell may have zero, one or many TCR sequences.
This precludes direct storage of repertoire information in the <code>colData()</code> of the <code>SingleCellExperiment</code>, which would be expecting a 1:1 mapping from each cell to each repertoire sequence.
Instead, we store the repertoire data as a <code>SplitDataFrameList</code> object where each cell is represented by a variable-row <code>DataFrame</code> containing information for zero-to-many sequences.
This is easily done by:</p>
<ol style="list-style-type: decimal">
<li><p>Converting our <code>data.frame</code> to a <code>DataFrame</code> from the <em><a href="https://bioconductor.org/packages/3.12/S4Vectors">S4Vectors</a></em> package.
We demonstrate this process below for the alpha chain:</p>
<div class="sourceCode" id="cb798"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb798-1"><a href="repertoire-seq.html#cb798-1" aria-hidden="true"></a>tra &lt;-<span class="st"> </span>tcr[tcr<span class="op">$</span>chain<span class="op">==</span><span class="st">&quot;TRA&quot;</span>,]</span>
<span id="cb798-2"><a href="repertoire-seq.html#cb798-2" aria-hidden="true"></a>tra &lt;-<span class="st"> </span><span class="kw">DataFrame</span>(tra)</span></code></pre></div></li>
<li><p>Defining a factor of cell identities, using cells that are present in <code>sce.pbmc</code> as our levels.
This ensures that, in the resulting <code>SplitDataFrameList</code>, we always have one entry per cell in <code>sce.pbmc</code>,
even if those entries consist of zero-row <code>DataFrame</code>s.</p>
<div class="sourceCode" id="cb799"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb799-1"><a href="repertoire-seq.html#cb799-1" aria-hidden="true"></a>cell.id &lt;-<span class="st"> </span><span class="kw">factor</span>(tra<span class="op">$</span>barcode, sce.pbmc<span class="op">$</span>Barcode)</span></code></pre></div></li>
<li><p>Using the <code>split()</code> function to break up <code>tra</code> into one <code>DataFrame</code> per cell, forming the desired <code>SplitDataFrameList</code>.</p>
<div class="sourceCode" id="cb800"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb800-1"><a href="repertoire-seq.html#cb800-1" aria-hidden="true"></a>tra.list &lt;-<span class="st"> </span><span class="kw">split</span>(tra, cell.id)</span>
<span id="cb800-2"><a href="repertoire-seq.html#cb800-2" aria-hidden="true"></a><span class="kw">class</span>(tra.list)</span></code></pre></div>
<pre><code>## [1] &quot;CompressedSplitDFrameList&quot;
## attr(,&quot;package&quot;)
## [1] &quot;IRanges&quot;</code></pre></li>
</ol>
<p>Put together, this is as simple as the following stretch of code (repeated for the beta chain):</p>
<div class="sourceCode" id="cb802"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb802-1"><a href="repertoire-seq.html#cb802-1" aria-hidden="true"></a>trb &lt;-<span class="st"> </span>tcr[tcr<span class="op">$</span>chain<span class="op">==</span><span class="st">&quot;TRB&quot;</span>,]</span>
<span id="cb802-2"><a href="repertoire-seq.html#cb802-2" aria-hidden="true"></a>trb.list &lt;-<span class="st"> </span><span class="kw">split</span>(<span class="kw">DataFrame</span>(trb), <span class="kw">factor</span>(trb<span class="op">$</span>barcode, sce.pbmc<span class="op">$</span>Barcode))</span>
<span id="cb802-3"><a href="repertoire-seq.html#cb802-3" aria-hidden="true"></a><span class="kw">length</span>(trb.list)</span></code></pre></div>
<pre><code>## [1] 6660</code></pre>
<p>Both of these objects are guaranteed to have a 1:1 mapping to the columns of <code>sce.pbmc</code>, allowing us to directly store them in the <code>colData</code> as additional metadata fields.
This ensures that any subsetting applied to the <code>SingleCellExperiment</code> is synchronized across both gene expression and repertoire data.
For example, an obvious step might be to subset <code>sce.pbmc</code> to only contain T cells so that the TCR analysis is not distorted by other irrelevant cell types.</p>
<div class="sourceCode" id="cb804"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb804-1"><a href="repertoire-seq.html#cb804-1" aria-hidden="true"></a>sce.pbmc<span class="op">$</span>TRA &lt;-<span class="st"> </span>tra.list</span>
<span id="cb804-2"><a href="repertoire-seq.html#cb804-2" aria-hidden="true"></a>sce.pbmc<span class="op">$</span>TRB &lt;-<span class="st"> </span>trb.list</span></code></pre></div>
</div>
<div id="leveraging-list-semantics" class="section level2" number="21.3">
<h2><span class="header-section-number">21.3</span> Leveraging <code>List</code> semantics</h2>
<p>At this point, it is worth spending some time on the power of the <code>SplitDataFrameList</code> and the <code>List</code> grammar.
In the simplest case, the <code>SplitDataFrameList</code> can be treated as an ordinary list of <code>DataFrame</code>s with one entry per cell.</p>
<div class="sourceCode" id="cb805"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb805-1"><a href="repertoire-seq.html#cb805-1" aria-hidden="true"></a>sce.pbmc<span class="op">$</span>TRA[[<span class="dv">1</span>]] <span class="co"># for the first cell.</span></span></code></pre></div>
<pre><code>## DataFrame with 1 row and 18 columns
##              barcode     is_cell              contig_id high_confidence
##          &lt;character&gt; &lt;character&gt;            &lt;character&gt;     &lt;character&gt;
## 1 AAACCTGAGATCTGAA-1        True AAACCTGAGATCTGAA-1_c..            True
##      length       chain      v_gene      d_gene      j_gene      c_gene
##   &lt;integer&gt; &lt;character&gt; &lt;character&gt; &lt;character&gt; &lt;character&gt; &lt;character&gt;
## 1       474         TRA    TRAV13-1        None      TRAJ44        TRAC
##   full_length  productive               cdr3                cdr3_nt     reads
##   &lt;character&gt; &lt;character&gt;        &lt;character&gt;            &lt;character&gt; &lt;integer&gt;
## 1        True        True CAASIGPLGTGTASKLTF TGTGCAGCAAGTATCGGCCC..      3440
##        umis raw_clonotype_id       raw_consensus_id
##   &lt;integer&gt;      &lt;character&gt;            &lt;character&gt;
## 1         3     clonotype100 clonotype100_consens..</code></pre>
<div class="sourceCode" id="cb807"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb807-1"><a href="repertoire-seq.html#cb807-1" aria-hidden="true"></a>sce.pbmc<span class="op">$</span>TRA[[<span class="dv">2</span>]] <span class="co"># for the second cell.</span></span></code></pre></div>
<pre><code>## DataFrame with 1 row and 18 columns
##              barcode     is_cell              contig_id high_confidence
##          &lt;character&gt; &lt;character&gt;            &lt;character&gt;     &lt;character&gt;
## 1 AAACCTGAGGAACTGC-1        True AAACCTGAGGAACTGC-1_c..            True
##      length       chain      v_gene      d_gene      j_gene      c_gene
##   &lt;integer&gt; &lt;character&gt; &lt;character&gt; &lt;character&gt; &lt;character&gt; &lt;character&gt;
## 1       505         TRA  TRAV23/DV6        None      TRAJ34        TRAC
##   full_length  productive         cdr3                cdr3_nt     reads
##   &lt;character&gt; &lt;character&gt;  &lt;character&gt;            &lt;character&gt; &lt;integer&gt;
## 1        True        True CAASDNTDKLIF TGTGCAGCAAGCGATAACAC..     10714
##        umis raw_clonotype_id       raw_consensus_id
##   &lt;integer&gt;      &lt;character&gt;            &lt;character&gt;
## 1         9     clonotype101 clonotype101_consens..</code></pre>
<div class="sourceCode" id="cb809"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb809-1"><a href="repertoire-seq.html#cb809-1" aria-hidden="true"></a>sce.pbmc<span class="op">$</span>TRA[<span class="dv">3</span><span class="op">:</span><span class="dv">5</span>] <span class="co"># for the third-to-fifth cells.</span></span></code></pre></div>
<pre><code>## SplitDataFrameList of length 3
## $`AAACCTGAGGAGTCTG-1`
## DataFrame with 1 row and 18 columns
##              barcode     is_cell              contig_id high_confidence
##          &lt;character&gt; &lt;character&gt;            &lt;character&gt;     &lt;character&gt;
## 1 AAACCTGAGGAGTCTG-1        True AAACCTGAGGAGTCTG-1_c..            True
##      length       chain      v_gene      d_gene      j_gene      c_gene
##   &lt;integer&gt; &lt;character&gt; &lt;character&gt; &lt;character&gt; &lt;character&gt; &lt;character&gt;
## 1       495         TRA       TRAV2        None      TRAJ38        TRAC
##   full_length  productive             cdr3                cdr3_nt     reads
##   &lt;character&gt; &lt;character&gt;      &lt;character&gt;            &lt;character&gt; &lt;integer&gt;
## 1        True        True CAVEANNAGNNRKLIW TGTGCTGTGGAGGCTAATAA..      1734
##        umis raw_clonotype_id       raw_consensus_id
##   &lt;integer&gt;      &lt;character&gt;            &lt;character&gt;
## 1         3     clonotype102 clonotype102_consens..
## 
## $`AAACCTGAGGCTCTTA-1`
## DataFrame with 2 rows and 18 columns
##              barcode     is_cell              contig_id high_confidence
##          &lt;character&gt; &lt;character&gt;            &lt;character&gt;     &lt;character&gt;
## 1 AAACCTGAGGCTCTTA-1        True AAACCTGAGGCTCTTA-1_c..            True
## 2 AAACCTGAGGCTCTTA-1        True AAACCTGAGGCTCTTA-1_c..            True
##      length       chain      v_gene      d_gene      j_gene      c_gene
##   &lt;integer&gt; &lt;character&gt; &lt;character&gt; &lt;character&gt; &lt;character&gt; &lt;character&gt;
## 1       501         TRA    TRAV12-3        None      TRAJ37        TRAC
## 2       493         TRA      TRAV25        None      TRAJ29        TRAC
##   full_length  productive           cdr3                cdr3_nt     reads
##   &lt;character&gt; &lt;character&gt;    &lt;character&gt;            &lt;character&gt; &lt;integer&gt;
## 1        True        True CAMSSSGNTGKLIF TGTGCAATGAGCTCCTCTGG..      4325
## 2        True       False           None                   None      2600
##        umis raw_clonotype_id       raw_consensus_id
##   &lt;integer&gt;      &lt;character&gt;            &lt;character&gt;
## 1         3     clonotype103 clonotype103_consens..
## 2         2     clonotype103                   None
## 
## $`AAACCTGAGTACGTTC-1`
## DataFrame with 0 rows and 18 columns</code></pre>
<div class="sourceCode" id="cb811"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb811-1"><a href="repertoire-seq.html#cb811-1" aria-hidden="true"></a><span class="kw">head</span>(<span class="kw">lengths</span>(sce.pbmc<span class="op">$</span>TRA)) <span class="co"># number of sequences per cell.</span></span></code></pre></div>
<pre><code>## AAACCTGAGATCTGAA-1 AAACCTGAGGAACTGC-1 AAACCTGAGGAGTCTG-1 AAACCTGAGGCTCTTA-1 
##                  1                  1                  1                  2 
## AAACCTGAGTACGTTC-1 AAACCTGGTCTTGTCC-1 
##                  0                  0</code></pre>
<p>However, it is also possible to treat a <code>SplitDataFrameList</code> like a giant <code>DataFrame</code> with respect to its columns.
When constructed in the manner described above, all entries of the <code>SplitDataFrameList</code> have the same columns;
this allows us to use column-subsetting semantics to extract the same column from all of the internal <code>DataFrame</code>s.</p>
<div class="sourceCode" id="cb813"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb813-1"><a href="repertoire-seq.html#cb813-1" aria-hidden="true"></a><span class="co"># Create a new SplitDataFrameList consisting only</span></span>
<span id="cb813-2"><a href="repertoire-seq.html#cb813-2" aria-hidden="true"></a><span class="co"># of the columns &#39;reads&#39; and &#39;umis&#39;.</span></span>
<span id="cb813-3"><a href="repertoire-seq.html#cb813-3" aria-hidden="true"></a>sce.pbmc<span class="op">$</span>TRA[,<span class="kw">c</span>(<span class="st">&quot;reads&quot;</span>, <span class="st">&quot;umis&quot;</span>)]</span></code></pre></div>
<pre><code>## SplitDataFrameList of length 6660
## $`AAACCTGAGATCTGAA-1`
## DataFrame with 1 row and 2 columns
##       reads      umis
##   &lt;integer&gt; &lt;integer&gt;
## 1      3440         3
## 
## $`AAACCTGAGGAACTGC-1`
## DataFrame with 1 row and 2 columns
##       reads      umis
##   &lt;integer&gt; &lt;integer&gt;
## 1     10714         9
## 
## $`AAACCTGAGGAGTCTG-1`
## DataFrame with 1 row and 2 columns
##       reads      umis
##   &lt;integer&gt; &lt;integer&gt;
## 1      1734         3
## 
## ...
## &lt;6657 more elements&gt;</code></pre>
<div class="sourceCode" id="cb815"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb815-1"><a href="repertoire-seq.html#cb815-1" aria-hidden="true"></a><span class="co"># Extract a single column as a new List.</span></span>
<span id="cb815-2"><a href="repertoire-seq.html#cb815-2" aria-hidden="true"></a>sce.pbmc<span class="op">$</span>TRA[,<span class="st">&quot;reads&quot;</span>]</span></code></pre></div>
<pre><code>## IntegerList of length 6660
## [[&quot;AAACCTGAGATCTGAA-1&quot;]] 3440
## [[&quot;AAACCTGAGGAACTGC-1&quot;]] 10714
## [[&quot;AAACCTGAGGAGTCTG-1&quot;]] 1734
## [[&quot;AAACCTGAGGCTCTTA-1&quot;]] 4325 2600
## [[&quot;AAACCTGAGTACGTTC-1&quot;]] integer(0)
## [[&quot;AAACCTGGTCTTGTCC-1&quot;]] integer(0)
## [[&quot;AAACCTGGTTGCGTTA-1&quot;]] integer(0)
## [[&quot;AAACCTGTCAACGGGA-1&quot;]] 5355 1686
## [[&quot;AAACCTGTCACTGGGC-1&quot;]] integer(0)
## [[&quot;AAACCTGTCAGCTGGC-1&quot;]] integer(0)
## ...
## &lt;6650 more elements&gt;</code></pre>
<p>For the <code>"reads"</code> column, the above subsetting yields an <code>IntegerList</code> where each entry corresponds to the integer vector that would have been extracted from the corresponding entry of the <code>SplitDataFrameList</code>.
This is equivalent to looping over the <code>SplitDataFrameList</code> and column-subsetting each individual <code>DataFrame</code>, though the actual implementation is much more efficient.
The <code>IntegerList</code> and its type counterparts (e.g., <code>CharacterList</code>, <code>LogicalList</code>) are convenient structures as they support a number of vector-like operations in the expected manner.
For example, a boolean operation will convert an <code>IntegerList</code> into a <code>LogicalList</code>:</p>
<div class="sourceCode" id="cb817"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb817-1"><a href="repertoire-seq.html#cb817-1" aria-hidden="true"></a>sce.pbmc<span class="op">$</span>TRA[,<span class="st">&quot;umis&quot;</span>] <span class="op">&gt;</span><span class="st"> </span><span class="dv">2</span></span></code></pre></div>
<pre><code>## LogicalList of length 6660
## [[&quot;AAACCTGAGATCTGAA-1&quot;]] TRUE
## [[&quot;AAACCTGAGGAACTGC-1&quot;]] TRUE
## [[&quot;AAACCTGAGGAGTCTG-1&quot;]] TRUE
## [[&quot;AAACCTGAGGCTCTTA-1&quot;]] TRUE FALSE
## [[&quot;AAACCTGAGTACGTTC-1&quot;]] logical(0)
## [[&quot;AAACCTGGTCTTGTCC-1&quot;]] logical(0)
## [[&quot;AAACCTGGTTGCGTTA-1&quot;]] logical(0)
## [[&quot;AAACCTGTCAACGGGA-1&quot;]] TRUE FALSE
## [[&quot;AAACCTGTCACTGGGC-1&quot;]] logical(0)
## [[&quot;AAACCTGTCAGCTGGC-1&quot;]] logical(0)
## ...
## &lt;6650 more elements&gt;</code></pre>
<p>This is where the final mode of <code>SplitDataFrameList</code> subsetting comes into play.
If we use a <code>LogicalList</code> to subset a <code>SplitDataFrameList</code>, we can subset on the individual sequences <em>within</em> each cell.
This is functionally equivalent to looping over both the <code>LogicalList</code> and <code>SplitDataFrameList</code> simultaneously and using each logical vector to subset the corresponding <code>DataFrame</code>.
For example, we can filter our <code>SplitDataFrameList</code> so that each per-cell <code>DataFrame</code> only contains sequences with more than 2 UMIs.</p>
<div class="sourceCode" id="cb819"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb819-1"><a href="repertoire-seq.html#cb819-1" aria-hidden="true"></a>more.than<span class="fl">.2</span> &lt;-<span class="st"> </span>sce.pbmc<span class="op">$</span>TRA[sce.pbmc<span class="op">$</span>TRA[,<span class="st">&quot;umis&quot;</span>] <span class="op">&gt;</span><span class="st"> </span><span class="dv">2</span>]</span>
<span id="cb819-2"><a href="repertoire-seq.html#cb819-2" aria-hidden="true"></a><span class="kw">head</span>(<span class="kw">lengths</span>(more.than<span class="fl">.2</span>))</span></code></pre></div>
<pre><code>## AAACCTGAGATCTGAA-1 AAACCTGAGGAACTGC-1 AAACCTGAGGAGTCTG-1 AAACCTGAGGCTCTTA-1 
##                  1                  1                  1                  1 
## AAACCTGAGTACGTTC-1 AAACCTGGTCTTGTCC-1 
##                  0                  0</code></pre>
<p>We can exploit these semantics to quickly assemble complex queries without the need for any other packages.
Say we want to determine the proportion of cells in each cluster that have at least one productive sequence of a TCR component, i.e., contigs that are likely to produce a functional protein.
Clusters with large counts are most likely to be T cells, though some background level of TCR expression may be observed in other clusters due to a mixture of clustering uncertainty, ambient contamination, doublet formation and potential expression in other cell types.
This quantification is easily achieved with the built-in <code>List</code> semantics for both the alpha and beta chains (Figure <a href="repertoire-seq.html#fig:tcr-prop-cluster-prod">21.2</a>).</p>
<div class="sourceCode" id="cb821"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb821-1"><a href="repertoire-seq.html#cb821-1" aria-hidden="true"></a><span class="co"># Generate a LogicalList class where each entry corresponds to a cell and is</span></span>
<span id="cb821-2"><a href="repertoire-seq.html#cb821-2" aria-hidden="true"></a><span class="co"># a logical vector specifying which of that cell&#39;s sequences are productive.</span></span>
<span id="cb821-3"><a href="repertoire-seq.html#cb821-3" aria-hidden="true"></a>is.prod.A &lt;-<span class="st"> </span>sce.pbmc<span class="op">$</span>TRA[,<span class="st">&quot;productive&quot;</span>]<span class="op">==</span><span class="st">&quot;True&quot;</span> </span>
<span id="cb821-4"><a href="repertoire-seq.html#cb821-4" aria-hidden="true"></a></span>
<span id="cb821-5"><a href="repertoire-seq.html#cb821-5" aria-hidden="true"></a><span class="co"># We can apply operations to this LogicalList that mimic looping over a logical</span></span>
<span id="cb821-6"><a href="repertoire-seq.html#cb821-6" aria-hidden="true"></a><span class="co"># vector. For example, `any()` will return a logical vector of length equal to </span></span>
<span id="cb821-7"><a href="repertoire-seq.html#cb821-7" aria-hidden="true"></a><span class="co"># the number of cells, with a value of TRUE if any sequence is productive.</span></span>
<span id="cb821-8"><a href="repertoire-seq.html#cb821-8" aria-hidden="true"></a>has.prod.A &lt;-<span class="st"> </span><span class="kw">any</span>(is.prod.A)</span>
<span id="cb821-9"><a href="repertoire-seq.html#cb821-9" aria-hidden="true"></a></span>
<span id="cb821-10"><a href="repertoire-seq.html#cb821-10" aria-hidden="true"></a><span class="co"># And then we simply count the number of cells in each cluster.</span></span>
<span id="cb821-11"><a href="repertoire-seq.html#cb821-11" aria-hidden="true"></a>tra.counts.prod &lt;-<span class="st"> </span><span class="kw">table</span>(<span class="kw">colLabels</span>(sce.pbmc)[has.prod.A])</span>
<span id="cb821-12"><a href="repertoire-seq.html#cb821-12" aria-hidden="true"></a></span>
<span id="cb821-13"><a href="repertoire-seq.html#cb821-13" aria-hidden="true"></a>is.prod.B &lt;-<span class="st"> </span>sce.pbmc<span class="op">$</span>TRB[,<span class="st">&quot;productive&quot;</span>]<span class="op">==</span><span class="st">&quot;True&quot;</span></span>
<span id="cb821-14"><a href="repertoire-seq.html#cb821-14" aria-hidden="true"></a>has.prod.B &lt;-<span class="st"> </span><span class="kw">any</span>(is.prod.B)</span>
<span id="cb821-15"><a href="repertoire-seq.html#cb821-15" aria-hidden="true"></a>trb.counts.prod &lt;-<span class="st"> </span><span class="kw">table</span>(<span class="kw">colLabels</span>(sce.pbmc)[has.prod.B])</span>
<span id="cb821-16"><a href="repertoire-seq.html#cb821-16" aria-hidden="true"></a></span>
<span id="cb821-17"><a href="repertoire-seq.html#cb821-17" aria-hidden="true"></a>ncells &lt;-<span class="st"> </span><span class="kw">table</span>(<span class="kw">colLabels</span>(sce.pbmc))</span>
<span id="cb821-18"><a href="repertoire-seq.html#cb821-18" aria-hidden="true"></a><span class="kw">barplot</span>(<span class="kw">rbind</span>(<span class="dt">TRA=</span>tra.counts.prod<span class="op">/</span>ncells, <span class="dt">TRB=</span>trb.counts.prod<span class="op">/</span>ncells),</span>
<span id="cb821-19"><a href="repertoire-seq.html#cb821-19" aria-hidden="true"></a>    <span class="dt">legend=</span><span class="ot">TRUE</span>, <span class="dt">beside=</span><span class="ot">TRUE</span>)</span></code></pre></div>
<div class="figure"><span id="fig:tcr-prop-cluster-prod"></span>
<img src="repertoire-seq_files/figure-html/tcr-prop-cluster-prod-1.png" alt="Proportion of cells in each cluster that express at least one productive sequence of the TCR $\alpha$ (dark) or $\beta$-chains (light)." width="960" />
<p class="caption">
Figure 21.2: Proportion of cells in each cluster that express at least one productive sequence of the TCR <span class="math inline">\(\alpha\)</span> (dark) or <span class="math inline">\(\beta\)</span>-chains (light).
</p>
</div>
<p>Alternatively, we may wish to determine the proportion of UMIs assigned to the most abundant sequence in each cell.
This is easily achieved by applying the <code>max()</code> and <code>sum()</code> functions on the UMI count “column”
(Figure <a href="repertoire-seq.html#fig:tcr-prop-most-abundant">21.3</a>).</p>
<div class="sourceCode" id="cb822"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb822-1"><a href="repertoire-seq.html#cb822-1" aria-hidden="true"></a>umi.data &lt;-<span class="st"> </span>sce.pbmc<span class="op">$</span>TRA[,<span class="st">&quot;umis&quot;</span>]</span>
<span id="cb822-2"><a href="repertoire-seq.html#cb822-2" aria-hidden="true"></a><span class="kw">hist</span>(<span class="kw">max</span>(umi.data)<span class="op">/</span><span class="kw">sum</span>(umi.data), <span class="dt">xlab=</span><span class="st">&quot;Proportion in most abundant&quot;</span>)</span></code></pre></div>
<div class="figure"><span id="fig:tcr-prop-most-abundant"></span>
<img src="repertoire-seq_files/figure-html/tcr-prop-most-abundant-1.png" alt="Proportion of UMIs assigned to the most abundant sequence in each cell." width="672" />
<p class="caption">
Figure 21.3: Proportion of UMIs assigned to the most abundant sequence in each cell.
</p>
</div>
<p>We can also apply boolean operations on our <code>LogicalList</code> objects to perform per-sequence queries.
The example below filters to retain sequences that are full-length, productive and have the largest UMI count in the cell.</p>
<div class="sourceCode" id="cb823"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb823-1"><a href="repertoire-seq.html#cb823-1" aria-hidden="true"></a>tra &lt;-<span class="st"> </span>sce.pbmc<span class="op">$</span>TRA <span class="co"># assigning to a variable for brevity</span></span>
<span id="cb823-2"><a href="repertoire-seq.html#cb823-2" aria-hidden="true"></a></span>
<span id="cb823-3"><a href="repertoire-seq.html#cb823-3" aria-hidden="true"></a>keep &lt;-<span class="st"> </span>tra[,<span class="st">&quot;full_length&quot;</span>]<span class="op">==</span><span class="st">&quot;True&quot;</span> <span class="op">&amp;</span></span>
<span id="cb823-4"><a href="repertoire-seq.html#cb823-4" aria-hidden="true"></a><span class="st">    </span>tra[,<span class="st">&quot;productive&quot;</span>]<span class="op">==</span><span class="st">&quot;True&quot;</span> <span class="op">&amp;</span></span>
<span id="cb823-5"><a href="repertoire-seq.html#cb823-5" aria-hidden="true"></a><span class="st">    </span>tra[,<span class="st">&quot;umis&quot;</span>] <span class="op">==</span><span class="st"> </span><span class="kw">max</span>(tra[,<span class="st">&quot;umis&quot;</span>])</span>
<span id="cb823-6"><a href="repertoire-seq.html#cb823-6" aria-hidden="true"></a>tra.sub &lt;-<span class="st"> </span>tra[keep]</span>
<span id="cb823-7"><a href="repertoire-seq.html#cb823-7" aria-hidden="true"></a></span>
<span id="cb823-8"><a href="repertoire-seq.html#cb823-8" aria-hidden="true"></a><span class="co"># How many cells have at least one sequence satisfying all requirements?</span></span>
<span id="cb823-9"><a href="repertoire-seq.html#cb823-9" aria-hidden="true"></a><span class="kw">summary</span>(<span class="kw">sum</span>(keep) <span class="op">&gt;=</span><span class="st"> </span><span class="dv">1</span>) </span></code></pre></div>
<pre><code>##    Mode   FALSE    TRUE 
## logical    3369    3291</code></pre>
</div>
<div id="converting-back-to-dataframes" class="section level2" number="21.4">
<h2><span class="header-section-number">21.4</span> Converting back to <code>DataFrame</code>s</h2>
<p>If an operation must be performed on the original sequence-level data frame,
we can efficiently recover it by calling <code>unlist()</code> on our <code>SplitDataFrameList</code>.
It is similarly straightforward to regenerate our <code>SplitDataFrameList</code> from the data frame by using the <code>relist()</code> function.
This framework permits users to quickly switch between sequence level and cell level perspectives of the repertoire data depending on which is most convenient at any given point in the analysis.</p>
<div class="sourceCode" id="cb825"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb825-1"><a href="repertoire-seq.html#cb825-1" aria-hidden="true"></a>tra.seq &lt;-<span class="st"> </span><span class="kw">unlist</span>(tra)</span>
<span id="cb825-2"><a href="repertoire-seq.html#cb825-2" aria-hidden="true"></a><span class="kw">dim</span>(tra.seq) <span class="co"># Each row represents a sequence now.</span></span></code></pre></div>
<pre><code>## [1] 4863   18</code></pre>
<div class="sourceCode" id="cb827"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb827-1"><a href="repertoire-seq.html#cb827-1" aria-hidden="true"></a><span class="co"># Adding some arbitrary extra annotation (mocked up here).</span></span>
<span id="cb827-2"><a href="repertoire-seq.html#cb827-2" aria-hidden="true"></a>extra.anno &lt;-<span class="st"> </span><span class="kw">DataFrame</span>(<span class="dt">anno=</span><span class="kw">sample</span>(LETTERS, <span class="kw">nrow</span>(tra.seq), <span class="dt">replace=</span><span class="ot">TRUE</span>))</span>
<span id="cb827-3"><a href="repertoire-seq.html#cb827-3" aria-hidden="true"></a>tra.seq &lt;-<span class="st"> </span><span class="kw">cbind</span>(tra.seq, extra.anno)</span>
<span id="cb827-4"><a href="repertoire-seq.html#cb827-4" aria-hidden="true"></a></span>
<span id="cb827-5"><a href="repertoire-seq.html#cb827-5" aria-hidden="true"></a><span class="co"># Regenerating the SplitDataFrameList from the modified DataFrame.</span></span>
<span id="cb827-6"><a href="repertoire-seq.html#cb827-6" aria-hidden="true"></a>tra2 &lt;-<span class="st"> </span><span class="kw">relist</span>(tra.seq, tra)</span>
<span id="cb827-7"><a href="repertoire-seq.html#cb827-7" aria-hidden="true"></a><span class="kw">length</span>(tra2) <span class="co"># Each element represents a cell again.</span></span></code></pre></div>
<pre><code>## [1] 6660</code></pre>
<p>While the <code>SplitDataFrameList</code> provides a natural representation of the 1:many mapping of cells to sequences,
many applications require a 1:1 relationship in order to function properly.
This includes plotting where each cell is a point that is to be colored by a single property,
or any function that requires cells to be grouped by their characteristics (e.g., DE analysis, aggregation).
We can use a combination of <code>List</code> and <code>DataFrame</code> semantics to choose a single representative sequence in cells where multiple sequences are available and fill in the row with <code>NA</code>s for cells where no sequences are available.</p>
<div class="sourceCode" id="cb829"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb829-1"><a href="repertoire-seq.html#cb829-1" aria-hidden="true"></a><span class="co"># We identify the sequence with the most UMIs per cell. </span></span>
<span id="cb829-2"><a href="repertoire-seq.html#cb829-2" aria-hidden="true"></a>best.per.cell &lt;-<span class="st"> </span><span class="kw">which.max</span>(tra[,<span class="st">&quot;umis&quot;</span>])</span>
<span id="cb829-3"><a href="repertoire-seq.html#cb829-3" aria-hidden="true"></a></span>
<span id="cb829-4"><a href="repertoire-seq.html#cb829-4" aria-hidden="true"></a><span class="co"># We convert this into an IntegerList:</span></span>
<span id="cb829-5"><a href="repertoire-seq.html#cb829-5" aria-hidden="true"></a>best.per.cell &lt;-<span class="st"> </span><span class="kw">as</span>(best.per.cell, <span class="st">&quot;IntegerList&quot;</span>)</span>
<span id="cb829-6"><a href="repertoire-seq.html#cb829-6" aria-hidden="true"></a></span>
<span id="cb829-7"><a href="repertoire-seq.html#cb829-7" aria-hidden="true"></a><span class="co"># And then we use it to subset our SplitDataFrameList:</span></span>
<span id="cb829-8"><a href="repertoire-seq.html#cb829-8" aria-hidden="true"></a>collapsed &lt;-<span class="st"> </span>tra[best.per.cell]</span>
<span id="cb829-9"><a href="repertoire-seq.html#cb829-9" aria-hidden="true"></a></span>
<span id="cb829-10"><a href="repertoire-seq.html#cb829-10" aria-hidden="true"></a><span class="co"># Finally unlisting to obtain a DataFrame:</span></span>
<span id="cb829-11"><a href="repertoire-seq.html#cb829-11" aria-hidden="true"></a>collapsed &lt;-<span class="st"> </span><span class="kw">unlist</span>(collapsed)</span>
<span id="cb829-12"><a href="repertoire-seq.html#cb829-12" aria-hidden="true"></a></span>
<span id="cb829-13"><a href="repertoire-seq.html#cb829-13" aria-hidden="true"></a>collapsed[,<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>]</span></code></pre></div>
<pre><code>## DataFrame with 6660 rows and 5 columns
##                               barcode     is_cell              contig_id
##                           &lt;character&gt; &lt;character&gt;            &lt;character&gt;
## AAACCTGAGATCTGAA-1 AAACCTGAGATCTGAA-1        True AAACCTGAGATCTGAA-1_c..
## AAACCTGAGGAACTGC-1 AAACCTGAGGAACTGC-1        True AAACCTGAGGAACTGC-1_c..
## AAACCTGAGGAGTCTG-1 AAACCTGAGGAGTCTG-1        True AAACCTGAGGAGTCTG-1_c..
## AAACCTGAGGCTCTTA-1 AAACCTGAGGCTCTTA-1        True AAACCTGAGGCTCTTA-1_c..
## AAACCTGAGTACGTTC-1                 NA          NA                     NA
## ...                               ...         ...                    ...
## TTTGTCATCACGGTTA-1 TTTGTCATCACGGTTA-1        True TTTGTCATCACGGTTA-1_c..
## TTTGTCATCCCTTGTG-1 TTTGTCATCCCTTGTG-1        True TTTGTCATCCCTTGTG-1_c..
## TTTGTCATCGGAAATA-1                 NA          NA                     NA
## TTTGTCATCTAGAGTC-1                 NA          NA                     NA
## TTTGTCATCTCGCATC-1                 NA          NA                     NA
##                    high_confidence    length
##                        &lt;character&gt; &lt;integer&gt;
## AAACCTGAGATCTGAA-1            True       474
## AAACCTGAGGAACTGC-1            True       505
## AAACCTGAGGAGTCTG-1            True       495
## AAACCTGAGGCTCTTA-1            True       501
## AAACCTGAGTACGTTC-1              NA        NA
## ...                            ...       ...
## TTTGTCATCACGGTTA-1            True       541
## TTTGTCATCCCTTGTG-1            True       522
## TTTGTCATCGGAAATA-1              NA        NA
## TTTGTCATCTAGAGTC-1              NA        NA
## TTTGTCATCTCGCATC-1              NA        NA</code></pre>
<p>This can be easily combined with more sophisticated strategies for choosing a representative sequence per cell.
For example, we might only consider sequences that are full-length and productive to be valid representatives.</p>
<div class="sourceCode" id="cb831"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb831-1"><a href="repertoire-seq.html#cb831-1" aria-hidden="true"></a><span class="co"># The above code compressed into a one-liner:</span></span>
<span id="cb831-2"><a href="repertoire-seq.html#cb831-2" aria-hidden="true"></a>collapsed2 &lt;-<span class="st"> </span><span class="kw">unlist</span>(tra.sub[<span class="kw">as</span>(<span class="kw">which.max</span>(tra.sub[,<span class="st">&quot;umis&quot;</span>]), <span class="st">&quot;IntegerList&quot;</span>)])</span>
<span id="cb831-3"><a href="repertoire-seq.html#cb831-3" aria-hidden="true"></a><span class="kw">nrow</span>(collapsed2)</span></code></pre></div>
<pre><code>## [1] 6660</code></pre>
<p>The <code>collapsed</code> objects can then be stored in the <code>colData</code> of our <code>SingleCellExperiment</code> alongside the <code>SplitDataFrameList</code>s for easy retrieval in downstream functions.
We assume that downstream applications are tolerant of <code>NA</code> values for cells that have no sequences.</p>
</div>
<div id="case-study-for-clonotype-analyses" class="section level2" number="21.5">
<h2><span class="header-section-number">21.5</span> Case study for clonotype analyses</h2>
<p>Quantification of clonal expansion is the most obvious application of repertoire sequencing data.
Cells with the same T cell clonotype are assumed to target the same antigen, and any increase in the frequency of a clonotype provides evidence for T cell activation and proliferation upon stimulation by the corresponding antigen.
Thus, we can gain some insights into the immune activity of each T cell cluster by counting the number of expanded clonotypes in each cluster.</p>
<div class="sourceCode" id="cb833"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb833-1"><a href="repertoire-seq.html#cb833-1" aria-hidden="true"></a><span class="co"># INSERT ALAKAZAM CODE HERE.</span></span></code></pre></div>
</div>
<div id="repeating-for-immunoglobulins" class="section level2" number="21.6">
<h2><span class="header-section-number">21.6</span> Repeating for immunoglobulins</h2>
<p>The process for the immunoglobulin (Ig) repertoire is largely the same as that for the TCR chains.
The biggest difference is that now we have three chains - heavy (IGH), lambda (IGL) and kappa (IGK).
We first pull down the dataset and load in the data frame, noting that it contains one sequence per row.</p>
<div class="sourceCode" id="cb834"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb834-1"><a href="repertoire-seq.html#cb834-1" aria-hidden="true"></a><span class="kw">library</span>(BiocFileCache)</span>
<span id="cb834-2"><a href="repertoire-seq.html#cb834-2" aria-hidden="true"></a>bfc &lt;-<span class="st"> </span><span class="kw">BiocFileCache</span>(<span class="dt">ask=</span><span class="ot">FALSE</span>)</span>
<span id="cb834-3"><a href="repertoire-seq.html#cb834-3" aria-hidden="true"></a>ig.data &lt;-<span class="st"> </span><span class="kw">bfcrpath</span>(bfc, <span class="kw">file.path</span>(</span>
<span id="cb834-4"><a href="repertoire-seq.html#cb834-4" aria-hidden="true"></a>    <span class="st">&quot;http://cf.10xgenomics.com/samples/cell-vdj/3.1.0&quot;</span>,</span>
<span id="cb834-5"><a href="repertoire-seq.html#cb834-5" aria-hidden="true"></a>    <span class="st">&quot;vdj_v1_hs_pbmc3/vdj_v1_hs_pbmc3_b_filtered_contig_annotations.csv&quot;</span>))</span>
<span id="cb834-6"><a href="repertoire-seq.html#cb834-6" aria-hidden="true"></a>ig &lt;-<span class="st"> </span><span class="kw">read.csv</span>(ig.data, <span class="dt">stringsAsFactors=</span><span class="ot">FALSE</span>)</span>
<span id="cb834-7"><a href="repertoire-seq.html#cb834-7" aria-hidden="true"></a><span class="kw">nrow</span>(ig)</span></code></pre></div>
<pre><code>## [1] 2059</code></pre>
<div class="sourceCode" id="cb836"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb836-1"><a href="repertoire-seq.html#cb836-1" aria-hidden="true"></a><span class="kw">head</span>(ig)</span></code></pre></div>
<pre><code>##              barcode is_cell                   contig_id high_confidence length
## 1 AAACCTGTCACTGGGC-1    True AAACCTGTCACTGGGC-1_contig_1            True    556
## 2 AAACCTGTCACTGGGC-1    True AAACCTGTCACTGGGC-1_contig_2            True    516
## 3 AAACCTGTCACTGGGC-1    True AAACCTGTCACTGGGC-1_contig_3            True    569
## 4 AAACCTGTCAGGTAAA-1    True AAACCTGTCAGGTAAA-1_contig_1            True    548
## 5 AAACCTGTCAGGTAAA-1    True AAACCTGTCAGGTAAA-1_contig_2            True    555
## 6 AAACCTGTCAGGTAAA-1    True AAACCTGTCAGGTAAA-1_contig_3            True    518
##   chain    v_gene d_gene j_gene c_gene full_length productive             cdr3
## 1   IGK IGKV1D-33   None  IGKJ4   IGKC        True       True      CQQYDNLPLTF
## 2   IGH  IGHV4-59   None  IGHJ5   IGHM        True       True     CARGGNSGLDPW
## 3   IGK IGKV2D-30   None  IGKJ1   IGKC        True      False CWGLLLHARYTLAWTF
## 4   IGK  IGKV1-12   None  IGKJ4   IGKC        True       True      CQQANSFPLTF
## 5   IGK  IGKV3-15   None  IGKJ2   IGKC        True       True     CQQYDNWPPYTF
## 6   IGL  IGLV5-45   None  IGLJ2  IGLC2        True      False      CMIWHSSASVF
##                                            cdr3_nt reads umis raw_clonotype_id
## 1                TGTCAACAGTATGATAATCTCCCGCTCACTTTC  7410   61       clonotype7
## 2             TGTGCGAGAGGCGGGAACAGTGGCTTAGACCCCTGG  1458   18       clonotype7
## 3 TGTTGGGGTTTATTACTGCATGCAAGGTACACACTGGCCTGGACGTTC  2045   17       clonotype7
## 4                TGTCAACAGGCTAACAGTTTCCCGCTCACTTTC   140    1       clonotype2
## 5             TGTCAGCAGTATGATAACTGGCCTCCGTACACTTTT   274    2       clonotype2
## 6                TGTATGATTTGGCACAGCAGTGCTTCGGTATTC    46    2       clonotype2
##         raw_consensus_id
## 1 clonotype7_consensus_1
## 2 clonotype7_consensus_2
## 3                   None
## 4 clonotype2_consensus_2
## 5 clonotype2_consensus_1
## 6                   None</code></pre>
<p>We then loop over all of the chains and create a <code>SplitDataFrameList</code> for each chain,
storing it in the <code>colData</code> of our <code>SingleCellExperiment</code> as previously described.</p>
<div class="sourceCode" id="cb838"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb838-1"><a href="repertoire-seq.html#cb838-1" aria-hidden="true"></a><span class="cf">for</span> (chain <span class="cf">in</span> <span class="kw">c</span>(<span class="st">&quot;IGH&quot;</span>, <span class="st">&quot;IGL&quot;</span>, <span class="st">&quot;IGK&quot;</span>)) {</span>
<span id="cb838-2"><a href="repertoire-seq.html#cb838-2" aria-hidden="true"></a>    current &lt;-<span class="st"> </span>ig[ig<span class="op">$</span>chain<span class="op">==</span><span class="st">&quot;IGH&quot;</span>,]</span>
<span id="cb838-3"><a href="repertoire-seq.html#cb838-3" aria-hidden="true"></a>    x &lt;-<span class="st"> </span><span class="kw">split</span>(<span class="kw">DataFrame</span>(current), <span class="kw">factor</span>(current<span class="op">$</span>barcode, sce.pbmc<span class="op">$</span>Barcode))</span>
<span id="cb838-4"><a href="repertoire-seq.html#cb838-4" aria-hidden="true"></a>    <span class="kw">colData</span>(sce.pbmc)[[chain]] &lt;-<span class="st"> </span>x</span>
<span id="cb838-5"><a href="repertoire-seq.html#cb838-5" aria-hidden="true"></a>}</span>
<span id="cb838-6"><a href="repertoire-seq.html#cb838-6" aria-hidden="true"></a><span class="kw">colnames</span>(<span class="kw">colData</span>(sce.pbmc))</span></code></pre></div>
<pre><code>## [1] &quot;Sample&quot;     &quot;Barcode&quot;    &quot;sizeFactor&quot; &quot;label&quot;      &quot;TRA&quot;       
## [6] &quot;TRB&quot;        &quot;IGH&quot;        &quot;IGL&quot;        &quot;IGK&quot;</code></pre>
<p>One can see how we have managed to pack all of the information about this experiment -
gene expression, protein abundance and repertoire information for both TCR and Ig chains -
into a single object for convenient handling throughout the rest of the analysis.</p>
<div class="sourceCode" id="cb840"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb840-1"><a href="repertoire-seq.html#cb840-1" aria-hidden="true"></a>sce.pbmc</span></code></pre></div>
<pre><code>## class: SingleCellExperiment 
## dim: 33538 6660 
## metadata(1): Samples
## assays(2): counts logcounts
## rownames(33538): ENSG00000243485 ENSG00000237613 ... ENSG00000277475
##   ENSG00000268674
## rowData names(3): ID Symbol Type
## colnames: NULL
## colData names(9): Sample Barcode ... IGL IGK
## reducedDimNames(0):
## altExpNames(1): Antibody Capture</code></pre>
<p>Many of the analyses that can be performed on the TCR data can also be applied to the Ig repertoire.
The most interesting difference between the two stems from the fact that immunoglobulins undergo hypersomatic mutation,
providing additional sequence variation beyond that of the V(D)J rearrangements.
This allows us to use sequence similarity to create lineage trees involving cells of the same clonotype,
particularly useful for characterizing Ig microevolution in response to immune challenges like vaccination.
In practice, this is difficult to achieve in single-cell data as it requires enough cells per clonotype to create a reasonably interesting tree.</p>
<div class="sourceCode" id="cb842"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb842-1"><a href="repertoire-seq.html#cb842-1" aria-hidden="true"></a><span class="co"># INSERT ALAKAZAM CODE HERE?</span></span></code></pre></div>
</div>
<div id="session-info" class="section level2 unnumbered">
<h2>Session Info</h2>
<button class="rebook-collapse">
View session info
</button>
<div class="rebook-content">
<pre><code>R version 4.0.0 Patched (2020-05-01 r78341)
Platform: x86_64-pc-linux-gnu (64-bit)
Running under: Ubuntu 18.04.5 LTS

Matrix products: default
BLAS:   /home/luna/Software/R/R-4-0-branch-dev/lib/libRblas.so
LAPACK: /home/luna/Software/R/R-4-0-branch-dev/lib/libRlapack.so

locale:
 [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C              
 [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8    
 [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8   
 [7] LC_PAPER=en_US.UTF-8       LC_NAME=C                 
 [9] LC_ADDRESS=C               LC_TELEPHONE=C            
[11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C       

attached base packages:
[1] parallel  stats4    stats     graphics  grDevices utils     datasets 
[8] methods   base     

other attached packages:
 [1] BiocFileCache_1.13.1        dbplyr_1.4.4               
 [3] SingleCellExperiment_1.11.6 SummarizedExperiment_1.19.6
 [5] DelayedArray_0.15.7         matrixStats_0.56.0         
 [7] Matrix_1.2-18               Biobase_2.49.0             
 [9] GenomicRanges_1.41.6        GenomeInfoDb_1.25.10       
[11] IRanges_2.23.10             S4Vectors_0.27.12          
[13] BiocGenerics_0.35.4         BiocStyle_2.17.0           
[15] rebook_0.99.4              

loaded via a namespace (and not attached):
 [1] Rcpp_1.0.5             lattice_0.20-41        ps_1.3.4              
 [4] assertthat_0.2.1       digest_0.6.25          R6_2.4.1              
 [7] RSQLite_2.2.0          evaluate_0.14          httr_1.4.2            
[10] highr_0.8              pillar_1.4.6           zlibbioc_1.35.0       
[13] rlang_0.4.7            curl_4.3               callr_3.4.3           
[16] blob_1.2.1             rmarkdown_2.3          stringr_1.4.0         
[19] RCurl_1.98-1.2         bit_4.0.4              compiler_4.0.0        
[22] xfun_0.16              pkgconfig_2.0.3        CodeDepends_0.6.5     
[25] htmltools_0.5.0        tidyselect_1.1.0       tibble_3.0.3          
[28] GenomeInfoDbData_1.2.3 bookdown_0.20          codetools_0.2-16      
[31] XML_3.99-0.5           crayon_1.3.4           dplyr_1.0.1           
[34] bitops_1.0-6           rappdirs_0.3.1         grid_4.0.0            
[37] lifecycle_0.2.0        DBI_1.1.0              magrittr_1.5          
[40] graph_1.67.1           stringi_1.4.6          XVector_0.29.3        
[43] ellipsis_0.3.1         generics_0.0.2         vctrs_0.3.2           
[46] tools_4.0.0            bit64_4.0.2            glue_1.4.1            
[49] purrr_0.3.4            processx_3.4.3         yaml_2.2.1            
[52] BiocManager_1.30.10    memoise_1.1.0          knitr_1.29            </code></pre>
</div>

</div>
</div>
<h3> Bibliography</h3>
<div id="refs" class="references">
<div id="ref-georgiou2014promise">
<p>Georgiou, G., G. C. Ippolito, J. Beausang, C. E. Busse, H. Wardemann, and S. R. Quake. 2014. “The promise and challenge of high-throughput sequencing of the antibody repertoire.” <em>Nat. Biotechnol.</em> 32 (2): 158–68.</p>
</div>
<div id="ref-rosati2017overview">
<p>Rosati, E., C. M. Dowds, E. Liaskou, E. K. K. Henriksen, T. H. Karlsen, and A. Franke. 2017. “Overview of methodologies for T-cell receptor repertoire analysis.” <em>BMC Biotechnol.</em> 17 (1): 61.</p>
</div>
<div id="ref-zheng2017massively">
<p>Zheng, G. X., J. M. Terry, P. Belgrader, P. Ryvkin, Z. W. Bent, R. Wilson, S. B. Ziraldo, et al. 2017. “Massively parallel digital transcriptional profiling of single cells.” <em>Nat Commun</em> 8 (January): 14049.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="integrating-with-protein-abundance.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="interactive-sharing.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": false,
"twitter": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/Bioconductor/OrchestratingSingleCellAnalysis-base/edit/master/repertoire-seq.Rmd",
"text": "Edit"
},
"history": {
"link": "https://github.com/Bioconductor/OrchestratingSingleCellAnalysis-base/commits/master/repertoire-seq.Rmd",
"text": null
},
"view": {
"link": "https://github.com/Bioconductor/OrchestratingSingleCellAnalysis-base/blob/master/repertoire-seq.Rmd",
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
